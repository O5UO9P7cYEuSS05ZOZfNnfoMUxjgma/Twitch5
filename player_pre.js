!function(e){"use strict";var t=e.document;const n="2018.3.5",r=1.5,i=60,a=40,o=15e3,s=15e3,c=6e3,u=1,l=100,d=4,f=2,h=1,m=5,g=3,p=1,v=2,b=3,y=4,E=1,$=2,w=3,k=4,S=5,I=6,_=7,N=8,x=-1,T=0,L=1,A=2,C=3,F="Сервер вернул код ",B=Number.MIN_SAFE_INTEGER+1e3,M=Number.MAX_SAFE_INTEGER-1e3,D=Number.MIN_SAFE_INTEGER,O=0,X=1,P=0,R=1,j=2,J=1,U=2,q=3,H=4,Y=0;var W=!1,G=[];function K(e){if(!e)throw new Error("Проверка не пройдена")}function V(e){return fe.GetText(e)}function z(e){return"object"==typeof e&&null!==e}function Q(e){return"number"==typeof e&&e==e}function Z(e){return"string"==typeof e&&""!==e}function ee(e,t){if(K("number"==typeof e&&Number.isInteger(t)&&t>=0&&t<=20),0===t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n}function te(e,t,n){return K(Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)&&t<=n),Math.min(Math.max(e,t),n)}function ne(e){return K("string"==typeof e),(e=(e=function(e){K("string"==typeof e);const n=t.createElement("template");return n.innerHTML=e,n.content.textContent}(e=e.replace(/[\t\r\n]/g," ").replace(/<\s*br[\s\/]*>/gi,"\n"))).replace(/^\s+|[^\S\r\n]+$/gm,"")).replace(/[^\S\r\n]{2,}/g," ")}function re(e,t){return e.length<=t?e:`${e.slice(0,t)}---8<---Отрезано ${e.length-t}`}function ie(e){const t=getComputedStyle(e);return("scroll"===t.overflowY||"auto"===t.overflowY)&&e.clientHeight<e.scrollHeight}function ae(){this._лВыполняется=!1,this._фОбработчик=null}function oe(e,t){return K(Number.isFinite(t)),K((t=Math.round(t))>=0&&t<=2147483647),new Promise(function(n,r){var i=setTimeout(n,t);e&&e.ЗаменитьОбработчик(function(){clearTimeout(i),r(ae.ОБЕЩАНИЕ_ОТМЕНЕНО)})})}function se(e,t,n,r,i,a){switch(K("number"==typeof e&&e>=p&&e<=y),K("number"==typeof t&&t>=$&&t<=N||z(t)||"string"==typeof t&&e===p),arguments.length){case 2:n=0,r=!0,i=NaN;case 5:K(Number.isFinite(n)&&n>=0),K("boolean"==typeof r),K("number"==typeof i),a=++se._чНомер;case 6:K(Number.isFinite(a));break;default:K(!1)}"number"==typeof t&&ue.Окак(`[Очередь] Добавлен сегмент ${a} Состояние=${t} Обработка=${e}`),this.чОбработка=e,this.пДанные=t,this.чДлительность=n,this.лРазрыв=r,this.чTwitchПрошлоВремени=i,this.чНомер=a}function ce(e,n,r,i){K(r>=0),this._сИмяНастройки=e,this._оПараметрыНастройки=ve.ПолучитьПараметрыНастройки(e),this._чШаг=n,this._чТочность=r,this._чТаймер=0,this._кИнтервал=0,this._чДобавить=0,this._узУзел=t.getElementById(i),this._узУзел.addEventListener("mousedown",this),this._Показать()}void 0===e.URLSearchParams&&(e.URLSearchParams=function(e){if(K(1===arguments.length&&"string"==typeof e),this._амПараметры=new Map,0!==e.length)for(var t of e.split("&")){var n=t.indexOf("=");if(-1===n){var r=decodeURIComponent(t);this._амПараметры.has(r)||this._амПараметры.set(r,"")}else{r=decodeURIComponent(t.slice(0,n));this._амПараметры.has(r)||this._амПараметры.set(r,decodeURIComponent(t.slice(n+1)))}}},e.URLSearchParams.prototype.has=function(e){return this._амПараметры.has(String(e))},e.URLSearchParams.prototype.get=function(e){var t=this._амПараметры.get(String(e));return void 0===t?null:t}),void 0===e.setImmediate&&(e.setImmediate=function(e){K("function"==typeof e),setTimeout(e,0)}),ae.ОБЕЩАНИЕ_ОТМЕНЕНО=new Error("AbortError"),ae.prototype.НачалоВыполнения=function(){K(!this._лВыполняется),this._лВыполняется=!0},ae.prototype.Отменить=function(){this._лВыполняется=!1,this._фОбработчик&&(this._фОбработчик(),this._фОбработчик=null)},ae.prototype.ЗаменитьОбработчик=function(e){K(this._лВыполняется),K("function"==typeof e||null===e),this._фОбработчик=e},se._чНомер=0,se.prototype.toString=function(){return this.пДанные===$?`${this.чНомер}-${this.чОбработка}-Н`:this.пДанные===w?`${this.чНомер}-${this.чОбработка}-К`:this.лРазрыв?`${this.чНомер}-${this.чОбработка}-Р`:`${this.чНомер}-${this.чОбработка}`},G.ПолучитьКоличествоПреобразованныхСегментов=function(){for(var e=0,t=0;e<this.length&&this[e].чОбработка===y;++e)"number"!=typeof this[e].пДанные&&(t+=this[e].чДлительность);return{"кКоличество":e,"чДлительность":t}},G.Добавить=function(e){for(var t of(K(e instanceof se),this))K(t.чНомер!==e.чНомер);if(e.чОбработка!==y)this.push(e);else{var n=this.ПолучитьКоличествоПреобразованныхСегментов();n.чДлительность>1.5*i&&le.ЗавершитьРаботуИПоказатьСообщение("J0208"),this.splice(n.кКоличество,0,e)}return e},G.Удалить=function(e,t){if(0!==t){if(void 0===t?t=1:K(Number.isInteger(t)&&t>=1),"number"==typeof e){K(Number.isInteger(e)&&e>=0);var n=e}else if(-1===(n=this.indexOf(e)))return void K(e instanceof se);for(;--t>=0;){switch(K(n<this.length),this[n].чОбработка){case v:z(this[n].пДанные)&&(ue.Вот(`[Очередь] Отменяю загрузку ${this[n]}`),this[n].пДанные.Отменить());break;case b:de.Выбросить(this[n].пДанные);break;case y:z(this[n].пДанные)&&(de.Выбросить(this[n].пДанные.мбСегментИнициализации),de.Выбросить(this[n].пДанные.мбМедиасегмент))}ue.Вот(`[Очередь] Удаляю ${this[n]}`),this.splice(n,1)}}},G.Очистить=function(){this.Удалить(0,this.length)},G.ПоказатьСостояние=function(){ue.Вот(`[Очередь] ${G.join(" ")}`)},ce.prototype._Показать=function(e=ve.Получить(this._сИмяНастройки)){this._узУзел.children[1].value=e===D?V(this._оПараметрыНастройки.сАвтонастройка):fe.ФорматироватьЧисло(e,this._чТочность)},ce.prototype.handleEvent=function(e){try{switch(e.type){case"mousedown":if(e.button===O&&0===this._чТаймер&&me.ПолучитьСостояние().лАктивен){switch(e.target.className){case"вводчисла-минус":this._чДобавить=-this._чШаг;break;case"вводчисла-плюс":this._чДобавить=this._чШаг;break;default:return}t.addEventListener("mouseup",this),he.ДобавитьОбработчик("фокусник-изменилосьсостояние",this),this._чТаймер=setInterval(()=>this._ОбработатьТаймер(),130),this._кИнтервал=0,this._ОбработатьТаймер()}return;case"фокусник-изменилосьсостояние":if(e.data.лАктивен)return}0!==this._чТаймер&&(t.removeEventListener("mouseup",this),he.УдалитьОбработчик("фокусник-изменилосьсостояние",this),clearInterval(this._чТаймер),this._чТаймер=0)}catch(e){le.ПойманоИсключение(e)}},ce.prototype._ОбработатьТаймер=function(){try{if(1==++this._кИнтервал||this._кИнтервал>3){const e=ve.Получить(this._сИмяНастройки);let t;(t=this._оПараметрыНастройки.сАвтонастройка&&this._чДобавить<0&&e===this._оПараметрыНастройки.чМинимальное||this._оПараметрыНастройки.сАвтонастройка&&this._чДобавить>0&&e===this._оПараметрыНастройки.чМаксимальное?D:e===D&&this._чДобавить>0?this._оПараметрыНастройки.чМинимальное:e===D&&this._чДобавить<0?this._оПараметрыНастройки.чМаксимальное:e+this._чДобавить)!==D&&(t=te(ee(t,this._чТочность),this._оПараметрыНастройки.чМинимальное,this._оПараметрыНастройки.чМаксимальное)),t!==e&&(ve.Изменить(this._сИмяНастройки,t),this._Показать(t),this.ПослеИзменения(t))}}catch(e){le.ПойманоИсключение(e)}},ce.prototype.Обновить=function(){this._Показать()},ce.prototype.ПослеИзменения=function(){};const ue=(()=>{const t=1e3;var n=new Array(1500),r=-1;function i(i,a){K("string"==typeof i&&"string"==typeof a),a=re(`${i} ${(e.performance.now()/1e3).toFixed(3)} ${a}`,t),++r===n.length&&(r=0),n[r]=a}function a(e){return function(t){return"number"==typeof t?t.toFixed(e):"NaN"}}return{"Вот":function(e){K(1===arguments.length),i(" ",e)},"Окак":function(e){K(1===arguments.length),i("~",e)},"Ой":function(e){K(1===arguments.length),i("@",e)},O:function(e){switch(null===(t=e)?"null":typeof t){case"object":return JSON.stringify(e);case"function":return`[function ${e.name}]`;case"symbol":return"[symbol]";default:return String(e)}var t},F0:a(0),F1:a(1),F2:a(2),F3:a(3),"ПолучитьДанныеДляОтчета":function(){var e=r+1;return e===n.length?n:void 0===n[e]?n.slice(0,e):n.slice(e).concat(n.slice(0,e))}}})(),le=(()=>{var r="",i=[];function a(){Ie.ОтключитьПолноэкранныйРежим(),t.body.textContent="";for(let e=t.querySelector('link[href="common.css"]');e.nextSibling;e.nextSibling.remove());for(let e of[t.documentElement,t.body])e.removeAttribute("class"),e.removeAttribute("style"),e.removeAttribute("hidden");return new Promise((e,n)=>{const r=t.createElement("iframe");r.src="report.html",r.addEventListener("load",function t(){r.removeEventListener("load",t);const n=r.contentDocument;fe.TranslatePage(n),e(n)}),t.body.appendChild(r)})}function o(e,t,n){n&&e.documentElement.classList.add(t);for(let n of e.querySelectorAll("form"))if(n.id===t){n.removeAttribute("hidden");const e=n.querySelector("*[autofocus]");e&&e.focus()}else n.setAttribute("hidden","")}function s(s,c){!function(e){try{chrome.system.memory.getInfo(function(t){e(chrome.runtime.lastError?void 0:t)})}catch(t){e()}}(u=>{!function(e){try{chrome.system.cpu.getInfo(function(t){e(chrome.runtime.lastError?void 0:t)})}catch(t){e()}}(l=>{!function(t,n){a().then(r=>{let i;(i="ОСТАВИТЬ ОТЗЫВ"===t.ПричинаЗавершенияРаботы?r.getElementById("отладка-отзыв"):r.getElementById("отладка-ошибка")).elements["отладка-отчет"].value=JSON.stringify(t),o(r,i.id,!0),r.body.addEventListener("reset",t=>{t.preventDefault(),e.location.reload()});let a,s,c=!1;r.body.addEventListener("submit",t=>{switch(t.preventDefault(),t.target.id){case"отладка-идетотправка":c=!0,a.abort();break;case"отладка-сбойотправки":i.querySelector('*[type="submit"]').click();break;default:r.getElementById("отладка-ходотправки").value=0,o(r,"отладка-идетотправка",!1),a||((a=new XMLHttpRequest).upload.addEventListener("progress",e=>{r.getElementById("отладка-ходотправки").value=e.loaded/e.total}),a.addEventListener("load",e=>{c=e.target.status>=200&&e.target.status<=299}),a.addEventListener("loadend",()=>{c?e.location.reload():o(r,"отладка-сбойотправки",!1)}),s=new FormData(t.target),n&&s.append("отладка-транспортныйпоток-0",new Blob([n],{type:"video/mp2t"}))),a.open("POST","http://r90354g8.beget.tech/tw5/report3.php"),a.send(s)}})})}({"ПричинаЗавершенияРаботы":s,"ВерсияРасширения":n,"Оборзеватель":navigator.userAgent,"Время":(new Date).toISOString(),"Адрес":e.location.href,"Инкогнито":chrome.extension.inIncognitoContext,"Оперативка":u,"Процессор":l,"Видюха":function(){try{var e=t.createElement("canvas").getContext("webgl"),n=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(n.UNMASKED_VENDOR_WEBGL)+" | "+e.getParameter(n.UNMASKED_RENDERER_WEBGL)}catch(e){}}(),"Язык":function(){try{return V("J0103")}catch(e){}}(),"ОтклонениеПульса":p,"Экран":{top:e.screen.top,left:e.screen.left,width:e.screen.width,height:e.screen.height,availTop:e.screen.availTop,availLeft:e.screen.availLeft,availWidth:e.screen.availWidth,availHeight:e.screen.availHeight,colorDepth:e.screen.colorDepth,pixelDepth:e.screen.pixelDepth,orientation:"object"==typeof e.screen.orientation?e.screen.orientation.type:void 0,screenX:e.screenX,screenY:e.screenY,outerWidth:e.outerWidth,outerHeight:e.outerHeight,innerWidth:e.innerWidth,innerHeight:e.innerHeight,devicePixelRatio:e.devicePixelRatio},"Фокусник":me.ПолучитьСостояние(),"Настройки":ve.ПолучитьДанныеДляОтчета(),"Статистика":be.ПолучитьДанныеДляОтчета(),"СписокВариантов":r,"СпискиСегментов":i,"Журнал":ue.ПолучитьДанныеДляОтчета()},c)})})}function c(e){var t;throw void(W||(console.error(e),Ce(!1),t=V(e),a().then(e=>{e.getElementById("отладка-текстсообщения").textContent=t,o(e,"отладка-сообщение",!0)})))}function u(e,t){if(!W){console.error(e),(e=String(e)).includes("out of memory")&&c("J0200");try{_e.ПоказатьСостояние("Вот","[Отладка] Завершаю работу"),G.ПоказатьСостояние()}catch(e){}Ce(!1),s(e,t)}throw void 0}const l=500,d=200,f=40;var h,m,g=0,p=0;function v(){try{var n=e.performance.now(),r=Date.now();if(Ie.ПолучитьСостояние()!==_&&Ie.ПолучитьСостояние()!==N){var i=n-h,a=i-(t.hidden?Math.max(l,1e3):l),o=r-m-i;(a>d||Math.abs(o)>f)&&ue.Ой(`[Пульс] ${ue.F0(a)} ${ue.F0(o)}`),p=Math.max(p,a)}h=n,m=r,g=setTimeout(v,l)}catch(e){le.ПойманоИсключение(e)}}return{"Запустить":function(){K(0===g),h=e.performance.now(),m=Date.now(),g=setTimeout(v,l)},"Остановить":function(){0!==g&&(clearInterval(g),g=0)},"СохранитьСписокВариантов":function(e){W||(r=re(e,15e3))},"СохранитьСписокСегментов":function(e){W||(3===i.length&&i.shift(),i.push(re(e,15e3)))},"СохранитьТранспортныйПоток":function(e){},"СохранитьПреобразованныйСегмент":function(e){},"ЗавершитьРаботуИПоказатьСообщение":c,"ЗавершитьРаботуИОтправитьОтчет":u,"ПойманоИсключение":function(e){u(e instanceof Error?e.stack:`[typeof ${typeof e}] ${new Error(e).stack}`)},"ОставитьОтзыв":function(){try{u("ОСТАВИТЬ ОТЗЫВ")}catch(e){}}}})(),de=(()=>{const e=1e7;var t="",n=null,r=0;function i(){n&&(ue.Вот(`[Помойка] Сжигаю ${r} байтов`),n.postMessage(null),n=null,r=0)}return{"Выбросить":function(a){z(a)&&(a.buffer&&(a=a.buffer),a.byteLength&&(ue.Вот(`[Помойка] Выбрасываю ${a.byteLength} байтов`),n||(t||(t=URL.createObjectURL(new Blob(["\n\t\t\t\t\t\t\t\t'use strict';\n\t\t\t\t\t\t\t\tself.onmessage = function(оСобытие)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (!оСобытие.data)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tself.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t"],{type:"application/javascript"}))),n=new Worker(t)),r+=a.byteLength,n.postMessage(a,[a]),r>e&&i()))},"Сжечь":i}})(),fe=(()=>{function e(e){K("string"==typeof e);const t=chrome.i18n.getMessage(e);if(!t)throw new Error(`Не найден текст ${e}`);return t}return{GetText:e,TranslatePage:function(t){ue.Вот("[i18n] Перевод страницы");for(let n of t.querySelectorAll("*[data-i18n]")){const t=n.getAttribute("data-i18n"),r=t.indexOf("^");0!==r&&(n.innerHTML=e(-1===r?t:t.slice(0,r))),-1!==r&&(n.title=e(t.slice(r+1)))}},"ФорматироватьЧисло":function(e,t){return K(void 0===t||"number"==typeof t&&t>=0),Number(e).toLocaleString(void 0,void 0===t?void 0:{minimumFractionDigits:t})},"ПеревестиСекундыВСтроку":function(e,t){var n=Math.floor(e/60%60),r=Math.floor(e/60/60)+(n<10?" : 0":" : ")+n;return t&&(r+=((n=Math.floor(e%60))<10?" : 0":" : ")+n),r},"ПрошлоДнейПрописью":function t(n){void 0===t.мсДни&&(t.мсДни=e("J0132").split("^"),K(t.мсДни.length>1));const r=Math.floor((Date.now()-n.getTime())/864e5);return r>=0&&r<t.мсДни.length?t.мсДни[r]:""}}})(),he=(()=>{var e=new Map;return{"ДобавитьОбработчик":function(t,n){K(Z(t)),K("function"==typeof n||z(n));var r=e.get(t);void 0===r&&(r=new Set,e.set(t,r)),r.add(n)},"УдалитьОбработчик":function(t,n){K(Z(t)),K("function"==typeof n||z(n));var r=e.get(t);void 0!==r&&(r.delete(n),0===r.size&&e.delete(t))},"ОбработатьСобытие":function(t,n){if(W)return;K(Z(t)),ue.Вот(`[События] Произошло событие ${t}`);const r=e.get(t);if(void 0!==r)for(var i of(K(0!==r.size),r.values()))if("function"==typeof i)i(t,n);else{if(void 0===a)var a={type:t,data:n};i.handleEvent(a)}}}})(),me=(()=>{var n=null;function r(){const e=!t.hidden;return{"лПоказан":e,"лАктивен":e&&t.hasFocus()}}function i(){try{const e=r();n.лПоказан===e.лПоказан&&n.лАктивен===e.лАктивен||(ue.Окак(`[Фокусник] Новое состояние ${ue.O(e)}`),n=e,he.ОбработатьСобытие("фокусник-изменилосьсостояние",e))}catch(e){le.ПойманоИсключение(e)}}function a(e){try{ue.Вот(`[Фокусник] Событие ${e.type}, старое состояние ${ue.O(n)}`),setImmediate(i)}catch(e){le.ПойманоИсключение(e)}}return t.addEventListener("visibilitychange",a),e.addEventListener("focus",a),e.addEventListener("blur",a),n=r(),ue.Вот(`[Фокусник] Начальное состояние ${ue.O(n)}`),{"ПолучитьСостояние":function(){return n}}})(),ge=(()=>{const n=50;var r,i,a,o,s,c,u,l,d=new Map,f=null;function h(e,t,n,r){switch(e){case 1:var i=getComputedStyle(t);u=Number.parseInt(i.left,10),l=Number.parseInt(i.top,10);break;case 2:t.style.left=`${u-n}px`,t.style.top=`${l-r}px`;break;case 3:break;default:K(!1)}}function m(e){try{K(null===f),f=e.target,(r=d.get(f.id))?(ue.Окак(`[Тащилка] Начинаю тащить ${f.id} X=${e.clientX} Y=${e.clientY}`),K("true"===f.getAttribute("draggable")),setImmediate(function(){f&&t.body.classList.add("js-тащилка-страница")}),f.classList.add("js-тащилка-элемент"),r(1,f),i=0,a=s=e.clientX,o=c=e.clientY,e.dataTransfer.setData("text",""),e.dataTransfer.effectAllowed="move",e.dataTransfer.setDragImage?e.dataTransfer.setDragImage(t.head,0,0):(f.classList.add("js-тащилка-скрыть"),setImmediate(function(){e.target.classList.remove("js-тащилка-скрыть")}))):(f=null,e.preventDefault())}catch(e){le.ПойманоИсключение(e)}}function g(e){try{f&&e.preventDefault()}catch(e){le.ПойманоИсключение(e)}}function p(t){try{if(f){t.preventDefault();var u=e.performance.now();if(u-i<n)return;i=u;var l=s!==t.clientX,d=c!==t.clientY;(l||d)&&(s=t.clientX,c=t.clientY,r(2,f,a-t.clientX,o-t.clientY,l,d))}}catch(e){le.ПойманоИсключение(e)}}function v(e){try{f&&(ue.Окак(`[Тащилка] Заканчиваю тащить ${f.id} X=${s} Y=${c}`),r(3,f),t.body.classList.remove("js-тащилка-страница"),f.classList.remove("js-тащилка-элемент"),f=null)}catch(e){le.ПойманоИсключение(e)}}return{"ДобавитьОбработчик":function(e,n){null===n&&(n=h),K("function"==typeof n);var r=t.getElementById(e);return r.setAttribute("draggable","true"),d.set(e,n),1===d.size&&(t.addEventListener("dragstart",m),t.addEventListener("dragenter",g),t.addEventListener("dragover",p),t.addEventListener("drop",g),t.addEventListener("dragend",v)),r}}})(),pe=(()=>{const e='input[type="color"]';var n="",r=null;function i(t){try{t.target.matches(e)&&o()}catch(e){le.ПойманоИсключение(e)}}function a(t){try{t.target.matches(e)&&ve.Изменить(t.target.id,t.target.value)}catch(e){le.ПойманоИсключение(e)}}function o(){K(n);const r=1-ve.Получить("чПрозрачность")/100,i={"чНепрозрачность":r,"чНепрозрачностьОкна":te(r,.85,1)};for(var a of t.querySelectorAll(e))i[a.id]=Number.parseInt(a.value.slice(1,3),16)+","+Number.parseInt(a.value.slice(3,5),16)+","+Number.parseInt(a.value.slice(5,7),16);t.getElementById("стиль").textContent=function(e,t){return e.replace(/{{.*?}}/g,function(e){var n=t[e.slice(2,-2)];return"string"==typeof n?n:(K(Number.isFinite(n)),String(ee(n,2)))})}(n,i)}function s(){!function(){for(var n of t.querySelectorAll(e))n.value=ve.Получить(n.id);r.Обновить()}(),o()}return{"ЗапуститьАсинхронно":function(){return Te.ЗагрузитьТекст(null,chrome.extension.getURL("player.css"),0,"шаблон",!1).then(function(e){K(!n&&e),n=e})},"Запустить":function(){(r=new ce("чПрозрачность",5,0,"прозрачность")).ПослеИзменения=o,t.addEventListener("input",i),t.addEventListener("change",a),he.ДобавитьОбработчик("настройки-измениласьпредустановка-оформление",s),s()}}})(),ve=(()=>{const n=2,i=[{"амДанные":new Map([["J0126",{"кОдновременныхЗагрузок":1,"чНачалоВоспроизведения":3,"чРазмерБуфера":5,"чРастягиваниеБуфера":15,"кЗаначка":0,"чИнтервалОпроса":a}],["J0127",{"кОдновременныхЗагрузок":2,"чНачалоВоспроизведения":3,"чРазмерБуфера":8.5,"чРастягиваниеБуфера":20,"кЗаначка":1,"чИнтервалОпроса":D}],["J0128",{"кОдновременныхЗагрузок":2,"чНачалоВоспроизведения":17,"чРазмерБуфера":9.5,"чРастягиваниеБуфера":30,"кЗаначка":0,"чИнтервалОпроса":D}]]),"сНастраиваемая":"J0129","сВыбрана":"сПредустановкаВыбрана_буферизация","сЗаполнена":"лПредустановкаЗаполнена_буферизация","сСписок":"предустановка-буферизация","сСобытие":"настройки-измениласьпредустановка-буферизация"},{"амДанные":new Map([["J0122",{"сЦветФона":"#282828","сЦветГрадиента":"#ffffff","сЦветКнопок":"#d3be96","сЦветЗаголовка":"#cdbdec","сЦветВыделения":"#ff9428","чПрозрачность":25}],["J0121",{"сЦветФона":"#425e7b","сЦветГрадиента":"#ffffff","сЦветКнопок":"#ffffff","сЦветЗаголовка":"#d1f0fa","сЦветВыделения":"#ffaa33","чПрозрачность":30}],["J0125",{"сЦветФона":"#141414","сЦветГрадиента":"#c8c8c8","сЦветКнопок":"#f0f0f0","сЦветЗаголовка":"#b6c3c3","сЦветВыделения":"#6cb6ff","чПрозрачность":10}]]),"сНастраиваемая":"J0123","сВыбрана":"сПредустановкаВыбрана_оформление","сЗаполнена":"лПредустановкаЗаполнена_оформление","сСписок":"предустановка-оформление","сСобытие":"настройки-измениласьпредустановка-оформление"}],o=new Set(["чСлучайноеЧисло","сПредыдущаяВерсия","чВерсияНастроек"]);function s(e,t,n,r,i){this.пТекущее=void 0,this.пНачальное=e,this.мпПеречисление=t,this.чМинимальное=n,this.чМаксимальное=r,this.сАвтонастройка=i}s.Создать=function(e){return new this(e,null,B,M,"")},s.СоздатьПеречисление=function(e,t){return new this(e,t,B,M,"")},s.СоздатьДиапазон=function(e,t,n,r=""){return new this(e,null,t,n,r)},s.ПроверитьЗначение=function(e){K(e==e&&e!==1/0&&e!==-1/0&&void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e&&"object"!=typeof e)},s.prototype.ИсправитьЗначение=function(e){return s.ПроверитьЗначение(e),K(typeof e==typeof this.пНачальное),this.мпПеречисление?this.мпПеречисление.includes(e)||(e=this.пНачальное):"number"==typeof e&&(e===D?""===this.сАвтонастройка&&(e=this.пНачальное):e<this.чМинимальное?e=this.чМинимальное:e>this.чМаксимальное&&(e=this.чМаксимальное)),e};const c={"чСлучайноеЧисло":s.Создать(Math.random()),"сПредыдущаяВерсия":s.Создать("2000.1.1"),"чВерсияНастроек":s.Создать(n),"чГромкость2":s.СоздатьДиапазон(l/2,u,l),"лПриглушить":s.Создать(!1),"сНазваниеВарианта":s.Создать("CoolCmd"),"чДлительностьПовтора2":s.СоздатьДиапазон(60,30,300,"J0124"),"чСостояниеЧата":s.СоздатьПеречисление(P,[P,R,j]),"чПоложениеПанелиЧата":s.СоздатьПеречисление(U,[J,U,q,H]),"чШиринаПанелиЧата":s.СоздатьДиапазон(340,100,M),"чВысотаПанелиЧата":s.СоздатьДиапазон(390,100,M),"чРазмерИнтерфейса":s.СоздатьДиапазон(100,75,200),"лАнимацияИнтерфейса":s.Создать(!0),"лМенятьГромкостьКолесом":s.Создать(!0),"лПоказатьСтатистику":s.Создать(!1),"сПредустановкаВыбрана_буферизация":s.Создать("J0127"),"лПредустановкаЗаполнена_буферизация":s.Создать(!1),"кОдновременныхЗагрузок":s.СоздатьДиапазон(0,1,3),"чНачалоВоспроизведения":s.СоздатьДиапазон(0,r,30),"чРазмерБуфера":s.СоздатьДиапазон(0,r,30),"чРастягиваниеБуфера":s.СоздатьДиапазон(0,9,30),"кЗаначка":s.СоздатьДиапазон(0,0,2),"чИнтервалОпроса":s.СоздатьДиапазон(0,a,250,"J0120"),"сПредустановкаВыбрана_оформление":s.Создать("J0122"),"лПредустановкаЗаполнена_оформление":s.Создать(!1),"сЦветФона":s.Создать(""),"сЦветГрадиента":s.Создать("#ffffff"),"сЦветКнопок":s.Создать(""),"сЦветЗаголовка":s.Создать(""),"сЦветВыделения":s.Создать(""),"чПрозрачность":s.СоздатьДиапазон(0,0,80)},d=500;let f=0,h=null;function m(){chrome.runtime.lastError&&(console.error(chrome.runtime.lastError.message),le.ЗавершитьРаботуИПоказатьСообщение("J0212"))}function g(e,t){t&&(chrome.storage.local.clear(m),ue.Вот("[Настройки] Все настройки удалены из хранилища")),chrome.storage.local.set(e,m),ue.Вот(`[Настройки] Настройки записаны в хранилище: ${ue.O(e)}`)}function p(e,t){K(z(e)),(t||0!==Object.keys(e).length)&&(0===f?t?g(e,t):(ue.Вот(`[Настройки] Откладываю сохранение настроек на ${d}мс`),f=setTimeout(v,d),h=e):t?(clearTimeout(f),f=0,h=null,g(e,t)):Object.assign(h,e))}function v(){try{ue.Вот("[Настройки] Завершаю отложенное сохранение"),K(0!==f&&z(h)),g(h,!1),f=0,h=null}catch(e){le.ПойманоИсключение(e)}}function b(e,t){if(void 0===e.чВерсияНастроек){for(let n of Object.keys(e))o.has(n)?t[n]=e[n]:delete e[n];return!0}if(e.чВерсияНастроек>n){for(let t of Object.keys(e))delete e[t];return!0}for(let n of i){let r=e[n.сВыбрана];if(void 0!==r&&r!==n.сНастраиваемая){for(let e of n.амДанные.keys())if(r===e){r=void 0;break}void 0!==r&&(t[n.сВыбрана]=e[n.сВыбрана]=c[n.сВыбрана].пНачальное)}}return e.чВерсияНастроек!==n&&(t.чВерсияНастроек=e.чВерсияНастроек=n,!1)}function y(e){K("string"==typeof e),K(c.hasOwnProperty(e));for(let t of i){const n=t.амДанные.get(c[t.сВыбрана].пТекущее);if(n){const t=n[e];if(void 0!==t)return t}}return c[e].пТекущее}function E(e,t){if(W)return;K("string"==typeof e),K(c[e].ИсправитьЗначение(t)===t);const n={};for(let r of i){const i=r.амДанные.get(c[r.сВыбрана].пТекущее);if(i&&i.hasOwnProperty(e)){if(t===i[e])return;n[r.сВыбрана]=c[r.сВыбрана].пТекущее=r.сНастраиваемая,n[r.сЗаполнена]=c[r.сЗаполнена].пТекущее=!0;for(let e of Object.keys(i))n[e]=c[e].пТекущее=i[e];$(r);break}}c[e].пТекущее!==t&&(n[e]=c[e].пТекущее=t),p(n,!1)}function $(e){const n=t.getElementById(e.сСписок);n.length=0;const r=c[e.сВыбрана].пТекущее;for(let t of e.амДанные.keys())n.add(new Option(V(t),t,t===r,t===r));return c[e.сЗаполнена].пТекущее&&n.add(new Option(V(e.сНастраиваемая),e.сНастраиваемая,e.сНастраиваемая===r,e.сНастраиваемая===r)),K(n.value),n}function w(e){try{for(let t of i)if(t.сСписок===e.target.id)return K(e.target.value),E(t.сВыбрана,e.target.value),void he.ОбработатьСобытие(t.сСобытие);K(!1)}catch(e){le.ПойманоИсключение(e)}}return{"Восстановить":function(){return ue.Вот("[Настройки] Восстанавливаю настройки"),new Promise(function(e,t){chrome.storage.local.get(null,function(n){try{chrome.runtime.lastError?(console.error(chrome.runtime.lastError.message),le.ЗавершитьРаботуИПоказатьСообщение("J0209")):(ue.Вот(`[Настройки] Настройки прочитаны из хранилища: ${ue.O(n)}`),function(e){K(z(e)),K(!c.чВерсияНастроек.пТекущее);const t={},n=b(e,t);for(let n of Object.keys(c))if(e.hasOwnProperty(n)){const r=c[n].ИсправитьЗначение(e[n]);r!==e[n]&&(t[n]=r),c[n].пТекущее=r}else o.has(n)&&(t[n]=c[n].пНачальное),c[n].пТекущее=c[n].пНачальное;p(t,n),function(){for(let e of i)$(e).addEventListener("change",w)}()}(n),e())}catch(e){t(e)}})})},"Сбросить":function(){ue.Окак("[Настройки] Сбрасываю настройки");const t={};for(let e of o)t[e]=c[e].пТекущее;p(t,!0),e.location.reload()},"Экспорт":function(){ue.Окак("[Настройки] Экспортирую настройки"),K(c.чВерсияНастроек.пТекущее);const e={"чВерсияНастроек":n};for(let t of Object.keys(c))o.has(t)||(e[t]=c[t].пТекущее);ue.Вот(`[Настройки] Отобраны настройки для экспорта: ${ue.O(e)}`),function(e,n,r){K("string"==typeof e&&Z(n)&&Z(r));const i=t.createElement("a");i.setAttribute("href",URL.createObjectURL(new Blob([e],{type:n}))),i.setAttribute("download",r),i.dispatchEvent(new MouseEvent("click"))}(JSON.stringify(e),"application/json",V("J0133"))},"Импорт":function(t){if(ue.Окак(`[Настройки] Импортирую настройки из файла ${t.name}`),K(c.чВерсияНастроек.пТекущее),0===t.size||t.size>1e4)return ue.Ой(`[Настройки] Размер файла: ${t.size}`),void alert(V("J0134"));const n=new FileReader;n.addEventListener("loadend",function(){try{if(!Z(n.result))return ue.Ой(`[Настройки] Результат чтения файла: ${n.result}`),void alert(V("J0135")+t.name);let r;ue.Вот(`[Настройки] Настройки прочитаны из файла: ${n.result}`);try{if(!z(r=JSON.parse(n.result)))throw 1;if(b(r,r))throw 2;for(let e of Object.keys(r))c.hasOwnProperty(e)&&(r[e]=c[e].ИсправитьЗначение(r[e]))!==c[e].пНачальное||delete r[e]}catch(e){return ue.Ой(`[Настройки] Поймано исключение во время разбора настроек: ${e}`),void alert(V("J0134"))}for(let e of o)r[e]=c[e].пТекущее;p(r,!0),e.location.reload()}catch(e){le.ПойманоИсключение(e)}}),n.readAsText(t)},"Получить":function(e){return"чМаксРазмерБуфера"===e?Math.max(y("чНачалоВоспроизведения"),y("чРазмерБуфера")):y(e)},"Изменить":E,"ПолучитьПараметрыНастройки":function(e){return K("string"==typeof e),K(c.hasOwnProperty(e)),c[e]},"ПолучитьДанныеДляОтчета":function(){const e={};for(let t of Object.keys(c))c[t].пТекущее!==c[t].пНачальное&&(e[t]=c[t].пТекущее);return e},"Остановить":function(){0!==f&&(clearTimeout(f),v())}}})(),be=(()=>{const n=3,r=30,i=30,a=40,o=150,s=.5,c=1,u=2,l=1.5,d=.5,f=100,h=.85,m=.2,g=300,E=5;var $,w,_,N=0,x=0,T=0,L=-1/0,A=1/0,C=null,F=null,B=null,M=null,D=null,O=null,X=null,P=0,R=0,j=0,J=0,U=0,q=0,H=0,Y=0,W=0,V=0,z=0;function Z(e){return e>=o}function ee(e){return 0===e||e>2}function te(e){return e>=c}function ne(e){return e<l||e>=ve.Получить("чМаксРазмерБуфера")+ve.Получить("чРастягиваниеБуфера")*d}function re(e,n,r){K(n>0&&r>=0),this._узПоказать=t.getElementById(e),this._мчИстория=new Array(n),this._млВыделить=new Array(n),this._чТочность=r,this._Очистить()}function ie(e,n,r){var i="string"==typeof e?t.getElementById(e):e;return i.classList.toggle("статистика-выделить",r),i.textContent=n,i}function ae(){try{t.getElementById("статистика-длительностьпросмотра").textContent=fe.ПеревестиСекундыВСтроку(e.performance.now()/1e3,!0);var r=_e.ПолучитьКоличествоПропущенныхКадров();ie("статистика-пропущено",r.droppedVideoFrames,r.droppedVideoFrames>=f).nextElementSibling.nextElementSibling.textContent=r.totalVideoFrames;var i=0,a=0,o=0,s=0,c=0;for(var l of G)switch(l.чОбработка){case p:++i,a+=l.чДлительность;break;case v:case b:o+=l.чДлительность;break;case y:++s,c+=l.чДлительность;break;default:K(!1)}var d=_e.ПолучитьЗаполненностьБуфера(),h=ie("статистика-очередь",a.toFixed(1),i>T);(h=h.nextElementSibling.nextElementSibling).textContent=o.toFixed(1),ie(h=h.nextElementSibling,c.toFixed(1),s>=u),ie(h=h.nextElementSibling,d.чНеПросмотрено.toFixed(1),ne(d.чНеПросмотрено)),(h=h.nextElementSibling.nextElementSibling).textContent=d.чПросмотрено.toFixed(1),[k,S,I].includes(Ie.ПолучитьСостояние())&&(w=Math.min(w,d.чНеПросмотрено),0===(_=(_+1)%n)&&(X.ДобавитьЧисло(w,ne,ne),w=1/0))}catch(e){le.ПойманоИсключение(e)}}function oe(){return 0!==N}return re.prototype.Освободить=function(){this._узПоказать.textContent="",this._узПоказать=null},re.prototype._Очистить=function(){this._кЗаполнено=0,this._чИндекс=-1;var e=t.createDocumentFragment();e.appendChild(t.createElement("td")).className="анализ-минимум",e.appendChild(t.createElement("td")).textContent=" < ",e.lastChild.className="статистика-символ",e.appendChild(t.createElement("td")).className="анализ-среднее",e.appendChild(t.createElement("td")).textContent=" < ",e.lastChild.className="статистика-символ",e.appendChild(t.createElement("td")).className="анализ-максимум";for(var n=0;n<this._мчИстория.length;++n)e.appendChild(t.createElement("td")).setAttribute("class","анализ-история статистика-подробно");this._узПоказать.textContent="",this._узПоказать.appendChild(e)},re.prototype._ВСтроку=function(e){return Number.isFinite(e)?e.toFixed(this._чТочность):" "},re.prototype.Очистить=function(){0!==this._кЗаполнено&&this._Очистить()},re.prototype.ПолучитьПоследнееЧисло=function(e){return 0===this._кЗаполнено?e:this._мчИстория[this._чИндекс]},re.prototype.ДобавитьЧисло=function(e,t,n){var r=Boolean("function"==typeof t?t(e):t);0!==this._кЗаполнено&&this._узПоказать.children[5+this._чИндекс].classList.add("статистика-подробно"),this._кЗаполнено!==this._мчИстория.length&&++this._кЗаполнено,++this._чИндекс===this._мчИстория.length&&(this._чИндекс=0),this._мчИстория[this._чИндекс]=e,this._млВыделить[this._чИндекс]=r;for(var i=1/0,a=!1,o=-1/0,s=!1,c=0,u=0,l=0;l<this._кЗаполнено;++l)Number.isFinite(this._мчИстория[l])&&((this._мчИстория[l]<i||this._мчИстория[l]===i&&this._млВыделить[l])&&(i=this._мчИстория[l],a=this._млВыделить[l]),(this._мчИстория[l]>o||this._мчИстория[l]===o&&this._млВыделить[l])&&(o=this._мчИстория[l],s=this._млВыделить[l]),c+=this._мчИстория[l],++u);if(0===u){c=NaN;var d=!1}else{c/=u;d=Boolean("function"==typeof n?n(c):n)}return ie(this._узПоказать.children[0],this._ВСтроку(i),a),ie(this._узПоказать.children[2],this._ВСтроку(c),d),ie(this._узПоказать.children[4],this._ВСтроку(o),s),ie(this._узПоказать.children[5+this._чИндекс],this._ВСтроку(e),r).classList.remove("статистика-подробно"),c},he.ДобавитьОбработчик("список-выбранварианттрансляции",function(e,n){const r=n[0],i=n[1];var a;r&&(t.getElementById("статистика-сервер").textContent=(a=r[i].сАбсолютныйАдресСпискаСегментов,new URL(a).host))}),he.ДобавитьОбработчик("проигрыватель-переполненбуфер",function(e,t){++Y,W+=t,oe()&&(ie("статистика-переполнено",Y,!0).nextElementSibling.nextElementSibling.textContent=W.toFixed(1))}),{"ОкноПоказано":oe,"ПоказатьОкно":function(){oe()||(C=new re("статистика-интервалобновления",r,0),F=new re("статистика-сегментовдобавлено",r,0),B=new re("статистика-секунддобавлено",r,1),M=new re("статистика-толщинасегмента",i,1),D=new re("статистика-толщинаканала",i,1),O=new re("статистика-ожиданиеответа",i,1),X=new re("статистика-непросмотрено",a,1),$=NaN,w=1/0,_=0,ie("статистика-забраковано",j,0!==j),ie("статистика-потерьвидео",J,0!==J),ie("статистика-потерьзвука",U,0!==U),t.getElementById("статистика-исходных").textContent=R,ie("статистика-незагружено",q,0!==q).nextElementSibling.nextElementSibling.textContent=H,ie("статистика-переполнено",Y,0!==Y).nextElementSibling.nextElementSibling.textContent=W.toFixed(1),ie("статистика-исчерпано",V,V>=E),N=setInterval(ae,1e3/n),ae(),ge.ДобавитьОбработчик("статистика",null).removeAttribute("hidden"),ve.Изменить("лПоказатьСтатистику",!0))},"СкрытьОкно":function(){if(oe()){for(var e of(clearInterval(N),N=0,t.getElementById("статистика").setAttribute("hidden",""),C.Освободить(),C=null,F.Освободить(),F=null,B.Освободить(),B=null,M.Освободить(),M=null,D.Освободить(),D=null,O.Освободить(),O=null,X.Освободить(),X=null,t.querySelectorAll("[data-очистить]")))e.textContent="";ve.Изменить("лПоказатьСтатистику",!1)}},"ОбновитьЗначение":ie,"ОчиститьИсторию":function(){null!==C&&(C.Очистить(),F.Очистить(),B.Очистить(),M.Очистить(),D.Очистить(),O.Очистить(),X.Очистить(),$=NaN,w=1/0,_=0),ie("статистика-незагружено",q=0,!1).nextElementSibling.nextElementSibling.textContent=H=0,ie("статистика-переполнено",Y=0,!1).nextElementSibling.nextElementSibling.textContent=(W=0).toFixed(1),ie("статистика-исчерпано",V=0,!1)},"ПолучитьTargetDuration":function(){return x},"ПолучитьДлительностьКадраВСекундах":function(){return{"чМинимальная":Math.max(17,L)/1e3,"чМаксимальная":Math.min(40,A)/1e3}},"ПолучитьДанныеДляОтчета":function(){return{"ОкноПоказано":oe(),"Сервер":t.getElementById("статистика-сервер").textContent,"ПараметрыВидео":t.getElementById("статистика-разрешениевидео").textContent+" "+t.getElementById("статистика-сжатиевидео").textContent,"ПараметрыЗвука":t.getElementById("статистика-сжатиезвука").textContent,"ВсегоСкачано":P,"Забраковано":j,"ПотерьВидео":J,"ПотерьЗвука":U,"ОшибокЗагрузки":q,"НезагруженныхСегментов":H,"ПереполненийБуфера":Y,"ПропущеноВБуфере":W,"ИсчерпанийБуфера":V,"ИсчерпанийБуфераДосрочно":z}},"СкачаноНечто":function(e){Number.isFinite(e)&&(P+=e,oe()&&(t.getElementById("статистика-скачано").textContent=(P/1024/1024).toFixed()))},"РазобранСписокСегментов":function(e,n,r){if(oe()){var i=t.getElementById("статистика-список");i.textContent=`${n} × ${(r/n).toFixed(1)} = ${r.toFixed(1)}`,ie(i.nextElementSibling.nextElementSibling,e,e!==x)}x=e,T=n},"ДобавленыСегментыВОчередь":function(t,n){if(oe()){var r=e.performance.now();C.ДобавитьЧисло((r-$)/x/10,Z,Z),$=r;var i=F.ДобавитьЧисло(t,ee,ee);B.ДобавитьЧисло(n,n/t<x*s,function(e){return e/i<x*s})}},"ЗагруженСегмент":function(e,t,n,r){if(oe()){var i=M.ДобавитьЧисло(8*e/1e6/t);n/=1e3,D.ДобавитьЧисло(8*e/1e6/n,n>t,function(e){return e<i}),O.ДобавитьЧисло(r/1e3,te,te)}},"НеЗагруженыСегменты":function(e){K(e>0),++q,H+=e,oe()&&(ie("статистика-незагружено",q,!0).nextElementSibling.nextElementSibling.textContent=H)},"ОтосланИсходныйСегмент":function(){++R,oe()&&(t.getElementById("статистика-исходных").textContent=R)},"ПолученПреобразованныйСегмент":function(e){var n=oe(),r=e.пДанные;if(e.лРазрыв){t.getElementById("статистика-разрешениевидео").textContent=`${r.чШиринаКартинки}x${r.чВысотаКартинки}`;var i="H.264"+` ${function(e,t){switch(e){case 66:return 0==(64&t)?"Baseline":"Constrained Baseline";case 77:return"Main";case 88:return"Extended";case 100:switch(12&t){case 8:return"Progressive High";case 12:return"Constrained High"}return"High";case 110:return 0==(16&t)?"High 10":"High 10 Intra";case 122:return 0==(16&t)?"High 4:2:2":"High 4:2:2 Intra";case 244:return 0==(16&t)?"High 4:4:4 Predictive":"High 4:4:4 Intra";case 44:return"CAVLC 4:4:4 Intra"}return ue.Ой(`[Статистика] Неизвестный профиль H.264 ProfileIndication=${e} ConstraintSetFlag=${t}`),`P${e}C${t}`}(r.nProfileIndication,r.nConstraintSetFlag)}`+` L${(r.nLevelIndication/10).toFixed(1)}`+` RF${r.nMaxNumberReferenceFrames}`;-1!==r.чДиапазон&&(i+=0===r.чДиапазон?" 16-235":" 0-255"),r.лЧересстрочное&&(i+=" чересстрочное"),0!==r.чЧастотаКадров&&(i+=` ${r.чЧастотаКадров<0?"≈":""}${Math.abs(r.чЧастотаКадров).toFixed(2)} к/с`),t.getElementById("статистика-сжатиевидео").textContent=i,t.getElementById("статистика-сжатиезвука").textContent=["AAC-Main","AAC-LC","AAC-SSR","AAC-LTP"][r.nAudioObjectType-1]+` ${r.чЧастотаДискретизации} Гц`+` ${r.чКоличествоКаналов} канал.`}if(Number.isFinite(r.чСредняяДлительностьВидеоСемпла)){L=r.чМинДлительностьВидеоСемпла,A=r.чМаксДлительностьВидеоСемпла,K(L<=A);var a=r.чСредняяДлительностьВидеоСемпла/r.чМаксДлительностьВидеоСемпла,o=r.чМаксДлительностьВидеоСемпла-r.чСредняяДлительностьВидеоСемпла;a<=m&&o>=g&&(ue.Ой(`[Статистика] Превышено отклонение длительности кадра в сегменте ${e.чНомер}`+` СредняяДлительностьКадра=${ue.F0(r.чСредняяДлительностьВидеоСемпла)}мс`+` АбсолютноеОтклонение=${ue.F0(o)}мс`+` ОтносительноеОтклонение=${ue.F2(a)}`),r.лПотериВидео=!0)}n&&(Number.isFinite(r.чСредняяДлительностьВидеоСемпла)&&ie("статистика-частотакадров",`@${(1e3/r.чСредняяДлительностьВидеоСемпла).toFixed(0)}`+` −${(100-r.чСредняяДлительностьВидеоСемпла/r.чМаксДлительностьВидеоСемпла*100).toFixed()}%`+` +${(r.чСредняяДлительностьВидеоСемпла/r.чМинДлительностьВидеоСемпла*100-100).toFixed()}%`,a<=h),Q(r.чБитрейтЗвука)&&(t.getElementById("статистика-битрейтзвука").textContent=`${r.чБитрейтЗвука.toFixed()} кбит/с`),Q(r.чПреобразованЗа)&&(t.getElementById("статистика-преобразованоза").textContent=r.чПреобразованЗа.toFixed())),r.лПотериВидео&&(++J,n&&ie("статистика-потерьвидео",J,!0)),r.лПотериЗвука&&(++U,n&&ie("статистика-потерьзвука",U,!0)),r.лЗабраковано&&(++j,n&&ie("статистика-забраковано",j,!0))},"ИсчерпанБуферПроигрывателя":function(e){++V,e&&++z,oe()&&ie("статистика-исчерпано",V,V>=E)}}})(),ye=(()=>{var n,r=null;function i(e){try{e.source===r.contentWindow&&e.origin===Le.ПолучитьАдресПанелиЧата()[0]&&"ВставитьСторонниеРасширения?"===e.data&&(ue.Вот("[Чат] Получен запрос на вставку сторонних расширений"),chrome.management.getAll(function(t){chrome.runtime.lastError&&le.ЗавершитьРаботуИОтправитьОтчет(`Не удалось получить список расширений. ${chrome.runtime.lastError.message}`);try{const r={"сЗапрос":e.data,"сСторонниеРасширения":""};for(var n of t)if(n.enabled)switch(n.id){case"ajopnjidmegmdimjlfnijceegpefgped":case"deofbbdfofnmppcjbhjibgodpcdchjii":r.сСторонниеРасширения+="BTTV ";break;case"fadndhdgpmmaapbmfcknlfgcflmmmieb":case"djkpepcignmpfblhbfpmlhoindhndkdj":r.сСторонниеРасширения+="FFZ ";break;case"aiimboljphncldaakcnapfolgnjonlea":r.сСторонниеРасширения+="FFZAP "}ue.Вот(`[Чат] Послан ответ на вставку сторонних расширений: ${ue.O(r)}`),e.source.postMessage(r,e.origin)}catch(e){ue.Ой(`[Чат] Поймано исключение во время посылки ответа: ${e}`)}}))}catch(e){le.ПойманоИсключение(e)}}function a(){switch(ve.Получить("чПоложениеПанелиЧата")){case U:t.body.classList.add("чатсправа"),t.body.classList.remove("чатвверху","чатвнизу","чатслева"),r.setAttribute("width",ve.Получить("чШиринаПанелиЧата")),r.removeAttribute("height");break;case q:t.body.classList.add("чатвнизу"),t.body.classList.remove("чатвверху","чатсправа","чатслева"),r.setAttribute("height",ve.Получить("чВысотаПанелиЧата")),r.removeAttribute("width");break;case H:t.body.classList.add("чатслева"),t.body.classList.remove("чатвверху","чатсправа","чатвнизу"),r.setAttribute("width",ve.Получить("чШиринаПанелиЧата")),r.removeAttribute("height");break;case J:t.body.classList.add("чатвверху"),t.body.classList.remove("чатсправа","чатвнизу","чатслева"),r.setAttribute("height",ve.Получить("чВысотаПанелиЧата")),r.removeAttribute("width");break;default:K(!1)}}function o(){try{r&&!r.src&&(r.src=Le.ПолучитьАдресПанелиЧата().join(""))}catch(e){le.ПойманоИсключение(e)}}function s(){var n,c=ve.Получить("чСостояниеЧата");(ue.Окак(`[Чат] Новое состояние чата: ${c}`),t.body.classList.toggle("показатьчат",c===j),c===R||c===j)?null===r&&(e.addEventListener("message",i),(r=t.createElement("iframe")).id="чат",void 0===s.чТаймер&&(n=Math.round(1e3-e.performance.now()))>0?s.чТаймер=setTimeout(o,n):o(),a(),t.getElementById("размерчата").insertAdjacentElement("afterend",r)):null!==r&&(e.removeEventListener("message",i),r.remove(),r=null);Fe()}function c(e){try{e.preventDefault();var t=ve.Получить("чПоложениеПанелиЧата");switch(t){case U:t=q;break;case q:t=H;break;case H:case J:t=U;break;default:K(!1)}ve.Изменить("чПоложениеПанелиЧата",t),a()}catch(e){le.ПойманоИсключение(e)}}function u(e,i,a,o,s,c){const u=ve.Получить("чПоложениеПанелиЧата"),l=u===U||u===H,d=u===H||u===J;switch(e){case 1:n=l?Number.parseInt(getComputedStyle(r).width,10):Number.parseInt(getComputedStyle(r).height,10),ue.Окак(`[Чат] Начальный размер чата: ${n}`);break;case 2:if(l){if(s){const e=Number.parseInt(getComputedStyle(t.getElementById("проигрывательичат")).width,10)-Number.parseInt(getComputedStyle(t.getElementById("проигрыватель")).minWidth,10);r.width=Math.max(Math.min(d?n-a:n+a,e),0)}}else if(c){const e=Number.parseInt(getComputedStyle(t.getElementById("проигрывательичат")).height,10);Number.parseInt(getComputedStyle(t.getElementById("проигрыватель")).minHeight,10),r.height=Math.max(Math.min(d?n-o:n+o,e),0)}break;case 3:l?ve.Изменить("чШиринаПанелиЧата",Number.parseInt(getComputedStyle(r).width,10)):ve.Изменить("чВысотаПанелиЧата",Number.parseInt(getComputedStyle(r).height,10));break;default:K(!1)}}return{"Восстановить":function(){s(),ge.ДобавитьОбработчик("размерчата",u).addEventListener("contextmenu",c)},"ПереключитьПанель":function(){ve.Изменить("чСостояниеЧата",ve.Получить("чСостояниеЧата")===j?P:j),s()},"СкрытьПанель":function(){ve.Изменить("чСостояниеЧата",R),s()},"ОткрытьОкно":function(){},"ЗакрытьОкно":function(){}}})(),Ee=(()=>{function r(e){var t=/^(\d+)\.(\d+)\.(\d+)(?:\.(\d+))?$/.exec(e);return t[1]|=0,t[2]|=0,t[3]|=0,t[4]|=0,K(t[1]>=2e3&&t[1]<=2050),K(t[2]>=1&&t[2]<=12),K(t[3]>=1&&t[3]<=31),K(t[4]>=0&&t[4]<=9),Date.UTC(t[1],t[2]-1,t[3],0,0,0,t[4])}function i(n,i){K(Q(n)&&n>=0||Z(n)),t.getElementById("новости-текст").textContent="";var o=!1,s="number"==typeof n?n:r(n);for(var c of e.г_мНовости)switch(c[0]){case"2000.2.2":a(c,0);break;case"2000.1.1":i&&(o=!0,a(c,0));break;default:const e=r(c[0]);if("number"==typeof n){if(--s<0)continue}else if(s>=e)continue;o=!0,a(c,e)}return o}function a(e,n){const r=t.getElementById("новости-текст");for(var i="",a=2;a<e.length;++a)i+=fe.GetText(e[a]);r.insertAdjacentHTML("afterbegin",i);const o=t.createElement("h4");o.textContent=0!==n?`${new Date(n).toLocaleDateString()} · ${V(e[1])}`:V(e[1]),r.insertBefore(o,r.firstChild),r.insertBefore(t.createElement("hr"),o)}function o(e,n){"новости"===n&&t.getElementById("переключитьновости").classList.remove("непрочитано")}function s(e,r){"новости"===r.сИдОкна&&r.лКнопкой&&(ve.Изменить("сПредыдущаяВерсия",n),t.getElementById("переключитьновости").setAttribute("hidden",""),he.УдалитьОбработчик("окна-открытоокно",o),he.УдалитьОбработчик("окна-закрытоокно",s))}return{"Запустить":function(){const e=ve.Получить("сПредыдущаяВерсия");if(e!==n){if("2000.1.1"===e)var r=i(0,!0);else r=i(e,!1);r?function(){const e=t.getElementById("переключитьновости");e.removeAttribute("hidden"),e.classList.add("непрочитано"),he.ДобавитьОбработчик("окна-открытоокно",o),he.ДобавитьОбработчик("окна-закрытоокно",s)}():ve.Изменить("сПредыдущаяВерсия",n)}},"ОткрытьСправку":function(){"новости"!==we.ПолучитьОткрытоеОкно()&&(t.getElementById("переключитьновости").hasAttribute("hidden")&&i(3,!0),we.ОткрытьОкно("новости"))}}})(),$e=(()=>{var e,n=0,r=0;function i(e){return te(e,n,r)}function a(e){try{if(Ie.ПолучитьСостояние()===N){const t=e.currentTarget.getBoundingClientRect(),a=getComputedStyle(e.currentTarget),o=Math.round(t.left+Number.parseFloat(a.paddingLeft)),s=Math.round(t.right-Number.parseFloat(a.paddingRight)),c=i((e.clientX+1-o)/(s-o)*(r-n)+n);ue.Окак(`[Шкала] Перематываю до ${c}`),_e.ПеремотатьПовторДо(c)}}catch(e){le.ПойманоИсключение(e)}}return{"ЗадатьНачалоИКонец":function(e,i){K(e<=i),n=e,r=i,t.getElementById("шкала").addEventListener("click",a)},"ЗадатьПросмотрено":function(a){e=i(a),K(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(e)),t.getElementById("шкала-просмотрено").style.transform=`scaleX(${((e-n)/(r-n)).toFixed(4)})`},"ПолучитьНачало":function(){return n},"ПолучитьКонец":function(){return r}}})(),we=(()=>{function e(){const e=t.body.getAttribute("data-открытоеокно");return e||""}function n(n,r){K("string"==typeof n&&"boolean"==typeof r),n&&n===e()&&(t.getElementById(n).classList.remove("открыто"),t.body.removeAttribute("data-открытоеокно"),he.ОбработатьСобытие("окна-закрытоокно",{"сИдОкна":n,"лКнопкой":r}))}function r(r){K(Z(r));const i=e();i!==r&&(n(i,!1),t.getElementById(r).classList.add("открыто"),t.body.setAttribute("data-открытоеокно",r),he.ОбработатьСобытие("окна-открытоокно",r))}return he.ДобавитьОбработчик("управление-щелчок",function(i,a){const o=e();if(o&&t.getElementById(o).contains(a.target))return;const s=a.target.getAttribute("data-переключитьокно");n(o,o===s),s&&o!==s&&r(s)}),{"ПолучитьОткрытоеОкно":e,"ПереключитьОкно":function(t){K(Z(t));const i=e();n(i,i===t),i!==t&&r(t)},"ОткрытьОкно":r}})();{function ke(e,n){e.removeEventListener("mouseleave",Se),t.body.classList.toggle("кнопкаименю-безанимации",n),e.classList.remove("открыто")}function Se(e){try{ke(e.target,!1)}catch(e){le.ПойманоИсключение(e)}}he.ДобавитьОбработчик("управление-щелчок",function(e,n){const r=n.target;if(r.classList.contains("кнопкаименю-кнопка")){const e=r.parentNode;e.classList.contains("открыто")?ke(e,!1):((e=e).addEventListener("mouseleave",Se),t.body.classList.remove("кнопкаименю-безанимации"),e.classList.add("открыто"))}else r.classList.contains("пунктменю")&&r.hasAttribute("tabindex")&&ke(r.parentNode.parentNode,!0);var i})}const Ie=(()=>{const n=5,r=5,i=4e3,a=10,o=180,s=300,c=1500,p="• • •",v={da:"Dansk",de:"Deutsch",en:"English","en-gb":"English (UK)",es:"Español","es-mx":"Español (Latinoamérica)",fr:"Français",it:"Italiano",hu:"Magyar",nl:"Nederlands",no:"Norsk",pl:"Polski",pt:"Português","pt-br":"Português (Brasil)",sk:"Slovenčina",fi:"Suomi",sv:"Svenska",vi:"Tiếng Việt",tr:"Türkçe",cs:"Čeština",el:"Ελληνικά",bg:"Български",ru:"Русский",ar:"العربية",th:"ภาษาไทย",zh:"中文","zh-cn":"简体中文","zh-tw":"繁體中文","zh-hk":"中文（香港）",ja:"日本語",ko:"한국어",hi:"हिंदी",ro:"Română",ase:"American Sign Language",asl:"American Sign Language"};var b,T,F,B,M,D,P,R,j,J,U,q=0,H=0,Y=0,z=0;if(t.exitFullscreen)var Z="fullscreenElement",ee="requestFullscreen",te="exitFullscreen",ne="fullscreenchange";else Z="webkitFullscreenElement",ee="webkitRequestFullscreen",te="webkitExitFullscreen",ne="webkitfullscreenchange";function re(){var e=!!t[Z];ue.Окак(`[Управление] Полноэкранный режим: ${e}`),Me("переключитьполноэкранный",e)}function ae(){try{re()}catch(e){le.ПойманоИсключение(e)}}function oe(){$e(!0),t[Z]?me():(ue.Вот("[Управление] Вход в полноэкранный режим"),t.getElementById("проигрыватель")[ee]())}function me(){ue.Вот("[Управление] Выход из полноэкранного режима"),t[te]()}function ge(){let e=!1;return 0===z?(e="none"===getComputedStyle(t.getElementById("глаз")).cursor,t.body.classList.remove("автоскрытие","панель-безанимации")):clearTimeout(z),z=setTimeout(ke,i),e}function $e(n){0!==z&&(clearTimeout(z),z=0,t.body.classList.add("автоскрытие"),t.body.classList.toggle("панель-безанимации",n),n&&(H=Y=e.performance.now()))}function ke(){try{$e(!1)}catch(e){le.ПойманоИсключение(e)}}function Se(n){try{t.removeEventListener("mousemove",Se),function(t){if(!(R===t.screenX&&j===t.screenY||J===t.clientX&&U===t.clientY)){R=t.screenX,j=t.screenY,J=t.clientX,U=t.clientY;var n=e.performance.now();n-Y>=s?H=Y=n:(Y=n,n-H>=o&&ge())}}(n),setTimeout(Ie,1e3/a)}catch(e){le.ПойманоИсключение(e)}}function Ie(){try{t.addEventListener("mousemove",Se)}catch(e){le.ПойманоИсключение(e)}}function Te(){ve.Получить("лМенятьГромкостьКолесом")?(t.addEventListener("wheel",Ae),t.addEventListener("mousedown",Ce)):(t.removeEventListener("wheel",Ae),t.removeEventListener("mousedown",Ce))}function Ae(e){try{e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||function(e,n){for(var r=t.elementFromPoint(e,n);r;r=r.parentElement)if(ie(r))return!0;return!1}(e.clientX,e.clientY)||(ue.Вот(`[Управление] Движение колеса deltaY=${e.deltaY} deltaMode=${e.deltaMode}`),e.preventDefault(),e.deltaY<0&&Pe(!1,Math.min(ve.Получить("чГромкость2")+m,l)),e.deltaY>0&&Pe(!1,Math.max(ve.Получить("чГромкость2")-g,u)))}catch(e){le.ПойманоИсключение(e)}}function Ce(e){try{e.button!==X||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||function(e){var t=e.target;do{if("A"===t.nodeName)return!0}while(t=t.parentElement);return!1}(e)||(e.preventDefault(),Pe(!ve.Получить("лПриглушить")))}catch(e){le.ПойманоИсключение(e)}}function Fe(){}function Be(){t.body.classList.toggle("санимацией",ve.Получить("лАнимацияИнтерфейса"))}function Me(e,n){var r="string"==typeof e?t.getElementById(e):e,i=r.getElementsByTagName("use"),a=Number(n);K(a>=0&&a<i.length);for(var o=0;o<i.length;++o)if(o===a){var s=i[o].getAttributeNS("http://www.w3.org/1999/xlink","title");s&&r.setAttribute("title",V(s)),i[o].removeAttribute("display")}else i[o].setAttribute("display","none");return r}function De(){b!==_&&b!==N?(ue.Окак("[Управление] Останавливаю просмотр трансляции"),Ne.Остановить(),xe.Остановить(),G.Очистить(),G.Добавить(new se(y,N)),_e.ДобавитьСледующийСегмент()):(ue.Окак("[Управление] Начинаю просмотр трансляции"),G.Очистить(),_e.Перезагрузить(E),Ne.Запустить())}function Oe(){be.ОкноПоказано()?be.СкрытьОкно():be.ПоказатьОкно()}function Xe(e){try{Pe(!1,Number.parseFloat(e.target.value))}catch(e){le.ПойманоИсключение(e)}}function Pe(e,t){ve.Изменить("лПриглушить",e),void 0!==t&&ve.Изменить("чГромкость2",Math.round(t)),_e.ПрименитьНастройкиЗвука(),Re(),ge()}function Re(){t.getElementById("громкость").value=ve.Получить("чГромкость2"),Me("переключитьприглушить",ve.Получить("лПриглушить"))}function je(e){at({"чПодписка":x})&&Le.ИзменитьПодпискуЗрителяНаКанал(e)}function Je(n){try{if(ge()||n.button!==O)return;const r=n.target,i=r.id||r.name||r.parentNode.id||r.parentNode.name;switch(n.сПозывной=i,he.ОбработатьСобытие("управление-щелчок",n),i){case"переключитьтрансляцию":De();break;case"глаз":case"переключитьпаузу":b===N&&_e.ПереключитьПаузу();break;case"переключитьприглушить":Pe(!ve.Получить("лПриглушить"));break;case"переключитьчат":ye.ПереключитьПанель();break;case"размерчата":ye.СкрытьПанель();break;case"создатьклип":Le.СоздатьКлип();break;case"переключитьполноэкранный":oe();break;case"одновременныхзагрузок":K(r.checked),ve.Изменить("кОдновременныхЗагрузок",Number.parseInt(r.getAttribute("value"),10)),be.ОчиститьИсторию();break;case"заначка":K(r.checked),ve.Изменить("кЗаначка",Number.parseInt(r.getAttribute("value"),10)),be.ОчиститьИсторию();break;case"менятьгромкостьколесом":K(r.checked),ve.Изменить("лМенятьГромкостьКолесом",!!Number.parseInt(r.getAttribute("value"),10)),Te();break;case"анимацияинтерфейса":K(r.checked),ve.Изменить("лАнимацияИнтерфейса",!!Number.parseInt(r.getAttribute("value"),10)),Be();break;case"переключитьстатистику":case"позиция-текст":Oe();break;case"открытьсправку":Ee.ОткрытьСправку();break;case"оставитьотзыв":le.ОставитьОтзыв();break;case"поддержать":e.open("http://coolcmd.tk/tw5/donate.html");break;case"экспортнастроек":ve.Экспорт();break;case"импортнастроек":const a=t.getElementById("выборфайладляимпортанастроек");a.value="",a.click();break;case"сброситьнастройки":ve.Сбросить();break;case"проверкацвета":!function(e){t.body.classList.toggle("проверкацвета")?(t.body.classList.toggle("проверкацветафон",!e.shiftKey),Ee.ОткрытьСправку()):t.body.classList.remove("проверкацветафон")}(n);break;case"типтрансляции":K("BUTTON"===r.nodeName),r.disabled||e.location.assign(r.getAttribute("data-адрес"));break;case"зритель-подписаться":je(C);break;case"зритель-отписаться":je(L);break;case"зритель-уведомлять":je(C);break;case"зритель-неуведомлять":je(A)}}catch(e){le.ПойманоИсключение(e)}}function Ue(e){try{ge(),"глаз"===e.target.id&&e.preventDefault()}catch(e){le.ПойманоИсключение(e)}}function qe(e){try{e.button===O&&(e.preventDefault(),oe())}catch(e){le.ПойманоИсключение(e)}}function He(e){try{const t=65536,i=1<<17,a=1<<18,o=1<<19;if(W)return;const s="keydown"===e.type,c=s&&!e.repeat;switch(e.keyCode+e.shiftKey*t+e.ctrlKey*i+e.altKey*a+e.metaKey*o){case 13:c&&oe();break;case 86:c&&we.ПереключитьОкно("настройки");break;case 73:c&&we.ПереключитьОкно("канал");break;case 83:c&&Oe();break;case 112:c&&Ee.ОткрытьСправку();break;case 67:case 45:c&&ye.ПереключитьПанель();break;case 32:c&&(De(),ge());break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:c&&b===N&&(Ve((48===e.keyCode?58:e.keyCode)-53),ge());break;case 187:case 107:c&&b===N&&(Ve(1/0),ge());break;case 189:case 109:c&&b===N&&(Ve(-1/0),ge());break;case 90:case 12:c&&b===N&&(_e.ПереключитьПаузу(),ge());break;case 37:s&&b===N&&(ue.Окак(`[Управление] Перематываю на -${n}с`),_e.ПеремотатьПовторНа(!1,-n),ge());break;case 39:s&&b===N&&(ue.Окак(`[Управление] Перематываю на +${n}с`),_e.ПеремотатьПовторНа(!1,n),ge());break;case 37+t:s&&b===N&&(ue.Окак(`[Управление] Перематываю на -${r} кадров`),_e.ПеремотатьПовторНа(!0,-r),ge());break;case 39+t:s&&b===N&&(ue.Окак("[Управление] Перематываю на +1 кадр"),_e.ПеремотатьПовторНа(!0,1),ge());break;case 38:s&&Pe(!1,Math.min(ve.Получить("чГромкость2")+d,l));break;case 40:s&&Pe(!1,Math.max(ve.Получить("чГромкость2")-f,u));break;case 33:c&&Pe(!1);break;case 34:c&&Pe(!0);break;case 77:c&&Pe(!ve.Получить("лПриглушить"));break;case 88+a:c&&Le.СоздатьКлип();break;default:return}e.stopPropagation(),e.preventDefault()}catch(e){le.ПойманоИсключение(e)}}function Ye(){We(),be.ОчиститьИсторию()}function We(){t.querySelector(`input[name="одновременныхзагрузок"][value="${ve.Получить("кОдновременныхЗагрузок")}"]`).checked=!0,t.querySelector(`input[name="заначка"][value="${ve.Получить("кЗаначка")}"]`).checked=!0,t.querySelector(`input[name="менятьгромкостьколесом"][value="${Number(ve.Получить("лМенятьГромкостьКолесом"))}"]`).checked=!0,t.querySelector(`input[name="анимацияинтерфейса"][value="${Number(ve.Получить("лАнимацияИнтерфейса"))}"]`).checked=!0,T?(T.Обновить(),F.Обновить(),B.Обновить(),M.Обновить(),D.Обновить(),P.Обновить()):(T=new ce("чНачалоВоспроизведения",.5,1,"началовоспроизведения"),F=new ce("чРазмерБуфера",.5,1,"размербуфера"),B=new ce("чРастягиваниеБуфера",.5,1,"растягиваниебуфера"),M=new ce("чИнтервалОпроса",10,0,"интервалопроса"),D=new ce("чДлительностьПовтора2",30,0,"длительностьповтора"),T.ПослеИзменения=F.ПослеИзменения=B.ПослеИзменения=M.ПослеИзменения=be.ОчиститьИсторию,(P=new ce("чРазмерИнтерфейса",1,0,"размеринтерфейса")).ПослеИзменения=Fe)}function Ge(e,t){Me("переключитьпаузу",t)}function Ke(){var e=t.getElementById("скорость");ue.Окак(`[Управление] Выбрана скорость ${e.value}`);var n=Number.parseFloat(e.value);return K(Number.isFinite(n)&&n>=0),n}function Ve(e){K(Q(e));var n=t.getElementById("скорость");if(K(n.selectedIndex>=0),e===-1/0||e===1/0)var r=n.selectedIndex-Math.sign(e);else r=n.querySelector('option[value="1.00"]').index-e;r>=0&&r<n.length&&r!==n.selectedIndex&&(n.selectedIndex=r,_e.ЗадатьСкоростьПовтора(Ke()))}function ze(e){try{b===N&&_e.ЗадатьСкоростьПовтора(Ke())}catch(e){le.ПойманоИсключение(e)}}function Qe(e){try{ue.Окак(`[Управление] Выбран вариант ${e.target.value}`),K(e.target.value),ve.Изменить("сНазваниеВарианта",e.target.value),_e.Перезагрузить(k),xe.Остановить(),G.Очистить(),be.ОчиститьИсторию(),Ne.ИзменитьВариантТрансляции()}catch(e){le.ПойманоИсключение(e)}}function Ze(e){try{1===e.target.files.length&&ve.Импорт(e.target.files[0])}catch(e){le.ПойманоИсключение(e)}}function et(e,n){const r=n[0],i=n[1],a=t.getElementById("варианттрансляции");if(a.length=0,r)for(var o=0;o<r.length;++o){var s=et.ПЕРЕВОД_ВАРИАНТОВ[r[o].сНазвание];s=s?V(s):r[o].сНазвание,a.add(new Option(s,r[o].сИдентификатор,o===i,o===i))}a.disabled=a.length<2}function tt(){0===q&&(t.getElementById("пропуск").style.display="block",q=setTimeout(nt,c))}function nt(){try{t.getElementById("пропуск").style.display="",q=0}catch(e){le.ПойманоИсключение(e)}}function rt(e){if(K(Number.isInteger(e)),e!==b){switch(ue.Вот(`[Управление] Состояние трансляции изменилось с ${b} на ${e}`),t.body.setAttribute("data-состояние",e),Me("переключитьтрансляцию",e===_||e===N),t.getElementById("создатьклип").disabled=e===E||e===$||e===w,e){case E:be.ОчиститьИсторию(),ot({"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":p,"сНазваниеИгры":null,"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null});break;case $:ot({"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":p,"сНазваниеИгры":null,"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null}),Le.НачатьСборМетаданныхТрансляции();break;case w:Le.ЗавершитьСборМетаданныхТрансляции(!0),ot({"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":V("J0100"),"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null}),de.Сжечь();break;case k:case S:case I:break;case _:case N:Le.ЗавершитьСборМетаданныхТрансляции(!1),ot({"кЗрителей":null}),de.Сжечь();break;default:K(!1)}b=e}}function it(e,n){if(void 0!==e){const a=t.getElementById(n);if(0===e.length)a.parentNode.setAttribute("hidden","");else{const n=t.createDocumentFragment();for(var r,i=0;r=e[i];++i){0!==i&&n.appendChild(t.createTextNode(", ")),K(r.сАдрес&&r.сИмя);const e=t.createElement("a");e.setAttribute("href",r.сАдрес),e.setAttribute("rel","external noopener noreferrer"),e.setAttribute("target","_blank"),r.сОписание&&e.setAttribute("title",r.сОписание),e.appendChild(t.createTextNode(r.сИмя)),n.appendChild(e)}a.textContent="",a.appendChild(n),a.parentNode.removeAttribute("hidden")}}}function at(e){if(void 0!==e.лАвторизован&&t.body.classList.toggle("авторизован",e.лАвторизован),void 0!==e.сИмя&&(K(e.сИмя),t.getElementById("зритель-имя").textContent=e.сИмя),void 0!==e.чПодписка){const n=t.getElementById("зритель-подписка");if(e.чПодписка===x){if(n.classList.contains("обновляется"))return!1;n.classList.add("обновляется")}else n.setAttribute("data-подписка",e.чПодписка),n.classList.remove("обновляется")}return!0}function ot(e){if(void 0!==e.лЗапись){const n=t.getElementById("типтрансляции");null===e.лЗапись||!e.лЗапись&&!e.сАдресЗаписи?(n.disabled=!0,n.setAttribute("hidden","")):(Me(n,e.лЗапись),e.сАдресЗаписи?(n.setAttribute("data-адрес",e.сАдресЗаписи),n.disabled=!1):n.disabled=!0,n.removeAttribute("hidden"))}if(void 0!==e.сНазваниеТрансляции){const n=t.getElementById("названиетрансляции");null===e.сНазваниеТрансляции?n.setAttribute("hidden",""):(n.lastElementChild.setAttribute("title",e.сНазваниеТрансляции+V("J0101")),n.lastElementChild.textContent=e.сНазваниеТрансляции,n.removeAttribute("hidden"))}if(void 0!==e.сНазваниеИгры){const n=t.getElementById("названиеигры");null===e.сНазваниеИгры?n.setAttribute("hidden",""):(n.lastElementChild.setAttribute("href",e.сАдресИгры),n.lastElementChild.setAttribute("title",e.сНазваниеИгры+V("J0102")),n.lastElementChild.textContent=e.сНазваниеИгры,n.removeAttribute("hidden"))}if(void 0!==e.кЗрителей){const n=t.getElementById("количествозрителей");null===e.кЗрителей?n.setAttribute("hidden",""):(n.lastElementChild.textContent=fe.ФорматироватьЧисло(e.кЗрителей,0),n.removeAttribute("hidden"))}void 0!==e.чДлительностьТрансляции&&(t.getElementById("позиция-текст").textContent=null===e.чДлительностьТрансляции?"":fe.ПеревестиСекундыВСтроку(e.чДлительностьТрансляции/1e3,!1))}return et.ПЕРЕВОД_ВАРИАНТОВ={Source:"J0115",High:"J0116",Medium:"J0117",Low:"J0118",Mobile:"J0119"},{"Запустить":function(){K(void 0===b),t.getElementById("названиетрансляции").lastElementChild.setAttribute("href",Le.ПолучитьАдресУбогогоПроигрывателя());let e=t.getElementById("громкость");for(e.setAttribute("min",u),e.setAttribute("max",l),e.setAttribute("step",h),e.addEventListener("input",Xe),e=t.getElementById("скорость").firstElementChild;e;e=e.nextElementSibling)e.text="1.00"===e.value?"1x":fe.ФорматироватьЧисло(e.value,2);Ie(),t.addEventListener("focusout",e=>{e.target===t.activeElement&&null===e.relatedTarget&&!t.hidden&&t.hasFocus()&&0!==t.getElementsByTagName("iframe").length&&(ue.Ой("[Управление] Избегаю потерю фокуса чатом"),e.target.blur())}),ge(),re(),t.addEventListener(ne,ae),Re(),We(),Ee.Запустить(),ye.Восстановить(),he.ДобавитьОбработчик("список-выбранварианттрансляции",et),he.ДобавитьОбработчик("проигрыватель-переполненбуфер",tt),he.ДобавитьОбработчик("настройки-измениласьпредустановка-буферизация",Ye),he.ДобавитьОбработчик("проигрыватель-пауза",Ge),t.addEventListener("click",Je),t.addEventListener("contextmenu",Ue),t.addEventListener("keydown",He),t.addEventListener("keyup",He),t.getElementById("глаз").addEventListener("dblclick",qe),t.getElementById("скорость").addEventListener("change",ze),t.getElementById("варианттрансляции").addEventListener("change",Qe),t.getElementById("выборфайладляимпортанастроек").addEventListener("change",Ze),Te(),rt(E),Be(),pe.Запустить()},"ИзменитьСостояние":rt,"ПолучитьСостояние":function(){return K(void 0!==b),b},"ПолучитьСкоростьВоспроизведения":Ke,"ПоказатьМетаданныеКанала":function(e){var n;if(void 0!==e.сИмя&&(n=e.сИмя+V("J0105"),history.replaceState(null,""),t.title=n,t.getElementById("канал-имя").textContent=e.сИмя),void 0!==e.сАватар&&(K(e.сАватар),t.getElementById("канал-аватар").src=e.сАватар),void 0!==e.сОписание&&(t.getElementById("канал-описание").textContent=e.сОписание||""),void 0!==e.сКодЯзыка){const n=t.getElementById("канал-язык");if(e.сКодЯзыка){const t=v[e.сКодЯзыка.toLowerCase()];K(t),n.textContent=t,n.parentNode.removeAttribute("hidden")}else n.parentNode.setAttribute("hidden","")}void 0!==e.кПодписчиков&&(t.getElementById("канал-подписчиков").textContent=fe.ФорматироватьЧисло(e.кПодписчиков)),void 0!==e.кПросмотров&&(t.getElementById("канал-просмотров").textContent=fe.ФорматироватьЧисло(e.кПросмотров)),void 0!==e.дКаналСоздан&&(t.getElementById("канал-создан").textContent=e.дКаналСоздан.toLocaleDateString()),it(e.моСообщества,"канал-сообщества"),it(e.моКоманды,"канал-команды")},"ПоказатьМетаданныеЗрителя":at,"ПоказатьМетаданныеТрансляции":ot,"ОтключитьПолноэкранныйРежим":me,"ПереключитьПросмотрТрансляции":De}})(),_e=(()=>{const n=10,a=.28,o=1,s=-1,c=-2,u=-3,d=-4,f=0,h=1,m=2;var g,p,v=null,b=0,x=!1,T="чНачалоВоспроизведения",L=!0,A=0,C=!1,F={"ОбработатьSourceOpen":function(){b=Math.max(b,1),ee()},"ОбработатьProgress":function(){x||W(Y(s))},"ОбработатьWaiting":function(){},"ОбработатьPlaying":function(){Ie.ПолучитьСостояние()!==S||g.paused||Ie.ИзменитьСостояние(I)},"ОбработатьSeeking":function(){},"ОбработатьSeeked":function(){W()},"ОбработатьEnded":function(){J(k)},"ОбработатьTimeUpdate":function(){g.seeking||g.paused||g.ended||Y(u)}},B={"лПауза":!0,"ОбработатьSourceOpen":function(){b=Math.max(b,1)},"ОбработатьProgress":function(){},"ОбработатьWaiting":function(){},"ОбработатьPlaying":function(){},"ОбработатьSeeking":function(){$e.ЗадатьПросмотрено(g.currentTime)},"ОбработатьSeeked":function(){},"ОбработатьEnded":function(){this.лПауза||g.play()},"ОбработатьTimeUpdate":function(){this.лПауза||g.seeking||this.ПроверитьПозициюВоспроизведения(u),$e.ЗадатьПросмотрено(g.currentTime)},"ПроверитьПозициюВоспроизведения":function(e){K(Number.isFinite(e)),K(e===c||e===u||e>=0);const t=g.buffered,n=t.length-1,i=g.currentTime+1e-4;for(var o=e>=0?e:i,s="",l=!1;;){for(var d=e===u?a:r,f=0;f<=n&&(o<t.start(f)&&(d=r,s+="Перепрыгиваю яму. ",o=t.start(f)),!(t.end(f)-o>=d));++f);if(this.лПауза||o<$e.ПолучитьКонец())break;if(l)return void O("Ой",`Бесконечная перемотка Время=${e}`);o=$e.ПолучитьНачало(),s+="Начинаю сначала. ",l=!0}o!==i&&(O("Окак",`${s}Перематываю до ${o}`),g.currentTime=o)}},M=F;function O(e,t){var n=0!==p.sourceBuffers.length?p.sourceBuffers[0]:null,r=X(n?n.buffered:null),i=X(g.buffered),a=r===i;"Вот"===e&&(n&&n.buffered.length>1||g.buffered.length>1)&&(e="Окак"),!g.error&&a||(e="Ой"),ue[e](`${"["===t.charAt(0)?"":"[Проигрыватель] "}${t} •••`+(g.error?` error=${g.error.code}`:"")+(n&&n.updating?" [U]":"")+(g.paused?" [P]":"")+(g.seeking?" [S]":"")+(g.ended?" [E]":"")+("open"===p.readyState?"":` MSE.readyState=${p.readyState}`)+(1===p.sourceBuffers.length?"":` MSE.buffers=${p.sourceBuffers.length}`)+(g.networkState===HTMLMediaElement.NETWORK_LOADING?"":` networkState=${g.networkState}`)+` readyState=${g.readyState}`+` currentTime=${g.currentTime}`+(a?` buffered=${i}`:` MSE.buffered=${r} buffered=${i}`)+(g.duration===1/0?"":` duration=${g.duration}`)+` seekable=${X(g.seekable)}`+` played=${X(g.played)}`)}function X(e){var t="";if(e&&0!==e.length){var n=e.length,r=Math.max(n-20,0);for(0!==r&&(t=`[${r}]`);r<n;++r)0!==r&&(t+=`(${(e.start(r)-e.end(r-1)).toFixed(3)})`),t+=`${e.start(r)}-${e.end(r)}`}return t}function P(e){var t=0,n=0;if(void 0===e&&(e=g.buffered),0!==e.length){var r=e.start(0),i=e.end(e.length-1),a=te(g.currentTime,r,i);t=a-r,n=i-a}return{"чПросмотрено":t,"чНеПросмотрено":n}}function R(){g.volume=ve.Получить("чГромкость2")/l,g.muted=ve.Получить("лПриглушить")}function j(e){L=!0,J(e)}function J(e){O("Окак","Перезагрузка проигрывателя"),Ie.ИзменитьСостояние(e),M=F,v=null,C=!1,g.load()}function U(){g.error&&le.ЗавершитьРаботуИПоказатьСообщение("J0206")}function q(e){try{U();var t=`[MediaSource] ${e.type}`;switch(e.type){case"sourceopen":O("Вот",t),M.ОбработатьSourceOpen();break;case"sourceended":case"sourceclose":O("Вот",t);break;default:ue.Вот(t)}}catch(e){le.ПойманоИсключение(e)}}function H(e){try{U();var t=`[MediaElement] ${e.type}`;switch(e.type){case"loadstart":O("Вот",`${t} src=${g.src} currentSrc=${g.currentSrc}`);break;case"progress":O("Вот",t),M.ОбработатьProgress();break;case"abort":O("Вот",t);break;case"waiting":O("Окак",t),M.ОбработатьWaiting();break;case"playing":O("Вот",t),M.ОбработатьPlaying();break;case"seeking":O("Вот",t),M.ОбработатьSeeking();break;case"seeked":O("Вот",t),M.ОбработатьSeeked();break;case"ended":O("Вот",t),M.ОбработатьEnded();break;case"timeupdate":ue.Вот(`${t} readyState=${g.readyState} currentTime=${g.currentTime} НеПросмотрено=${ue.F2(P().чНеПросмотрено)}`),M.ОбработатьTimeUpdate();break;case"volumechange":ue.Вот(`${t} volume=${g.volume} muted=${g.muted}`);break;case"canplay":Fe();break;default:ue.Вот(t)}}catch(e){le.ПойманоИсключение(e)}}function Y(e,t){void 0===t&&(t=0);const n=g.buffered,i=n.length-1;if(-1===i)return!1;const o=g.currentTime+1e-4;var l=Math.max(o,n.start(0)),v="";const y=n.end(i)-l;if(e===s){const e=ve.Получить("чМаксРазмерБуфера"),t=e+ve.Получить("чРастягиваниеБуфера");if(y<=t)return;b>=2&&he.ОбработатьСобытие("проигрыватель-переполненбуфер",y-e),v+=`Переполнен буфер проигрывателя ${y.toFixed(2)}с > ${t}с. `,l=n.end(i)-e-.1}if(e===c&&b<2){b=2;const e=ve.Получить("чМаксРазмерБуфера")+be.ПолучитьTargetDuration()/2;y>e&&(v+=`Превышена задержка трансляции ${y.toFixed(2)}с > ${e}с. `,l=n.end(i)-e)}K(a<r);for(var E=e===u?a:e===d?1/0:r,$="ended"===p.readyState,w=0;w<=i;++w){l<n.start(w)&&(E=r,v+="Перепрыгиваю яму. ",l=n.start(w));var S=n.end(w)-l;if(S>=E){$=!0;break}}return $||g.paused||function(e,t,n){K("ended"!==p.readyState),K(e<r);const i=t>1;be.ИсчерпанБуферПроигрывателя(i),T="чМаксРазмерБуфера";const a=ve.Получить(T);e+n>=r&&t+n>=a?O(i?"Ой":"Окак",`Буфер исчерпан, остановка не нужна БудетДобавлено=${ue.F3(n)}с ДоКонцаПоследнейОбласти=${ue.F3(e)}с НеПросмотрено=${ue.F3(t)}с РазмерБуфера=${a}с`):(O(i?"Ой":"Окак",`Приостанавливаю воспроизведение для заполнения буфера ДоКонцаПоследнейОбласти=${ue.F3(e)}с НеПросмотрено=${ue.F3(t)}с РазмерБуфера=${a}с`),C=!0,V(k))}(S,y,t),!$&&e!==s||l===o&&!C?$?h:f:(l===o&&(l=g.currentTime),O(v?"Ой":"Окак",`${v}Перематываю до ${l}`),C=!1,g.currentTime=l,m)}function W(e){if(!g.seeking&&e!==m&&g.paused&&!g.ended){if(L&&"ended"!==p.readyState){const e=P().чНеПросмотрено,t=ve.Получить(T);if(e<t)return void ue.Вот(`[Проигрыватель] В буфере не просмотрено ${ue.F3(e)}с < ${t}с`);ue.Окак(`[Проигрыватель] В буфере не просмотрено ${ue.F3(e)}с >= ${t}с`)}else ue.Окак("[Проигрыватель] Не нужно ждать заполнения буфера");switch(Y(c)){case f:O("Ой",`Не найдена область >= ${r}с для начала воспроизведения`),L=!0;break;case h:O("Окак","Начало воспроизведения"),L=!0,g.play(),Ie.ИзменитьСостояние(S)}}}function V(e){void 0!==e&&Ie.ИзменитьСостояние(e),g.pause()}function Z(t,n){return new Promise(function(r,i){O("Вот",`Добавляю ${n?"сегмент инициализации":"медиасегмент"} ${t.чНомер}`),v.addEventListener("updateend",function n(){try{null===v?i(ae.ОБЕЩАНИЕ_ОТМЕНЕНО):(a+=e.performance.now(),v.removeEventListener("updateend",n),O(a>100?"Ой":"Вот",`Добавлен сегмент ${t.чНомер} за ${ue.F0(a)}мс`),r())}catch(e){i(e)}});var a=-e.performance.now();v.appendBuffer(n?t.пДанные.мбСегментИнициализации:t.пДанные.мбМедиасегмент)})}function ee(){K(g);var c=G[0];if(!x&&c&&c.чОбработка===y){if(K(M===F),c.пДанные===$)return K(0===p.sourceBuffers.length),Ie.ИзменитьСостояние(c.пДанные),G.Удалить(0),void ee();if(c.пДанные===N)return K(Ie.ПолучитьСостояние()!==_&&Ie.ПолучитьСостояние()!==N),function(){B.лПауза=!0,M=B,V(),0!==p.sourceBuffers.length&&"open"===p.readyState&&p.endOfStream();var e=P().чПросмотрено;if(e<o)return O("Окак","Повторять нечего"),void Ie.ИзменитьСостояние(_);O("Окак","Запуск повтора"),g.playbackRate=Ie.ПолучитьСкоростьВоспроизведения(),he.ОбработатьСобытие("проигрыватель-пауза",B.лПауза),$e.ЗадатьНачалоИКонец(g.buffered.start(0),g.buffered.start(0)+e),$e.ЗадатьПросмотрено(g.currentTime),Ie.ИзменитьСостояние(N)}(),G.Удалить(0),void ee();var l,d=p.readyState;if("open"!==d)return ue.Вот(`[Проигрыватель] Добавление сегмента ${c.чНомер} отложено MediaSource.readyState=${d} MediaElement.src=${g.src}`),void("closed"===d&&0===b&&(l=G.ПолучитьКоличествоПреобразованныхСегментов().чДлительность)>=i&&(ue.Ой(`[Проигрыватель] MediaSource закрыт слишком долго ${l}с >= ${i}с`),K(Ie.ПолучитьСостояние()===E||Ie.ПолучитьСостояние()===$),Ie.ПереключитьПросмотрТрансляции()));if(c.лРазрыв&&0!==p.sourceBuffers.length)!function(e){O("Окак",`Сегмент ${e.чНомер} вызвал окончание потока`),0===g.buffered.length||g.paused&&P().чНеПросмотрено<a+.1?j(k):(L="number"==typeof e.пДанные||!g.seeking&&g.paused,p.endOfStream(),W())}(c);else{if(c.пДанные===w)return K(c.лРазрыв&&0===p.sourceBuffers.length),Ie.ИзменитьСостояние(c.пДанные),G.Удалить(0),void ee();!function(e){if(0===p.sourceBuffers.length){ue.Окак(`[Проигрыватель] Добавляю буфер ${e.пДанные.сКодеки}`),K(e.лРазрыв&&e.пДанные.сКодеки);try{v=p.addSourceBuffer(e.пДанные.сКодеки)}catch(e){z(e)&&"NotSupportedError"===e.name?le.ЗавершитьРаботуИПоказатьСообщение("J0201"):le.ПойманоИсключение(e)}v.addEventListener("updatestart",q),v.addEventListener("update",q),v.addEventListener("updateend",q),v.addEventListener("abort",q),v.addEventListener("error",q)}}(c),x=!0;var f=function(){var t=ve.Получить("чДлительностьПовтора2");if(t===D)return Promise.resolve();var i=P(v.buffered);if(i.чПросмотрено<t+n)return Promise.resolve();var a=g.currentTime-t;return new Promise(function(t,n){O("Вот",`Удаляю просмотренное видео Просмотрено=${ue.F3(i.чПросмотрено)}с УдалитьДо=${ue.F3(a)}с`),v.addEventListener("updateend",function a(){try{null===v?n(ae.ОБЕЩАНИЕ_ОТМЕНЕНО):(o+=e.performance.now(),v.removeEventListener("updateend",a),i=P(v.buffered),O(o>100||i.чПросмотрено<r?"Ой":"Вот",`Просмотренное видео удалено за ${ue.F0(o)}мс Просмотрено=${ue.F0(i.чПросмотрено)}с`),t())}catch(e){n(e)}});var o=-e.performance.now();v.remove(0,a)})}().then(function(){g.seeking||g.paused||g.ended||Y(u,c.чДлительность)});c.пДанные.мбСегментИнициализации&&(f=f.then(function(){return Z(c,!0)})),f.then(function(){return Z(c,!1)}).then(function(){if(x=!1,G.Удалить(c),!G[0]||G[0].пДанные!==N){!function(e){if(Q(e.пДанные.чПозицияКодирования)){var t=Q(e.чTwitchПрошлоВремени)?e.чTwitchПрошлоВремени-e.пДанные.чПозицияКодирования:0,n=0===t||Math.abs(t-A)>1;ue[n?"Ой":"Вот"](`[Проигрыватель] Смещение начала трансляции ${ue.F1(t)}с`),be.ОкноПоказано()&&be.ОбновитьЗначение("статистика-смещениеначалатрансляции",t.toFixed(1),n),A=t}}(c);var e=Y(s);G[0]&&G[0].чОбработка===y||(W(e),function(){if(be.ОкноПоказано()){var e=v.buffered;0!==e.length&&(t.getElementById("статистика-продолжительностьтрансляции").textContent=fe.ПеревестиСекундыВСтроку(e.end(e.length-1)+A,!0))}}(),function(e){if(be.ОкноПоказано()){var n="";if(Q(e.пДанные.чВремяКодирования)){var r=g.currentTime;if(0!==r){var i=(Date.now()-e.пДанные.чВремяКодирования)/1e3,a=e.пДанные.чПозицияКодирования-r;n=`${i.toFixed(1)} + ${a.toFixed(1)} = ${(i+a).toFixed(1)}`}}ue.Вот(`[Проигрыватель] Задержка трансляции ${n}с`),t.getElementById("статистика-задержкатрансляции").textContent=n}}(c))}ee()}).catch(function(e){try{if(x=!1,"ДОБАВЛЕНИЕ СЕГМЕНТА ОТЛОЖЕНО"===e)return;G.Удалить(c),e===ae.ОБЕЩАНИЕ_ОТМЕНЕНО?ue.Вот(`[Проигрыватель] Отменено добавление сегмента ${c.чНомер}`):le.ПойманоИсключение(e)}catch(e){le.ПойманоИсключение(e)}})}}}function ne(e){K(Ie.ПолучитьСостояние()===N),B.ПроверитьПозициюВоспроизведения(e)}return{"Запустить":function(){K(!g);try{p=new MediaSource}catch(e){le.ЗавершитьРаботуИПоказатьСообщение("J0202")}for(var e of(p.addEventListener("sourceopen",q),p.addEventListener("sourceended",q),p.addEventListener("sourceclose",q),p.sourceBuffers.addEventListener("addsourcebuffer",q),p.sourceBuffers.addEventListener("removesourcebuffer",q),g=t.getElementById("глаз"),R(),["progress","error","playing","seeking","seeked","ended","timeupdate","waiting","loadstart","suspend","abort","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","durationchange","play","pause","ratechange","resize"]))g.addEventListener(e,H);return g.src=URL.createObjectURL(p),!0},"Остановить":function(){g&&(URL.revokeObjectURL(g.src),g.removeAttribute("src"),g.load())},"ПолучитьЗаполненностьБуфера":P,"ПолучитьКоличествоПропущенныхКадров":function(){return"function"==typeof g.getVideoPlaybackQuality?g.getVideoPlaybackQuality():{totalVideoFrames:g.webkitDecodedFrameCount,droppedVideoFrames:g.webkitDroppedFrameCount}},"ПолучитьПозициюВоспроизведенияТрансляции":function(){var e=Ie.ПолучитьСостояние()===N?$e.ПолучитьКонец():g.currentTime;return 0===e?0:Math.max(e+A,0)},"ПоказатьСостояние":O,"Перезагрузить":j,"ПрименитьНастройкиЗвука":R,"ДобавитьСледующийСегмент":ee,"ПеремотатьПовторДо":ne,"ПеремотатьПовторНа":function(e,t){K(Ie.ПолучитьСостояние()===N),K(Number.isFinite(t)),e&&(t*=be.ПолучитьДлительностьКадраВСекундах().чМинимальная),0!==t&&ne(te(g.currentTime+t,$e.ПолучитьНачало(),$e.ПолучитьКонец()))},"ПереключитьПаузу":function(){K(Ie.ПолучитьСостояние()===N),(B.лПауза=!B.лПауза)?(ue.Окак("[Проигрыватель] Ставлю повтор на паузу"),g.pause()):(ue.Окак("[Проигрыватель] Снимаю повтор с паузы"),B.ПроверитьПозициюВоспроизведения(c),g.play()),he.ОбработатьСобытие("проигрыватель-пауза",B.лПауза)},"ЗадатьСкоростьПовтора":function(e){K(Ie.ПолучитьСостояние()===N),g.playbackRate=e}}})(),Ne=(()=>{const t=3e3,n=3e4,r=1e3,i=150;var o,u,l,d=_,f=new Array(10),h=new ae,m=null,g=null;function v(e,t,n){if(!n.startsWith("#EXTM3U"))throw`Вместо списка загружена какая-то фигня длиною ${n.length}\n${n}`;var r=1;if(e)var i=new Map,a=[],o=null;else var s,c,u=0,l=0,d=NaN,f=!1,h=[],m=null;var g,p=/^#([A-Z0-9\-]+)(?::(.+))?$|^[^#\r\n].*$/gm;for(p.lastIndex=7;g=p.exec(n);){var v=g[0],b=g[1],$=g[2];if("#"===v.charAt(0))switch(b){case"EXTM3U":K(!1);break;case"EXT-X-VERSION":K(1===r),K((r=k($))>=2&&r<=7);break;case"EXT-X-START":K(!1);break;case"EXT-X-MEDIA":K(e);var w=(x=E($)).get("TYPE");if(K(w),K("VIDEO"!==w&&"AUDIO"!==w||!x.has("URI")),"VIDEO"!==w)ue.Ой(`[Список] Найден #EXT-X-MEDIA TYPE=${w}`);else{var _=I(x.get("GROUP-ID"));K(!i.has(_)),i.set(_,I(x.get("NAME")))}break;case"EXT-X-STREAM-INF":K(e),K(!o),o=Object.create(null);var x=E($);o.nPeakBitrate=k(x.get("BANDWIDTH")),o.сКодеки=x.has("CODECS")?I(x.get("CODECS")):"",K(!x.has("AUDIO")&&!x.has("SUBTITLES")&&!x.has("CLOSED-CAPTIONS")),x.has("VIDEO")&&(o.сИдентификатор=I(x.get("VIDEO")));break;case"EXT-X-I-FRAME-STREAM-INF":case"EXT-X-SESSION-DATA":case"EXT-X-SESSION-KEY":K(e);break;case"EXT-X-TARGETDURATION":K(!e),K(void 0===s),K((s=k($))>0&&s<86400);break;case"EXT-X-MEDIA-SEQUENCE":K(!e),K(0===l),l=k($);break;case"EXT-X-ENDLIST":K(!e),K(void 0===c),K(void 0===$),c=!0,ue.Окак(`[Список] #EXT-X-ENDLIST после сегмента ${l+h.length-1}`);break;case"EXT-X-DISCONTINUITY-SEQUENCE":case"EXT-X-DATERANGE":K(!e);break;case"EXT-X-PLAYLIST-TYPE":case"EXT-X-I-FRAMES-ONLY":K(!1);break;case"EXTINF":K(!e),K(void 0===(m=m||Object.create(null)).чДлительность),m.чДлительность=N($),K(0!==m.чДлительность),m.чДлительность-s>1&&ue.Ой(`[Список] Длительность сегмента превышена на ${m.чДлительность-s}с`);break;case"EXT-X-DISCONTINUITY":K(!e),K(!f),K(void 0===$),f=!0,ue.Ой(`[Список] #EXT-X-DISCONTINUITY у сегмента ${l+h.length}`);break;case"EXT-X-PROGRAM-DATE-TIME":K(!e);break;case"EXT-X-BYTERANGE":case"EXT-X-KEY":case"EXT-X-MAP":K(!1);break;case"EXT-X-TWITCH-ELAPSED-SECS":K(!e),K(0===h.length),K(Number.isNaN(d)),d=S($)}else v=new URL(v,t).href,e?(K(o),o.сАбсолютныйАдресСпискаСегментов=v,a.push(o),o=null):(K(m),K(void 0!==m.чДлительность),K(!c),m.чTwitchПрошлоВремени=d,m.лРазрыв=f,m.сАдрес=v,h.push(m),u+=m.чДлительность,d+=m.чДлительность,f=!1,m=null)}if(e){for(var T of(K(!o),a))"сИдентификатор"in T?(T.сНазвание=i.get(T.сИдентификатор),K(T.сНазвание)):(T.сИдентификатор=`CoolCmd${T.nPeakBitrate}`,T.сНазвание=`${fe.ФорматироватьЧисло(T.nPeakBitrate/1e6,1)} ${V("J0114")}`),ue.Окак(`[Список] Добавлен вариант PeakBitrate=${T.nPeakBitrate} Идентификатор=${T.сИдентификатор} Название=${T.сНазвание} Кодеки=${T.сКодеки}`);return a.sort(y),a}return K(!m),K(void 0!==s),ue.Вот(`[Список] Разобран список сегментов TargetDuration=${s} MediaSequenceNumber=${l} КоличествоСегментов=${h.length} ДлительностьСписка=${ue.F1(u)}с`),be.РазобранСписокСегментов(s,h.length,u),{nMediaSequenceNumber:l,nTargetDuration:s,"лКонецСписка":!!c,"моСегменты":h}}function y(e,t){return("chunked"===t.сИдентификатор?1e9:t.nPeakBitrate)-("chunked"===e.сИдентификатор?1e9:e.nPeakBitrate)}function E(e){K(e);for(var t=/([A-Z0-9\-]+)=("[^"]+"|[^",][^,]*)(?:,|$)/g,n=new Map;t.lastIndex!==e.length;){var r=t.lastIndex,i=t.exec(e);K(i&&i.index===r),K(!n.has(i[1])),n.set(i[1],i[2])}return n}function k(e){return K(/^[0-9]{1,15}$/.test(e)),Number.parseInt(e,10)}function S(e){return K(/^[0-9]{1,14}(?:\.[0-9]{1,15})?$/.test(e)),Number.parseFloat(e)}function I(e){return K(e&&e.length>2&&'"'===e.charAt(0)&&'"'===e.charAt(e.length-1)),e.slice(1,-1)}function N(e){if(K(e),"-"===e.slice(0,1))throw"Отрицательный #EXTINF";var t=e.indexOf(",");return S(-1===t?e:e.slice(0,t))}function x(y){K(Number.isFinite(y)&&y>=0),ue.Вот(`[Список] Загрузка списка начнется через ${ue.F0(y)}мс`);var E,k,S=oe(h,y);m||(S=S.then(function(){return Le.ПолучитьАбсолютныйАдресСпискаВариантов(h)}).then(function(e){return E=e,Te.ЗагрузитьТекст(h,E,s,"список вариантов",!1)}).then(function(e){le.СохранитьСписокВариантов(e),m=v(!0,E,e),A()}));S.then(function(){return k=e.performance.now(),Te.ЗагрузитьТекст(h,m[u].сАбсолютныйАдресСпискаСегментов,c,"список сегментов",!1)}).then(function(t){le.СохранитьСписокСегментов(t);var n=function(e){K(d===$);const t=a*g.nTargetDuration*10;if(0===e)return t;var n=ve.Получить("чИнтервалОпроса");if(n!==D)return n*g.nTargetDuration*10;K(e>0&&e<=g.моСегменты.length),-1===o&&(o=0,e=g.моСегменты.length);e=Math.min(e,f.length);do{f[o]=g.моСегменты[g.моСегменты.length-e].чДлительность,++o===f.length&&(o=0)}while(0!=--e);return K((n=Math.max.apply(null,f))>0),Math.max(1e3*n+i,t)}(function(e){if(null===g){if(e.лКонецСписка)throw"Найден #EXT-X-ENDLIST";K(0!==e.моСегменты.length),l=!0;for(var t=ve.Получить("чРазмерБуфера"),n=Math.max(e.моСегменты.length-ve.Получить("кЗаначка")-Y,1);0!=--n&&(t-=e.моСегменты[n].чДлительность)>0;);}else{K(0!==e.моСегменты.length),(e.nMediaSequenceNumber<g.nMediaSequenceNumber||e.nMediaSequenceNumber+e.моСегменты.length<g.nMediaSequenceNumber+g.моСегменты.length)&&ue.Ой(`[Список] Уменьшился media sequence number [${g.nMediaSequenceNumber}..${g.nMediaSequenceNumber+g.моСегменты.length-1}] ==> [${e.nMediaSequenceNumber}..${e.nMediaSequenceNumber+e.моСегменты.length-1}]`);const t=e.nMediaSequenceNumber-(g.nMediaSequenceNumber+g.моСегменты.length);t>0&&(ue.Ой(`[Список] Пропущено сегментов: ${t}`),be.НеЗагруженыСегменты(t),l=!0),e.nTargetDuration!==g.nTargetDuration&&(ue.Ой(`[Список] Изменился target duration ${g.nTargetDuration} ==> ${e.nTargetDuration}`),L()),n=0}for(var r,i=0,a=0;r=e.моСегменты[n];++n){const t=e.nMediaSequenceNumber+n;if(null!==g&&t>=g.nMediaSequenceNumber&&t<g.nMediaSequenceNumber+g.моСегменты.length){const e=g.моСегменты[t-g.nMediaSequenceNumber];e.сАдрес===r.сАдрес&&e.чДлительность===r.чДлительность||(ue.Ой(`[Список] У сегмента ${t} изменились адрес ${e.сАдрес} ==> ${r.сАдрес} или длительность ${e.чДлительность} ==> ${r.чДлительность}`),l=!0)}if(null===g||t>=g.nMediaSequenceNumber+g.моСегменты.length){d!==$&&(d=$,G.Добавить(new se(b,$)),L());const e=G.Добавить(new se(p,r.сАдрес,r.чДлительность,r.лРазрыв||l,r.чTwitchПрошлоВремени));ue.Вот(`[Список] Добавлен сегмент ${e.чНомер} MediaSequenceNumber=${t} Длительность=${e.чДлительность} Разрыв=${e.лРазрыв} TwitchПрошлоВремени=${e.чTwitchПрошлоВремени}`),l=!1,i+=1,a+=e.чДлительность}}if(be.ДобавленыСегментыВОчередь(i,a),(null===g||e.nMediaSequenceNumber+e.моСегменты.length>=g.nMediaSequenceNumber+g.моСегменты.length)&&(g=e),e.лКонецСписка)throw"Найден #EXT-X-ENDLIST";return i}(v(!1,m[u].сАбсолютныйАдресСпискаСегментов,t)));x(Math.max(n-e.performance.now()+k,0)),Te.ЗагрузитьСледующийСегмент()}).catch(function(e){try{"string"==typeof e?(ue.Ой(`[Список] Завершаю трансляцию. ${e}`),function(){d!==w&&(d=w,G.Добавить(new se(b,w)),L());C(),g=null}(),x(function(){K(d===w),o=-1===o?t:Math.min(o+r,n);return o}()),Te.ЗагрузитьСледующийСегмент()):e===ae.ОБЕЩАНИЕ_ОТМЕНЕНО?ue.Вот("[Список] Отменено обновление списков"):le.ПойманоИсключение(e)}catch(e){le.ПойманоИсключение(e)}})}function T(){ue.Вот("[Список] Отменяю обновление списков"),h.Отменить()}function L(){f.fill(0),o=-1}function A(){if(0===m.length)throw"Список вариантов пуст";var e=ve.Получить("сНазваниеВарианта");for(u=m.length-1;0!==u&&m[u].сИдентификатор!==e;)--u;ue.Вот(`[Список] Выбран вариант трансляции ${m[u].сИдентификатор} ЖелаемыйВариант=${e}`),he.ОбработатьСобытие("список-выбранварианттрансляции",[m,u])}function C(){m&&(ue.Вот("[Список] Очищаю список вариантов трансляции"),m=null,he.ОбработатьСобытие("список-выбранварианттрансляции",[m,u]))}return L(),{"Запустить":function(){K(d===_),h.НачалоВыполнения(),x(0)},"Остановить":function(){d=_,T(),C(),g=null},"ИзменитьВариантТрансляции":function(){K(m),T(),L(),A(),g=null,h.НачалоВыполнения(),x(0)}}})(),xe=(()=>{var e=null,t=-1;function r(e){le.ЗавершитьРаботуИОтправитьОтчет(`Произошла ошибка в рабочем потоке в строке ${e.lineno}. ${e.message}`)}function i(e){try{var t=e.data;switch(K(Array.isArray(t)),t[0]){case 1:K(2===t.length&&z(t[1]));var n=new se(y,t[1].пДанные,t[1].чДлительность,t[1].лРазрыв,t[1].чTwitchПрошлоВремени,t[1].чНомер);if(ue.Вот(`[Преобразование] Получен сегмент ${n.чНомер} ПреобразованЗа=${ue.F0(n.пДанные.чПреобразованЗа)}мс`),"number"!=typeof n.пДанные){if(be.ПолученПреобразованныйСегмент(n),void 0===n.пДанные.мбМедиасегмент)return;le.СохранитьПреобразованныйСегмент(n)}return G.Добавить(n),void _e.ДобавитьСледующийСегмент();case 2:var r=t[1],i=t[2];K(3===t.length&&Array.isArray(r)&&Array.isArray(i)&&r.length===i.length);for(var a=0;a<r.length;++a)K(("Вот"===r[a]||"Окак"===r[a]||"Ой"===r[a])&&"string"==typeof i[a]),ue[r[a]](i[a]);return;case 3:return K(3===t.length&&"string"==typeof t[1]&&"object"==typeof t[2]),void le.ЗавершитьРаботуИОтправитьОтчет(t[1],t[2]);case 4:return K(2===t.length&&"string"==typeof t[1]),void le.ЗавершитьРаботуИПоказатьСообщение(t[1]);case 5:return K(2===t.length&&t[1].byteLength),void de.Выбросить(t[1]);default:K(!1)}}catch(e){le.ПойманоИсключение(e)}}function a(){e||(ue.Вот("[Преобразование] Создаю рабочий поток"),(e=new Worker(chrome.extension.getURL("worker.js"))).addEventListener("error",r),e.addEventListener("message",i))}return{"Остановить":function(){t=-1,e&&(ue.Вот("[Преобразование] Убиваю рабочий поток"),e.terminate(),e=null)},"ПреобразоватьСледующийСегмент":function(){for(var r,i,o=0,s=0;i=G[s];++s)if(!(i.чОбработка>b)){if(i.чОбработка<b)break;-1!==t&&t+1!==i.чНомер&&(ue.Ой(`[Преобразование] Не загружены сегменты между ${t} и ${i.чНомер}`),i.лРазрыв=!0),t=i.чНомер,"number"!=typeof i.пДанные||null!==e?("number"!=typeof i.пДанные&&(le.СохранитьТранспортныйПоток(i),be.ОтосланИсходныйСегмент()),a(),ue.Вот(`[Преобразование] Отсылаю сегмент ${i.чНомер}`),i.сВерсия=n,i.чОбработка=Y,e.postMessage(i,"number"==typeof i.пДанные?void 0:[i.пДанные]),1==++o&&(r=s)):(ue.Вот(`[Преобразование] Пропускаю сегмент ${i.чНомер} Состояние=${i.пДанные}`),i.чОбработка=y,i.пДанные===$&&a())}0!==o&&G.Удалить(r,o),_e.ДобавитьСледующийСегмент()}}})(),Te=(()=>{function t(t,n,r,i,a,o,s,c,u){return K("GET"===n||"PUT"===n||"DELETE"===n),K("string"==typeof r&&(r.startsWith("http://")||r.startsWith("https://")||0===i&&r.startsWith(chrome.extension.getURL("")))),K(!c||!o),K(Number.isFinite(i)&&(0===i||i>500)),i=Math.round(i),ue.Вот(`[Загрузчик] ${n} ${a} не дольше ${i}мс`),new Promise(function(l,d){const f=new XMLHttpRequest;if(f.addEventListener("timeout",b),f.addEventListener("error",b),f.addEventListener("abort",b),f.addEventListener("load",function(){try{if(W)return;K(f.readyState===XMLHttpRequest.DONE);const t=f.status;if(t>=200&&t<=299&&null!==f.response){K(c&&z(f.response)||!c&&"string"==typeof f.response);const n=Math.round(e.performance.now()-g),r=Math.round(p-g);ue[200===t?"Вот":"Ой"](`[Загрузчик] Загрузил ${a} за ${n}мс`+(u?` ОжиданиеОтвета=${r}мс`:"")+(200===t?"":` Код=${t} ${f.statusText}`)+(o&&f.response.length?`\n${f.response}`:` Размер=${c?f.response.byteLength:f.response.length}`)),0!==i&&be.СкачаноНечто(function(e){var t,n=17+e.statusText.length+e.getAllResponseHeaders().length;(function(e){return 0===e.statusText.length})(e)&&(n=Math.round(.5*n));var r=e.getResponseHeader("Content-Length");r?t=Number.parseInt(r,10):"text"!==e.responseType?t=e.response.byteLength:(t=e.response.length,(r=e.getResponseHeader("Content-Encoding"))&&"identity"!==r&&(t=Math.round(.35*t)));return n+t}(f)),c?l({"буфДанные":f.response,"чДлительностьЗагрузки":n,"чОжиданиеОтвета":r}):(K(!u),l(f.response))}else ue.Ой(`[Загрузчик] Не удалось загрузить ${a}. Сервер вернул код ${t} ${f.statusText}`+(c&&z(f.response)?` Размер=${f.response.byteLength}`:`\n${f.response}`)),(t>=400&&t<=499||null===f.response||!v())&&d(F+t)}catch(e){le.ПойманоИсключение(e)}}),u&&f.addEventListener("progress",function t(){try{K(Number.isNaN(p)),p=e.performance.now(),f.removeEventListener("progress",t)}catch(e){le.ПойманоИсключение(e)}}),t&&t.ЗаменитьОбработчик(function(){f.removeEventListener("abort",b),f.abort(),d(ae.ОБЕЩАНИЕ_ОТМЕНЕНО)}),f.open(n,r),s)for(var h of Object.keys(s))f.setRequestHeader(h,s[h]);f.responseType=c?"arraybuffer":"text",f.timeout=i;var m=!c;K(!m||!u);const g=e.performance.now();var p=NaN;function v(){if(!m)return!1;if(ue.Ой(`[Загрузчик] Повторно загружаю ${a}`),f.open(n,r),s)for(var e of Object.keys(s))f.setRequestHeader(e,s[e]);return m=!1,f.send(),!0}function b(e){try{if(W)return;ue.Ой(`[Загрузчик] Не удалось загрузить ${a}. Произошло событие ${e.type}`),("timeout"!==e.type&&"error"!==e.type||!v())&&d(`Произошло событие ${e.type}`)}catch(e){le.ПойманоИсключение(e)}}f.send()})}function n(){for(var e=G.length,t=ve.Получить("кЗаначка");0!==t&&(0!==e&&G[e-1].чОбработка===p);--t)--e;var o=ve.Получить("кОдновременныхЗагрузок"),s=0;for(t=0;t<e;++t)G[t].чОбработка<=b&&(s+=G[t].чДлительность,G[t].чОбработка<=v&&(--o,G[t].чОбработка===p&&o>=0&&r(G[t])));if(s>=i)return ue.Ой(`[Загрузчик] Длительность всех загрузок в очереди ${ue.F1(s)}с >= ${i}с`),a(null),void n();xe.ПреобразоватьСледующийСегмент()}function r(e){const r=5e3+e.чДлительность*ve.Получить("кОдновременныхЗагрузок")*2*1e3;K(r<1e3*i);const o=e.пДанные;e.пДанные=new ae,e.пДанные.НачалоВыполнения(),e.чОбработка=v,t(e.пДанные,"GET",o,r,`сегмент ${e.чНомер}`,!1,null,!0,be.ОкноПоказано()).then(function(t){K(G.includes(e)),e.пДанные=t.буфДанные,e.чОбработка=b,be.ЗагруженСегмент(t.буфДанные.byteLength,e.чДлительность,t.чДлительностьЗагрузки,t.чОжиданиеОтвета),n()}).catch(function(t){try{"string"==typeof t&&e.чОбработка===v?(ue.Ой(`[Загрузчик] Не удалось загрузить сегмент ${e.чНомер}. ${t}`),K(G.includes(e)),a(t===F+404||t===F+410?null:e),K(!G.includes(e)),n()):t===ae.ОБЕЩАНИЕ_ОТМЕНЕНО?(ue.Вот(`[Загрузчик] Отменена загрузка сегмента ${e.чНомер}`),K(!G.includes(e))):le.ПойманоИсключение(t)}catch(e){le.ПойманоИсключение(e)}})}function a(e){G.ПоказатьСостояние();const t=G.length;if(e)G.Удалить(e);else for(var n,r=ve.Получить("кЗаначка"),i=ve.Получить("чРазмерБуфера"),a=t-1;n=G[a];--a)"number"!=typeof n.пДанные&&(n.чОбработка!==v?n.чОбработка===p&&(r>0?r-=1:i>0?i-=n.чДлительность:G.Удалить(a)):G.Удалить(a));G.ПоказатьСостояние(),be.НеЗагруженыСегменты(t-G.length)}return{"ЗагрузитьТекст":function(e,n,r,i,a,o,s){return t(e,void 0===s?"GET":s,n,r,i,a,o,!1,!1)},"ЗагрузитьСледующийСегмент":n}})();var Le=null;function Ae(e){const n=6e4,r="jzkbprff40iqj646a697cyrvl0zt2m6",i={"Client-ID":r,Accept:"application/vnd.twitchtv.v5+json"};var a="",c="",u="",l="",d=new ae;function f(e){if(K(u&&a&&l),u===a)return K(void 0===e),void Ie.ПоказатьМетаданныеЗрителя({"чПодписка":T});switch(e){case void 0:var t="GET",n="";break;case L:t="DELETE",n="";break;case A:t="PUT",n="?notifications=false";break;case C:t="PUT",n="?notifications=true";break;default:K(!1)}Te.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/users/${u}/follows/channels/${a}${n}`,o,`подписка ${e}`,!0,void 0===e?i:{"Client-ID":r,Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${l}`},t).then(function(t){if(e===L)return K(""===t),void Ie.ПоказатьМетаданныеЗрителя({"чПодписка":L});try{var n=JSON.parse(t)}catch(e){throw String(e)}K(Z(n.created_at)),K("boolean"==typeof n.notifications),Ie.ПоказатьМетаданныеЗрителя({"чПодписка":void 0!==e?e:n.notifications?C:A})}).catch(function(t){try{t===F+404?(K(void 0===e),Ie.ПоказатьМетаданныеЗрителя({"чПодписка":L})):"string"==typeof t?(ue.Ой(`[Twitch] Не удалось обновить подписку. ${t}`),Ie.ПоказатьМетаданныеЗрителя({"чПодписка":T})):le.ПойманоИсключение(t)}catch(e){le.ПойманоИсключение(e)}})}function h(){try{K(a),Te.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${a}`,o,"метаданные канала",!0,i).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}const n=new Date(t.created_at);K(t._id===a&&Number.isFinite(t.followers)&&Number.isFinite(t.views)&&!Number.isNaN(n.getTime())),Ie.ПоказатьМетаданныеКанала({"сИмя":t.display_name||t.name,"сАватар":t.logo||chrome.extension.getURL("glitch.svg"),"сОписание":t.description,"сКодЯзыка":"other"===t.broadcaster_language?null:t.broadcaster_language,"кПодписчиков":t.followers,"кПросмотров":t.views,"дКаналСоздан":n})}).catch(function(e){"string"==typeof e?ue.Ой(`[Twitch] Не удалось получить метаданные канала. ${e}`):le.ПойманоИсключение(e)}),Te.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${a}/communities`,o,"сообщества канала",!0,i).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}for(var n of(K(Array.isArray(t.communities)),t.communities))K(Z(n.name)),n.сИмя=n.display_name||n.name,n.сОписание=n.description,n.сАдрес=`https://www.twitch.tv/communities/${encodeURIComponent(n.name)}`;Ie.ПоказатьМетаданныеКанала({"моСообщества":t.communities})}).catch(function(e){"string"==typeof e?ue.Ой(`[Twitch] Не удалось получить сообщества канала. ${e}`):le.ПойманоИсключение(e)}),Te.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${a}/teams`,o,"команды канала",!0,i).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}for(var n of(K(Array.isArray(t.teams)),t.teams))K(Z(n.name)),n.сИмя=n.display_name||n.name,n.info&&(n.сОписание=ne(n.info)),n.сАдрес=`https://www.twitch.tv/team/${encodeURIComponent(n.name)}`;Ie.ПоказатьМетаданныеКанала({"моКоманды":t.teams})}).catch(function(e){"string"==typeof e?ue.Ой(`[Twitch] Не удалось получить команды канала. ${e}`):le.ПойманоИсключение(e)}),Te.ЗагрузитьТекст(null,"https://api.twitch.tv/kraken/user",o,"метаданные зрителя",!1,i).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}return K(Z(t._id)),K(Z(t.name)),u=t._id,Ie.ПоказатьМетаданныеЗрителя({"сИмя":t.display_name||t.name}),Te.ЗагрузитьТекст(null,"https://api.twitch.tv/api/viewer/token.json",o,"токен зрителя",!1,{"Client-ID":r})}).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}K(Z(t.token)),l=t.token,Ie.ПоказатьМетаданныеЗрителя({"лАвторизован":!0}),f()}).catch(function(e){try{"string"==typeof e?(ue.Ой(`[Twitch] Не удалось получить метаданные зрителя. ${e}`),u=l="",Ie.ПоказатьМетаданныеЗрителя({"лАвторизован":!1})):le.ПойманоИсключение(e)}catch(e){le.ПойманоИсключение(e)}})}catch(e){le.ПойманоИсключение(e)}}function m(t){K(a),ue.Вот(`[Twitch] Загрузка метаданных трансляции начнется через ${ue.F0(t)}мс`),oe(d,t).then(function(){return Te.ЗагрузитьТекст(d,`https://api.twitch.tv/kraken/streams/${a}`,o,"метаданные трансляции",!0,i)}).then(function(t){try{var n=JSON.parse(t)}catch(e){throw String(e)}if(!z(n)||!z(n.stream))throw"В загруженном JSON нет метаданных";const r="live"!==n.stream.stream_type,s=Date.parse(n.stream.created_at);var u;if(K(String(n.stream.channel._id)===a&&n.stream.hasOwnProperty("_id")&&Z(n.stream.stream_type)&&Number.isFinite(n.stream.viewers)&&Number.isFinite(s)),Ie.ПоказатьМетаданныеТрансляции({"сНазваниеТрансляции":n.stream.channel.status||V("J0103"),"сНазваниеИгры":r?null:n.stream.game||V("J0104"),"сАдресИгры":(u=n.stream.game,"https://www.twitch.tv/directory"+(u?"/game/"+encodeURIComponent(u):"")),"кЗрителей":n.stream.viewers,"чДлительностьТрансляции":Date.now()-s}),e!==n.stream.channel.name&&(ue.Ой(`[Twitch] Изменился код канала с ${e} на ${n.stream.channel.name}`),e=n.stream.channel.name),""===c){if(ue.Окак(`[Twitch] Идентификатор трансляции: ${n.stream._id}`),c=String(n.stream._id),!r)return Ie.ПоказатьМетаданныеТрансляции({"лЗапись":!1,"сАдресЗаписи":""}),Te.ЗагрузитьТекст(d,`https://api.twitch.tv/kraken/channels/${a}/videos?broadcast_type=archive&limit=3`,o,"запись трансляции",!0,i).then(function(e){try{var t=JSON.parse(e)}catch(e){throw String(e)}for(var n of t.videos)if(String(n.broadcast_id)===c){K("archive"===n.broadcast_type),K(String(n.channel._id)===a),Ie.ПоказатьМетаданныеТрансляции({"лЗапись":!1,"сАдресЗаписи":n.url});break}}).catch(function(e){if("string"!=typeof e)throw e;ue.Ой(`[Twitch] Не удалось загрузить запись трансляции. ${e}`)});Ie.ПоказатьМетаданныеТрансляции({"лЗапись":!0,"сАдресЗаписи":""})}}).then(function(){m(n)}).catch(function(e){try{"string"==typeof e?(ue.Ой(`[Twitch] Не удалось загрузить метаданные трансляции. ${e}`),m(n/2)):e===ae.ОБЕЩАНИЕ_ОТМЕНЕНО?ue.Вот("[Twitch] Отменено обновление метаданных трансляции"):le.ПойманоИсключение(e)}catch(e){le.ПойманоИсключение(e)}})}return K(Z(e)),{"ПолучитьАбсолютныйАдресСпискаВариантов":function(t){return Te.ЗагрузитьТекст(t,`https://api.twitch.tv/api/channels/${e}/access_token?adblock=false&need_https=false&platform=web&player_type=site`,s,"токен трансляции",!0,{"Client-ID":r}).then(function(t){const n=JSON.parse(t);if(z(n)&&Z(n.token)&&Z(n.sig)){const t=JSON.parse(n.token);if(t.channel===e)return""===a?(K(t.hasOwnProperty("channel_id")),a=String(t.channel_id),setImmediate(h)):K(a===String(t.channel_id)),`http://usher.ttvnw.net/api/channel/hls/${e}.m3u8?token=${encodeURIComponent(n.token)}&sig=${encodeURIComponent(n.sig)}&allow_source=true`}le.ЗавершитьРаботуИПоказатьСообщение("J0203")},function(e){if(e!==F+404&&e!==F+422)throw e;le.ЗавершитьРаботуИПоказатьСообщение("J0203")})},"ПолучитьАбсолютныйАдресСпискаСегментов":function(e){return e},"ПолучитьАдресУбогогоПроигрывателя":function(){return`https://www.twitch.tv/${e}?twitch5=0`},"ПолучитьАдресПанелиЧата":function(){return["https://www.twitch.tv",`/${e}/chat`]},"НачатьСборМетаданныхТрансляции":function(){c="",d.НачалоВыполнения(),m(0)},"ЗавершитьСборМетаданныхТрансляции":function(e){e&&(c=""),ue.Вот("[Twitch] Отменяю обновление метаданных трансляции"),d.Отменить()},"СоздатьКлип":function(){const n=Math.round(_e.ПолучитьПозициюВоспроизведенияТрансляции()-3);if(""!==c&&n>0){ue.Окак(`[Twitch] Создаю клип ИдЗрителя=${u} ИдТрансляции=${c} Позиция=${n}`),t.getElementById("создатьклип-канал").value=e,t.getElementById("создатьклип-трансляция").value=c,t.getElementById("создатьклип-позиция").value=n;try{t.getElementById("создатьклип-форма").submit()}catch(e){}}else ue.Ой(`[Twitch] Недостаточно данных для создания клипа ИдЗрителя=${u} ИдТрансляции=${c} Позиция=${n}`)},"ИзменитьПодпискуЗрителяНаКанал":function(e){K(Number.isInteger(e)),f(e)}}}function Ce(t){try{W=!0,ue.Окак("[Запускалка] Завершаю работу"),e.stop(),ve.Остановить(),t||(be.СкрытьОкно(),le.Остановить(),_e.Остановить(),de.Сжечь()),Le.ЗавершитьСборМетаданныхТрансляции(!0),Ne.Остановить(),xe.Остановить(),G.Очистить(),ye.ЗакрытьОкно(),ue.Окак("[Запускалка] Работа завершена")}catch(e){}}function Fe(){const e=t.getElementById("глаз"),n=e.getBoundingClientRect();e.videoWidth>n.width?e.style.objectFit="fill":e.style.objectFit="scale-down"}(()=>{function n(e){var t=function(e){return e.searchParams||new URLSearchParams(e.search.slice(1))}(e).get("channel")||"channel";return ue.Вот(`[Запускалка] Канал ${t}`),{"сКодКанала":t.toLowerCase(),"сАбсолютныйАдресСпискаВариантов":""}}function r(e){ue.Окак("[Запускалка] window.beforeunload"),Ce(!0)}try{fe.TranslatePage(t);const i=n(e.location);if(i.сКодКанала){if(function(t){for(var r of(K(Z(t)),chrome.extension.getViews()))if(r!==e&&!r.closed&&n(r.location).сКодКанала===t)return r.chrome.tabs.getCurrent(function(t){try{r.chrome.runtime.lastError||(chrome.tabs.update(t.id,{active:!0}),chrome.windows.update(t.windowId,{focused:!0})),e.history.length<2?e.close():le.ЗавершитьРаботуИПоказатьСообщение("J0211")}catch(e){le.ПойманоИсключение(e)}}),!0;return!1}(i.сКодКанала))return;Le=Ae(i.сКодКанала)}else Le=function(e){function t(e){return e.replace(/^(file:\/\/\/.*)(\d+)(\.m3u8)$/,function(e,t,n,r){return t+(Number.parseInt(n,10)+1)+r})}function n(){return"about:blank"}function r(){}return{"ПолучитьАбсолютныйАдресСпискаВариантов":function(){return e=t(e),Promise.resolve(e)},"ПолучитьАбсолютныйАдресСпискаСегментов":function(e){return t(e)},"ПолучитьАдресУбогогоПроигрывателя":n,"ПолучитьАдресПанелиЧата":n,"НачатьСборМетаданныхТрансляции":r,"ЗавершитьСборМетаданныхТрансляции":r,"СоздатьКлип":r}}(i.сАбсолютныйАдресСпискаВариантов);Promise.all([ve.Восстановить(),pe.ЗапуститьАсинхронно(),new Promise(function(n,r){"complete"===t.readyState?(ue.Ой("[Запускалка] document.readyState=complete"),n()):(ue.Вот(`[Запускалка] document.readyState=${t.readyState}`),e.addEventListener("load",function i(){try{e.removeEventListener("load",i),K("complete"===t.readyState),ue.Вот("[Запускалка] window.onload"),n()}catch(e){r(e)}}))})]).then(function(){ue.Вот(`[Запускалка] Начало работы ${e.performance.now().toFixed()}мс`),K(!W),e.addEventListener("beforeunload",r),le.Запустить(),Ie.Запустить(),_e.Запустить()?Ne.Запустить():Ie.ПереключитьПросмотрТрансляции(),ve.Получить("лПоказатьСтатистику")&&be.ПоказатьОкно()}).catch(le.ПойманоИсключение)}catch(e){le.ПойманоИсключение(e)}})()}(window);