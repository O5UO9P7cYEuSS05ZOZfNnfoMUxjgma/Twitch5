!function(e){"use strict";const t=e.document,n=e.performance,r=e.ДобавитьОбработчикИсключений,i="2018.5.18",a=Number.parseInt(/Chrome\/(\d+)/.exec(navigator.userAgent)[1],10),o=1.5,s=60,c=40,l=15e3,u=15e3,d=6e3,f=1,h=100,m=1,g=1,p=2,b=3,v=4,y=1,_=2,E=3,w=4,$=5,k=6,I=7,S=8,N=-1,x=0,T=1,L=2,C=3,B="Сервер вернул код ",M=Number.MIN_SAFE_INTEGER+1e3,A=Number.MAX_SAFE_INTEGER-1e3,F=Number.MIN_SAFE_INTEGER,D=0,O=1,X=2,P=1,R=2,J=3,U=4,j=a<50?1:0;let q=!1,H=NaN;function Y(e,t){return м_i18n.GetMessage(e,t)}function W(e){return"object"==typeof e&&null!==e}function K(e){return"number"==typeof e&&e==e}function V(e,t){if(Проверить("number"==typeof e&&Number.isInteger(t)&&t>=0&&t<=20),0===t)return Math.round(e);var n=Math.pow(10,t);return Math.round(e*n)/n}function G(e,t,n){return Проверить(Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)&&t<=n),Math.min(Math.max(e,t),n)}function z(e){return Проверить("string"==typeof e),(e=(e=function(e){Проверить("string"==typeof e);const n=t.createElement("template");return n.innerHTML=e,n.content.textContent}(e=e.replace(/[\t\r\n]/g," ").replace(/<\s*br[\s\/]*>/gi,"\n"))).replace(/^\s+|[^\S\r\n]+$/gm,"")).replace(/[^\S\r\n]{2,}/g," ")}function Q(e){let t=e.target;do{if("A"===t.nodeName)return!0}while(t=t.parentElement);return!1}function Z(e){const t=getComputedStyle(e);return("scroll"===t.overflowY||"auto"===t.overflowY)&&e.clientHeight<e.scrollHeight}function ee(e){return e.scrollHeight-e.scrollTop-e.clientHeight<2}function te(e,n){return Проверить(W(e)||ЭтоНепустаяСтрока(e)),"string"==typeof e&&(e=t.getElementById(e)),n?e.removeAttribute("hidden"):e.setAttribute("hidden",""),e}function ne(e){return"string"==typeof e&&(e=t.getElementById(e)),!e.hasAttribute("hidden")}const re=(()=>{var a="",o=[];function s(){_e.ОтключитьПолноэкранныйРежим(),t.body.textContent="";for(let e of t.querySelectorAll('link[rel="stylesheet"], style'))e.remove();for(let e of[t.documentElement,t.body])e.removeAttribute("class"),e.removeAttribute("style"),e.removeAttribute("hidden");return new Promise((e,n)=>{const r=t.createElement("iframe");r.style.position="fixed",r.style.top="0",r.style.left="0",r.style.width="100%",r.style.height="100%",r.style.zIndex="100500",r.style.border="0",r.src="report.html",r.addEventListener("load",function t(){r.removeEventListener("load",t),м_i18n.TranslateDocument(r.contentDocument),e(r.contentDocument)}),t.body.appendChild(r)})}function c(e,t,n){n&&e.documentElement.classList.add(t);for(let n,r=e.forms,i=0;n=r[i];++i)if(n.id===t){te(n,!0);const e=n.querySelector("*[autofocus]");e&&e.focus()}else te(n,!1)}function l(n,r){!function(e){try{chrome.system.memory.getInfo(t=>{e(chrome.runtime.lastError?void 0:t)})}catch(t){e()}}(l=>{!function(e){try{chrome.system.cpu.getInfo(t=>{e(chrome.runtime.lastError?void 0:t)})}catch(t){e()}}(u=>{!function(t,n){s().then(r=>{let i;(i="ОТПРАВИТЬ ОТЗЫВ"===t.ПричинаЗавершенияРаботы?r.getElementById("отладка-отзыв"):r.getElementById("отладка-ошибка")).elements["отладка-отчет"].value=JSON.stringify(t),c(r,i.id,!0),r.addEventListener("reset",t=>{t.preventDefault(),e.location.reload()});let a,o,s=!1;r.addEventListener("submit",t=>{switch(t.preventDefault(),t.target.id){case"отладка-идетотправка":s=!0,a.abort();break;case"отладка-сбойотправки":i.querySelector('*[type="submit"]').click();break;default:r.getElementById("отладка-ходотправки").value=0,c(r,"отладка-идетотправка",!1),a||((a=new XMLHttpRequest).upload.addEventListener("progress",e=>{r.getElementById("отладка-ходотправки").value=e.loaded/e.total}),a.addEventListener("load",e=>{s=e.target.status>=200&&e.target.status<=299}),a.addEventListener("loadend",()=>{s?e.location.reload():c(r,"отладка-сбойотправки",!1)}),o=new FormData(t.target),n&&o.append("отладка-транспортныйпоток-0",new Blob([n],{type:"video/mp2t"}))),a.open("POST","http://r90354g8.beget.tech/tw5/report3.php"),a.send(o)}})})}({"ПричинаЗавершенияРаботы":n,"ВерсияРасширения":i,"Оборзеватель":navigator.userAgent,"Время":(new Date).toISOString(),"Адрес":e.location.href,"Инкогнито":chrome.extension.inIncognitoContext,"Оперативка":l,"Процессор":u,"Видюха":function(){try{var e=t.createElement("canvas").getContext("webgl"),n=e.getExtension("WEBGL_debug_renderer_info");return e.getParameter(n.UNMASKED_VENDOR_WEBGL)+" | "+e.getParameter(n.UNMASKED_RENDERER_WEBGL)}catch(e){}}(),"Язык":function(){try{return Y("J0103")}catch(e){}}(),"ОтклонениеПульса":p,"Экран":{top:e.screen.top,left:e.screen.left,width:e.screen.width,height:e.screen.height,availTop:e.screen.availTop,availLeft:e.screen.availLeft,availWidth:e.screen.availWidth,availHeight:e.screen.availHeight,colorDepth:e.screen.colorDepth,pixelDepth:e.screen.pixelDepth,orientation:"object"==typeof e.screen.orientation?e.screen.orientation.type:void 0,screenX:e.screenX,screenY:e.screenY,outerWidth:e.outerWidth,outerHeight:e.outerHeight,innerWidth:e.innerWidth,innerHeight:e.innerHeight,devicePixelRatio:e.devicePixelRatio},"Фокусник":de.ПолучитьСостояние(),"Настройки":me.ПолучитьДанныеДляОтчета(),"Статистика":ge.ПолучитьДанныеДляОтчета(),"СписокВариантов":a,"СпискиСегментов":o,"Журнал":м_Журнал.ПолучитьДанныеДляОтчета()},r)})})}function u(e){var t;throw void(q||(console.error(e),Ne(!1),t=Y(e),s().then(e=>{e.getElementById("отладка-текстсообщения").textContent=t,c(e,"отладка-сообщение",!0)})))}function d(e,t){if(!q){console.error(e),(e=String(e)).includes("out of memory")&&u("J0200");try{Ee.ПоказатьСостояние("Вот","[Отладка] Завершаю работу"),se.ПоказатьСостояние()}catch(e){}Ne(!1),l(e,t)}throw void 0}const f=500;var h,m,g=0,p=0;const b=r(()=>{var e=n.now(),r=Date.now();if(_e.ПолучитьСостояние()!==I&&_e.ПолучитьСостояние()!==S){var i=e-h,a=i-(t.hidden?Math.max(f,1e3):f),o=r-m-i;(a>200||Math.abs(o)>40)&&м_Журнал.Ой(`[Пульс] ${м_Журнал.F0(a)} ${м_Журнал.F0(o)}`),p=Math.max(p,a)}h=e,m=r,g=setTimeout(b,f)});return{"Запустить":function(){Проверить(0===g),h=n.now(),m=Date.now(),g=setTimeout(b,f)},"Остановить":function(){0!==g&&(clearInterval(g),g=0)},"ЗавершитьРаботуИПоказатьСообщение":u,"ЗавершитьРаботуИОтправитьОтчет":d,"ЗавершитьРаботуИОтправитьОтзыв":function(){try{d("ОТПРАВИТЬ ОТЗЫВ")}catch(e){}},"ПойманоИсключение":function(e){d(e instanceof Error?e.stack:`[typeof ${typeof e}] ${new Error(e).stack}`)},"СохранитьСписокВариантов":function(e){q||(a=ОграничитьДлинуСтроки(e,15e3))},"СохранитьСписокСегментов":function(e){q||(3===o.length&&o.shift(),o.push(ОграничитьДлинуСтроки(e,15e3)))},"СохранитьТранспортныйПоток":function(e){},"СохранитьПреобразованныйСегмент":function(e){}}})();function ie(){this._лВыполняется=!1,this._фОбработчик=null}function ae(e,t){return Проверить(Number.isFinite(t)),t=Math.round(t),Проверить(t>=0&&t<=2147483647),new Promise((n,r)=>{const i=setTimeout(n,t);e&&e.ЗаменитьОбработчик(()=>{clearTimeout(i),r(ie.ОБЕЩАНИЕ_ОТМЕНЕНО)})})}function oe(e,t,n,r,i,a){switch(Проверить("number"==typeof e&&e>=g&&e<=v),Проверить("number"==typeof t&&t>=_&&t<=S||W(t)||"string"==typeof t&&e===g),arguments.length){case 2:n=0,r=!0,i=NaN;case 5:Проверить(Number.isFinite(n)&&n>=0),Проверить("boolean"==typeof r),Проверить("number"==typeof i),a=++oe._чНомер;case 6:Проверить(Number.isFinite(a));break;default:Проверить(!1)}"number"==typeof t&&м_Журнал.Окак(`[Очередь] Добавлен сегмент ${a} Состояние=${t} Обработка=${e}`),this.чОбработка=e,this.пДанные=t,this.чДлительность=n,this.лРазрыв=r,this.чTwitchПрошлоВремени=i,this.чНомер=a}ie.ОБЕЩАНИЕ_ОТМЕНЕНО=new Error("ОБЕЩАНИЕ ОТМЕНЕНО"),ie.prototype.НачалоВыполнения=function(){Проверить(!this._лВыполняется),this._лВыполняется=!0},ie.prototype.Отменить=function(){this._лВыполняется=!1,this._фОбработчик&&(this._фОбработчик(),this._фОбработчик=null)},ie.prototype.ЗаменитьОбработчик=function(e){Проверить(this._лВыполняется),Проверить("function"==typeof e||null===e),this._фОбработчик=e},oe._чНомер=0,oe.prototype.toString=function(){return this.пДанные===_?`${this.чНомер}-${this.чОбработка}-Н`:this.пДанные===E?`${this.чНомер}-${this.чОбработка}-К`:this.лРазрыв?`${this.чНомер}-${this.чОбработка}-Р`:`${this.чНомер}-${this.чОбработка}`};let se=[];function ce(e,n,r,i){Проверить(r>=0),this._сИмяНастройки=e,this._оПараметрыНастройки=me.ПолучитьПараметрыНастройки(e),this._чШаг=n,this._чТочность=r,this._чТаймер=0,this._кИнтервал=0,this._чДобавить=0,this._узУзел=t.getElementById(i),this._узУзел.addEventListener("mousedown",this),this._Показать()}se.ПолучитьКоличествоПреобразованныхСегментов=function(){for(var e=0,t=0;e<this.length&&this[e].чОбработка===v;++e)"number"!=typeof this[e].пДанные&&(t+=this[e].чДлительность);return{"кКоличество":e,"чДлительность":t}},se.Добавить=function(e){for(var t of(Проверить(e instanceof oe),this))Проверить(t.чНомер!==e.чНомер);if(e.чОбработка!==v)this.push(e);else{var n=this.ПолучитьКоличествоПреобразованныхСегментов();n.чДлительность>1.5*s&&re.ЗавершитьРаботуИПоказатьСообщение("J0208"),this.splice(n.кКоличество,0,e)}return e},se.Удалить=function(e,t){if(0!==t){if(void 0===t?t=1:Проверить(Number.isInteger(t)&&t>=1),"number"==typeof e){Проверить(Number.isInteger(e)&&e>=0);var n=e}else if(-1===(n=this.indexOf(e)))return void Проверить(e instanceof oe);for(;--t>=0;){switch(Проверить(n<this.length),this[n].чОбработка){case p:W(this[n].пДанные)&&(м_Журнал.Вот(`[Очередь] Отменяю загрузку ${this[n]}`),this[n].пДанные.Отменить());break;case b:le.Выбросить(this[n].пДанные);break;case v:W(this[n].пДанные)&&(le.Выбросить(this[n].пДанные.мбСегментИнициализации),le.Выбросить(this[n].пДанные.мбМедиасегмент))}м_Журнал.Вот(`[Очередь] Удаляю ${this[n]}`),this.splice(n,1)}}},se.Очистить=function(){this.Удалить(0,this.length)},se.ПоказатьСостояние=function(){м_Журнал.Вот(`[Очередь] ${se.join(" ")}`)},ce.prototype._Показать=function(e=me.Получить(this._сИмяНастройки)){this._узУзел.children[1].value=e===F?Y(this._оПараметрыНастройки.сАвтонастройка):м_i18n.ФорматироватьЧисло(e,this._чТочность)},ce.prototype.handleEvent=r(function(e){switch(e.type){case"mousedown":if(0===e.button&&0===this._чТаймер&&de.ПолучитьСостояние().лАктивен){switch(e.target.className){case"вводчисла-минус":this._чДобавить=-this._чШаг;break;case"вводчисла-плюс":this._чДобавить=this._чШаг;break;default:return}t.addEventListener("mouseup",this),ue.ДобавитьОбработчик("фокусник-изменилосьсостояние",this),this._чТаймер=setInterval(()=>this._ОбработатьТаймер(),130),this._кИнтервал=0,this._ОбработатьТаймер()}return;case"фокусник-изменилосьсостояние":if(e.data.лАктивен)return}0!==this._чТаймер&&(t.removeEventListener("mouseup",this),ue.УдалитьОбработчик("фокусник-изменилосьсостояние",this),clearInterval(this._чТаймер),this._чТаймер=0)}),ce.prototype._ОбработатьТаймер=r(function(){if(1==++this._кИнтервал||this._кИнтервал>3){const e=me.Получить(this._сИмяНастройки);let t;(t=this._оПараметрыНастройки.сАвтонастройка&&this._чДобавить<0&&e===this._оПараметрыНастройки.чМинимальное||this._оПараметрыНастройки.сАвтонастройка&&this._чДобавить>0&&e===this._оПараметрыНастройки.чМаксимальное?F:e===F&&this._чДобавить>0?this._оПараметрыНастройки.чМинимальное:e===F&&this._чДобавить<0?this._оПараметрыНастройки.чМаксимальное:e+this._чДобавить)!==F&&(t=G(V(t,this._чТочность),this._оПараметрыНастройки.чМинимальное,this._оПараметрыНастройки.чМаксимальное)),t!==e&&(me.Изменить(this._сИмяНастройки,t),this._Показать(t),this.ПослеИзменения(t))}}),ce.prototype.Обновить=function(){this._Показать()},ce.prototype.ПослеИзменения=ЗАГЛУШКА;const le=(()=>{function e(){this._оПомойка=null}function t(){this._сАдрес="",this._оПомойка=null,this._кбВПомойке=0}function n(){}return e.prototype.Выбросить=function(e){W(e)&&(e.buffer&&(e=e.buffer),e.byteLength&&(м_Журнал.Вот(`[Помойка] Выбрасываю ${e.byteLength} байтов`),null===this._оПомойка&&(this._оПомойка=new MessageChannel,this._оПомойка.port2.close()),this._оПомойка.port1.postMessage(e,[e])))},e.prototype.Сжечь=function(){this._оПомойка=null},t.prototype.Выбросить=function(e){W(e)&&(e.buffer&&(e=e.buffer),e.byteLength&&(м_Журнал.Вот(`[Помойка] Выбрасываю ${e.byteLength} байтов`),null===this._оПомойка&&(""===this._сАдрес&&(this._сАдрес=URL.createObjectURL(new Blob(["\n\t\t\t\t\t\t\t\t'use strict';\n\t\t\t\t\t\t\t\tself.onmessage = оСобытие =>\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (!оСобытие.data)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tself.close();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t"],{type:"application/javascript"}))),this._оПомойка=new Worker(this._сАдрес)),this._кбВПомойке+=e.byteLength,this._оПомойка.postMessage(e,[e]),this._кбВПомойке>1e7&&this.Сжечь()))},t.prototype.Сжечь=function(){null!==this._оПомойка&&(м_Журнал.Вот(`[Помойка] Сжигаю ${this._кбВПомойке} байтов`),this._оПомойка.postMessage(null),this._оПомойка=null,this._кбВПомойке=0)},n.prototype.Выбросить=ЗАГЛУШКА,n.prototype.Сжечь=ЗАГЛУШКА,new n})(),ue=(()=>{var e=new Map;return{"ДобавитьОбработчик":function(t,n){Проверить(ЭтоНепустаяСтрока(t)),Проверить("function"==typeof n||W(n));var r=e.get(t);void 0===r&&(r=new Set,e.set(t,r)),r.add(n)},"УдалитьОбработчик":function(t,n){Проверить(ЭтоНепустаяСтрока(t)),Проверить("function"==typeof n||W(n));var r=e.get(t);void 0!==r&&(r.delete(n),0===r.size&&e.delete(t))},"ОбработатьСобытие":function(t,n){if(q)return;Проверить(ЭтоНепустаяСтрока(t)),м_Журнал.Вот(`[События] Произошло событие ${t}`);const r=e.get(t);if(void 0!==r)for(var i of(Проверить(0!==r.size),r.values()))if("function"==typeof i)i(t,n);else{if(void 0===a)var a={type:t,data:n};i.handleEvent(a)}}}})(),de=(()=>{var n=null;function i(){const e=!t.hidden;return{"лПоказан":e,"лАктивен":e&&t.hasFocus()}}const a=r(()=>{const e=i();n.лПоказан===e.лПоказан&&n.лАктивен===e.лАктивен||(м_Журнал.Окак(`[Фокусник] Новое состояние ${м_Журнал.O(e)}`),n=e,ue.ОбработатьСобытие("фокусник-изменилосьсостояние",e))}),o=r(e=>{м_Журнал.Вот(`[Фокусник] Событие ${e.type}, старое состояние ${м_Журнал.O(n)}`),setImmediate(a)});return t.addEventListener("visibilitychange",o),e.addEventListener("focus",o),e.addEventListener("blur",o),n=i(),м_Журнал.Вот(`[Фокусник] Начальное состояние ${м_Журнал.O(n)}`),{"ПолучитьСостояние":function(){return n}}})(),fe=(()=>{let e,i,a,o,s,c,l,u,d=new Map,f=null;function h(e,t,n,r){switch(e){case 1:const i=getComputedStyle(t);l=Number.parseInt(i.left,10),u=Number.parseInt(i.top,10);break;case 2:t.style.left=`${l-n}px`,t.style.top=`${u-r}px`;break;case 3:break;default:Проверить(!1)}}const m=r(n=>{Проверить(null===f);const r=n.target;(e=d.get(r.id))&&(f=r,м_Журнал.Окак(`[Тащилка] Начинаю тащить ${f.id} X=${n.clientX} Y=${n.clientY}`),Проверить("true"===f.getAttribute("draggable")),setImmediate(()=>{f&&t.body.classList.add("js-тащилка-страница")}),f.classList.add("js-тащилка-элемент"),e(1,f),i=0,a=s=n.clientX,o=c=n.clientY,n.dataTransfer.setData("text",""),n.dataTransfer.effectAllowed="move",n.dataTransfer.setDragImage?n.dataTransfer.setDragImage(t.head,0,0):(r.classList.add("js-тащилка-скрыть"),setImmediate(()=>{r.classList.remove("js-тащилка-скрыть")})))}),g=r(e=>{f&&e.preventDefault()}),p=r(t=>{if(f){t.preventDefault();const r=n.now();if(r-i<50)return;i=r;const l=s!==t.clientX,u=c!==t.clientY;(l||u)&&(s=t.clientX,c=t.clientY,e(2,f,a-s,o-c,l,u))}}),b=r(e=>{f&&(м_Журнал.Окак(`[Тащилка] Заканчиваю тащить ${f.id} X=${s} Y=${c} dropEffect=${e.dataTransfer.dropEffect}`),v(!1))});function v(n){e(3,f),t.body.classList.remove("js-тащилка-страница"),f.classList.remove("js-тащилка-элемент"),f=null}return{"ДобавитьОбработчик":function(e,n){null===n&&(n=h),Проверить("function"==typeof n);const r=t.getElementById(e);return r.setAttribute("draggable","true"),d.set(e,n),1===d.size&&(t.addEventListener("dragstart",m),t.addEventListener("dragenter",g),t.addEventListener("dragover",p),t.addEventListener("drop",g),t.addEventListener("dragend",b)),r},"ОтменитьПеретаскивание":function(e){Проверить(void 0===e||ЭтоНепустаяСтрока(e)),!f||void 0!==e&&e!==f.id||(м_Журнал.Окак(`[Тащилка] Отказываюсь тащить ${f.id}`),v())}}})(),he=(()=>{const e='input[type="color"]';var n="",i=null;const a=r(t=>{t.target.matches(e)&&s()}),o=r(t=>{t.target.matches(e)&&me.Изменить(t.target.id,t.target.value)});function s(){Проверить(n);const r=1-me.Получить("чПрозрачность")/100,i={"чНепрозрачность":r,"чНепрозрачностьОкна":G(r,.85,1)};for(var a of t.querySelectorAll(e))i[a.id]=Number.parseInt(a.value.slice(1,3),16)+","+Number.parseInt(a.value.slice(3,5),16)+","+Number.parseInt(a.value.slice(5,7),16);t.getElementById("стиль").textContent=function(e,t){return e.replace(/{{.*?}}/g,e=>{const n=t[e.slice(2,-2)];return"string"==typeof n?n:(Проверить(Number.isFinite(n)),String(V(n,2)))})}(n,i)}function c(){!function(){for(var n of t.querySelectorAll(e))n.value=me.Получить(n.id);i.Обновить()}(),s()}return{"ЗапуститьАсинхронно":function(){return ke.ЗагрузитьТекст(null,chrome.extension.getURL("player.css"),0,"шаблон",!1).then(e=>{Проверить(!n&&e),n=e})},"Запустить":function(){(i=new ce("чПрозрачность",5,0,"прозрачность")).ПослеИзменения=s,t.addEventListener("input",a),t.addEventListener("change",o),ue.ДобавитьОбработчик("настройки-измениласьпредустановка-оформление",c),c()}}})(),me=(()=>{const n=2,i=[{"амДанные":new Map([["J0126",{"кОдновременныхЗагрузок":1,"чНачалоВоспроизведения":3,"чРазмерБуфера":5,"чРастягиваниеБуфера":15,"кЗаначка":0,"чИнтервалОпроса":c}],["J0127",{"кОдновременныхЗагрузок":2,"чНачалоВоспроизведения":3,"чРазмерБуфера":8.5,"чРастягиваниеБуфера":20,"кЗаначка":1,"чИнтервалОпроса":F}],["J0128",{"кОдновременныхЗагрузок":2,"чНачалоВоспроизведения":17,"чРазмерБуфера":9.5,"чРастягиваниеБуфера":30,"кЗаначка":0,"чИнтервалОпроса":F}]]),"сНастраиваемая":"J0129","сВыбрана":"сПредустановкаВыбрана_буферизация","сЗаполнена":"лПредустановкаЗаполнена_буферизация","сСписок":"предустановка-буферизация","сСобытие":"настройки-измениласьпредустановка-буферизация"},{"амДанные":new Map([["J0122",{"сЦветФона":"#282828","сЦветГрадиента":"#ffffff","сЦветКнопок":"#d3be96","сЦветЗаголовка":"#cdbdec","сЦветВыделения":"#ff9428","чПрозрачность":25}],["J0121",{"сЦветФона":"#425e7b","сЦветГрадиента":"#ffffff","сЦветКнопок":"#ffffff","сЦветЗаголовка":"#d1f0fa","сЦветВыделения":"#ffaa33","чПрозрачность":30}],["J0138",{"сЦветФона":"#4b4b4b","сЦветГрадиента":"#aaaaaa","сЦветКнопок":"#bad4f8","сЦветЗаголовка":"#e2ebb4","сЦветВыделения":"#75a9f0","чПрозрачность":5}],["J0125",{"сЦветФона":"#141414","сЦветГрадиента":"#c8c8c8","сЦветКнопок":"#f0f0f0","сЦветЗаголовка":"#b6c3c3","сЦветВыделения":"#6cb6ff","чПрозрачность":10}]]),"сНастраиваемая":"J0123","сВыбрана":"сПредустановкаВыбрана_оформление","сЗаполнена":"лПредустановкаЗаполнена_оформление","сСписок":"предустановка-оформление","сСобытие":"настройки-измениласьпредустановка-оформление"}],a=new Set(["чСлучайноеЧисло","сПредыдущаяВерсия","чВерсияНастроек"]);function s(e,t,n,r,i){this.пТекущее=void 0,this.пНачальное=e,this.мпПеречисление=t,this.чМинимальное=n,this.чМаксимальное=r,this.сАвтонастройка=i}s.Создать=function(e){return new this(e,null,M,A,"")},s.СоздатьПеречисление=function(e,t){return new this(e,t,M,A,"")},s.СоздатьДиапазон=function(e,t,n,r=""){return new this(e,null,t,n,r)},s.ПроверитьЗначение=function(e){Проверить(e==e&&e!==1/0&&e!==-1/0&&void 0!==e&&"function"!=typeof e&&"symbol"!=typeof e&&"object"!=typeof e)},s.prototype.ИсправитьЗначение=function(e){return s.ПроверитьЗначение(e),Проверить(typeof e==typeof this.пНачальное),this.мпПеречисление?this.мпПеречисление.includes(e)||(e=this.пНачальное):"number"==typeof e&&(e===F?""===this.сАвтонастройка&&(e=this.пНачальное):e<this.чМинимальное?e=this.чМинимальное:e>this.чМаксимальное&&(e=this.чМаксимальное)),e};const l={"чСлучайноеЧисло":s.Создать(Math.random()),"сПредыдущаяВерсия":s.Создать("2000.1.1"),"чВерсияНастроек":s.Создать(n),"чГромкость2":s.СоздатьДиапазон(h/2,f,h),"лПриглушить":s.Создать(!1),"сНазваниеВарианта":s.Создать("CoolCmd"),"чДлительностьПовтора2":s.СоздатьДиапазон(60,30,300,"J0124"),"чСостояниеЧата":s.СоздатьПеречисление(D,[D,O,X]),"чСостояниеЗакрытогоЧата":s.СоздатьПеречисление(D,[D,O]),"лАвтоПоложениеЧата":s.Создать(!1),"чГоризонтальноеПоложениеЧата":s.СоздатьПеречисление(R,[R,U]),"чВертикальноеПоложениеЧата":s.СоздатьПеречисление(J,[P,J]),"чПоложениеПанелиЧата":s.СоздатьПеречисление(R,[P,R,J,U]),"чШиринаПанелиЧата":s.СоздатьДиапазон(340,100,A),"чВысотаПанелиЧата":s.СоздатьДиапазон(310,100,A),"лПолноценныйЧат":s.Создать(!0),"лЗатемнитьЧат":s.Создать(!1),"чРазмерИнтерфейса":s.СоздатьДиапазон(100,75,200),"чИнтервалАвтоскрытия":s.СоздатьДиапазон(4,.5,60),"лАнимацияИнтерфейса":s.Создать(!0),"лМенятьГромкостьКолесом":s.Создать(!0),"лПоказатьСтатистику":s.Создать(!1),"сПредустановкаВыбрана_буферизация":s.Создать("J0127"),"лПредустановкаЗаполнена_буферизация":s.Создать(!1),"кОдновременныхЗагрузок":s.СоздатьДиапазон(0,1,3),"чНачалоВоспроизведения":s.СоздатьДиапазон(0,o,30),"чРазмерБуфера":s.СоздатьДиапазон(0,o,30),"чРастягиваниеБуфера":s.СоздатьДиапазон(0,9,30),"кЗаначка":s.СоздатьДиапазон(0,0,2),"чИнтервалОпроса":s.СоздатьДиапазон(0,c,250,"J0120"),"сПредустановкаВыбрана_оформление":s.Создать("J0122"),"лПредустановкаЗаполнена_оформление":s.Создать(!1),"сЦветФона":s.Создать(""),"сЦветГрадиента":s.Создать("#ffffff"),"сЦветКнопок":s.Создать(""),"сЦветЗаголовка":s.Создать(""),"сЦветВыделения":s.Создать(""),"чПрозрачность":s.СоздатьДиапазон(0,0,80)},u=500;let d=0,m=null;function g(){chrome.runtime.lastError&&(console.error(chrome.runtime.lastError.message),re.ЗавершитьРаботуИПоказатьСообщение("J0212"))}function p(e,t){t&&(chrome.storage.local.clear(g),м_Журнал.Вот("[Настройки] Все настройки удалены из хранилища")),chrome.storage.local.set(e,g),м_Журнал.Вот(`[Настройки] Настройки записаны в хранилище: ${м_Журнал.O(e)}`)}function b(e,t){Проверить(W(e)),(t||0!==Object.keys(e).length)&&(0===d?t?p(e,t):(м_Журнал.Вот(`[Настройки] Откладываю сохранение настроек на ${u}мс`),d=setTimeout(v,u),m=e):t?(clearTimeout(d),d=0,m=null,p(e,t)):Object.assign(m,e))}const v=r(()=>{м_Журнал.Вот("[Настройки] Завершаю отложенное сохранение"),Проверить(0!==d&&W(m)),p(m,!1),d=0,m=null});function y(e,t){if(void 0===e.чВерсияНастроек){for(let n of Object.keys(e))a.has(n)?t[n]=e[n]:delete e[n];return!0}if(e.чВерсияНастроек>n){for(let t of Object.keys(e))delete e[t];return!0}for(let n of i){let r=e[n.сВыбрана];if(void 0!==r&&r!==n.сНастраиваемая){for(let e of n.амДанные.keys())if(r===e){r=void 0;break}void 0!==r&&(t[n.сВыбрана]=e[n.сВыбрана]=l[n.сВыбрана].пНачальное)}}return e.чСостояниеЗакрытогоЧата===e.чСостояниеЧата||e.чСостояниеЧата!==D&&e.чСостояниеЧата!==O||(t.чСостояниеЗакрытогоЧата=e.чСостояниеЗакрытогоЧата=e.чСостояниеЧата),e.чВерсияНастроек!==n&&(t.чВерсияНастроек=e.чВерсияНастроек=n,!1)}function _(e){Проверить("string"==typeof e),Проверить(l.hasOwnProperty(e));for(let t of i){const n=t.амДанные.get(l[t.сВыбрана].пТекущее);if(n){const t=n[e];if(void 0!==t)return t}}return l[e].пТекущее}function E(e,t,n=!1){if(q)return;Проверить("string"==typeof e),Проверить(l[e].ИсправитьЗначение(t)===t);const r={};for(let a of i){const i=a.амДанные.get(l[a.сВыбрана].пТекущее);if(i&&i.hasOwnProperty(e)){if(t===i[e])return;Проверить(!n),r[a.сВыбрана]=l[a.сВыбрана].пТекущее=a.сНастраиваемая,r[a.сЗаполнена]=l[a.сЗаполнена].пТекущее=!0;for(let e of Object.keys(i))r[e]=l[e].пТекущее=i[e];w(a);break}}l[e].пТекущее!==t&&(r[e]=l[e].пТекущее=t),n||b(r,!1)}function w(e){const n=t.getElementById(e.сСписок);n.length=0;const r=l[e.сВыбрана].пТекущее;for(let t of e.амДанные.keys())n.add(new Option(Y(t),t,t===r,t===r));return l[e.сЗаполнена].пТекущее&&n.add(new Option(Y(e.сНастраиваемая),e.сНастраиваемая,e.сНастраиваемая===r,e.сНастраиваемая===r)),Проверить(n.value),n}const $=r(e=>{for(let t of i)if(t.сСписок===e.target.id)return Проверить(e.target.value),E(t.сВыбрана,e.target.value),void ue.ОбработатьСобытие(t.сСобытие);Проверить(!1)});return{"Восстановить":function(){return м_Журнал.Вот("[Настройки] Восстанавливаю настройки"),new Promise((e,t)=>{chrome.storage.local.get(null,n=>{try{chrome.runtime.lastError?(console.error(chrome.runtime.lastError.message),re.ЗавершитьРаботуИПоказатьСообщение("J0209")):(м_Журнал.Вот(`[Настройки] Настройки прочитаны из хранилища: ${м_Журнал.O(n)}`),function(e){Проверить(W(e)),Проверить(!l.чВерсияНастроек.пТекущее);const t={},n=y(e,t);for(let n of Object.keys(l))if(e.hasOwnProperty(n)){const r=l[n].ИсправитьЗначение(e[n]);r!==e[n]&&(t[n]=r),l[n].пТекущее=r}else a.has(n)&&(t[n]=l[n].пНачальное),l[n].пТекущее=l[n].пНачальное;b(t,n),function(){for(let e of i)w(e).addEventListener("change",$)}()}(n),e())}catch(e){t(e)}})})},"Сбросить":function(){м_Журнал.Окак("[Настройки] Сбрасываю настройки");const t={};for(let e of a)t[e]=l[e].пТекущее;b(t,!0),e.location.reload()},"Экспорт":function(){м_Журнал.Окак("[Настройки] Экспортирую настройки"),Проверить(l.чВерсияНастроек.пТекущее);const e={"чВерсияНастроек":n};for(let t of Object.keys(l))a.has(t)||(e[t]=l[t].пТекущее);м_Журнал.Вот(`[Настройки] Отобраны настройки для экспорта: ${м_Журнал.O(e)}`),function(e,n,r){Проверить("string"==typeof e&&ЭтоНепустаяСтрока(n)&&ЭтоНепустаяСтрока(r));const i=t.createElement("a");i.setAttribute("href",URL.createObjectURL(new Blob([e],{type:n}))),i.setAttribute("download",r),i.dispatchEvent(new MouseEvent("click"))}(JSON.stringify(e),"application/json",Y("J0133"))},"Импорт":function(t){if(м_Журнал.Окак(`[Настройки] Импортирую настройки из файла ${t.name}`),Проверить(l.чВерсияНастроек.пТекущее),0===t.size||t.size>1e4)return м_Журнал.Ой(`[Настройки] Размер файла: ${t.size}`),void alert(Y("J0134"));const n=new FileReader;n.addEventListener("loadend",r(()=>{if(!ЭтоНепустаяСтрока(n.result))return м_Журнал.Ой(`[Настройки] Результат чтения файла: ${n.result}`),void alert(Y("J0135")+t.name);let r;м_Журнал.Вот(`[Настройки] Настройки прочитаны из файла: ${n.result}`);try{if(!W(r=JSON.parse(n.result)))throw 1;if(y(r,r))throw 2;for(let e of Object.keys(r))l.hasOwnProperty(e)&&(r[e]=l[e].ИсправитьЗначение(r[e]))!==l[e].пНачальное||delete r[e]}catch(e){return м_Журнал.Ой(`[Настройки] Поймано исключение во время разбора настроек: ${e}`),void alert(Y("J0134"))}for(let e of a)r[e]=l[e].пТекущее;b(r,!0),e.location.reload()})),n.readAsText(t)},"Получить":function(e){return"чМаксРазмерБуфера"===e?Math.max(_("чНачалоВоспроизведения"),_("чРазмерБуфера")):_(e)},"Изменить":E,"ПолучитьПараметрыНастройки":function(e){return Проверить("string"==typeof e),Проверить(l.hasOwnProperty(e)),l[e]},"ПолучитьДанныеДляОтчета":function(){const e={};for(let t of Object.keys(l))(a.has(t)||l[t].пТекущее!==l[t].пНачальное)&&(e[t]=l[t].пТекущее);return e},"Остановить":function(){0!==d&&(clearTimeout(d),v())}}})(),ge=(()=>{const e=3,i=30,a=30,o=40,s=150,c=.5,l=1,u=1.5,d=.5,f=.85,h=.2,m=300,y=5;var _,E,I,S=0,N=0,x=0,T=-1/0,L=1/0,C=null,B=null,M=null,A=null,F=null,D=null,O=null,X=0,P=0,R=0,J=0,U=0,j=0,q=0,H=0,Y=0,W=0,V=0;function G(e){return e>=s}function z(e){return 0===e||e>2}function Q(e){return e>=l}function Z(e){return e<u||e>=me.Получить("чМаксРазмерБуфера")+me.Получить("чРастягиваниеБуфера")*d}function ee(e,n,r){Проверить(n>0&&r>=0),this._узПоказать=t.getElementById(e),this._мчИстория=new Array(n),this._млВыделить=new Array(n),this._чТочность=r,this._Очистить()}function ne(e,n,r){var i="string"==typeof e?t.getElementById(e):e;return i.classList.toggle("статистика-выделить",r),i.textContent=n,i}ee.prototype.Освободить=function(){this._узПоказать.textContent="",this._узПоказать=null},ee.prototype._Очистить=function(){this._кЗаполнено=0,this._чИндекс=-1;var e=t.createDocumentFragment();e.appendChild(t.createElement("td")).className="анализ-минимум",e.appendChild(t.createElement("td")).textContent=" < ",e.lastChild.className="статистика-символ",e.appendChild(t.createElement("td")).className="анализ-среднее",e.appendChild(t.createElement("td")).textContent=" < ",e.lastChild.className="статистика-символ",e.appendChild(t.createElement("td")).className="анализ-максимум";for(var n=0;n<this._мчИстория.length;++n)e.appendChild(t.createElement("td")).setAttribute("class","анализ-история статистика-подробно");this._узПоказать.textContent="",this._узПоказать.appendChild(e)},ee.prototype._ВСтроку=function(e){return Number.isFinite(e)?e.toFixed(this._чТочность):" "},ee.prototype.Очистить=function(){0!==this._кЗаполнено&&this._Очистить()},ee.prototype.ПолучитьПоследнееЧисло=function(e){return 0===this._кЗаполнено?e:this._мчИстория[this._чИндекс]},ee.prototype.ДобавитьЧисло=function(e,t,n){var r=Boolean("function"==typeof t?t(e):t);0!==this._кЗаполнено&&this._узПоказать.children[5+this._чИндекс].classList.add("статистика-подробно"),this._кЗаполнено!==this._мчИстория.length&&++this._кЗаполнено,++this._чИндекс===this._мчИстория.length&&(this._чИндекс=0),this._мчИстория[this._чИндекс]=e,this._млВыделить[this._чИндекс]=r;for(var i=1/0,a=!1,o=-1/0,s=!1,c=0,l=0,u=0;u<this._кЗаполнено;++u)Number.isFinite(this._мчИстория[u])&&((this._мчИстория[u]<i||this._мчИстория[u]===i&&this._млВыделить[u])&&(i=this._мчИстория[u],a=this._млВыделить[u]),(this._мчИстория[u]>o||this._мчИстория[u]===o&&this._млВыделить[u])&&(o=this._мчИстория[u],s=this._млВыделить[u]),c+=this._мчИстория[u],++l);if(0===l){c=NaN;var d=!1}else{c/=l;d=Boolean("function"==typeof n?n(c):n)}return ne(this._узПоказать.children[0],this._ВСтроку(i),a),ne(this._узПоказать.children[2],this._ВСтроку(c),d),ne(this._узПоказать.children[4],this._ВСтроку(o),s),ne(this._узПоказать.children[5+this._чИндекс],this._ВСтроку(e),r).classList.remove("статистика-подробно"),c};const re=r(()=>{t.getElementById("статистика-длительностьпросмотра").textContent=м_i18n.ПеревестиСекундыВСтроку(n.now()/1e3,!0);var r=Ee.ПолучитьКоличествоПропущенныхКадров();ne("статистика-пропущено",r.droppedVideoFrames,r.droppedVideoFrames>=100).nextElementSibling.nextElementSibling.textContent=r.totalVideoFrames;var i=0,a=0,o=0,s=0,c=0;for(var l of se)switch(l.чОбработка){case g:++i,a+=l.чДлительность;break;case p:case b:o+=l.чДлительность;break;case v:++s,c+=l.чДлительность;break;default:Проверить(!1)}var u=Ee.ПолучитьЗаполненностьБуфера(),d=ne("статистика-очередь",a.toFixed(1),i>x);(d=d.nextElementSibling.nextElementSibling).textContent=o.toFixed(1),ne(d=d.nextElementSibling,c.toFixed(1),s>=2),ne(d=d.nextElementSibling,u.чНеПросмотрено.toFixed(1),Z(u.чНеПросмотрено)),(d=d.nextElementSibling.nextElementSibling).textContent=u.чПросмотрено.toFixed(1),[w,$,k].includes(_e.ПолучитьСостояние())&&(E=Math.min(E,u.чНеПросмотрено),0===(I=(I+1)%e)&&(O.ДобавитьЧисло(E,Z,Z),E=1/0))});function ie(){return 0!==S}return ue.ДобавитьОбработчик("список-выбранварианттрансляции",function(e,n){const r=n[0],i=n[1];r&&(t.getElementById("статистика-сервер").textContent=new URL(r[i].сАбсолютныйАдресСпискаСегментов).host)}),ue.ДобавитьОбработчик("проигрыватель-переполненбуфер",function(e,t){++H,Y+=t,ie()&&(ne("статистика-переполнено",H,!0).nextElementSibling.nextElementSibling.textContent=Y.toFixed(1))}),{"ОкноПоказано":ie,"ОткрытьОкно":function(){ie()||(C=new ee("статистика-интервалобновления",i,0),B=new ee("статистика-сегментовдобавлено",i,0),M=new ee("статистика-секунддобавлено",i,1),A=new ee("статистика-толщинасегмента",a,1),F=new ee("статистика-толщинаканала",a,1),D=new ee("статистика-ожиданиеответа",a,1),O=new ee("статистика-непросмотрено",o,1),_=NaN,E=1/0,I=0,ne("статистика-забраковано",R,0!==R),ne("статистика-потерьвидео",J,0!==J),ne("статистика-потерьзвука",U,0!==U),t.getElementById("статистика-исходных").textContent=P,ne("статистика-незагружено",j,0!==j).nextElementSibling.nextElementSibling.textContent=q,ne("статистика-переполнено",H,0!==H).nextElementSibling.nextElementSibling.textContent=Y.toFixed(1),ne("статистика-исчерпано",W,W>=y),S=setInterval(re,1e3/e),re(),fe.ДобавитьОбработчик("статистика",null),te("статистика",!0),me.Изменить("лПоказатьСтатистику",!0))},"ЗакрытьОкно":function(){if(ie()){for(var e of(clearInterval(S),S=0,te("статистика",!1),C.Освободить(),C=null,B.Освободить(),B=null,M.Освободить(),M=null,A.Освободить(),A=null,F.Освободить(),F=null,D.Освободить(),D=null,O.Освободить(),O=null,t.querySelectorAll("*[data-очистить]")))e.textContent="";me.Изменить("лПоказатьСтатистику",!1)}},"ОбновитьЗначение":ne,"ОчиститьИсторию":function(){null!==C&&(C.Очистить(),B.Очистить(),M.Очистить(),A.Очистить(),F.Очистить(),D.Очистить(),O.Очистить(),_=NaN,E=1/0,I=0),ne("статистика-незагружено",j=0,!1).nextElementSibling.nextElementSibling.textContent=q=0,ne("статистика-переполнено",H=0,!1).nextElementSibling.nextElementSibling.textContent=(Y=0).toFixed(1),ne("статистика-исчерпано",W=0,!1)},"ПолучитьTargetDuration":function(){return N},"ПолучитьДлительностьКадраВСекундах":function(){return{"чМинимальная":Math.max(17,T)/1e3,"чМаксимальная":Math.min(40,L)/1e3}},"ПолучитьДанныеДляОтчета":function(){return{"ОкноПоказано":ie(),"Сервер":t.getElementById("статистика-сервер").textContent,"ПараметрыВидео":t.getElementById("статистика-разрешениевидео").textContent+" "+t.getElementById("статистика-сжатиевидео").textContent,"ПараметрыЗвука":t.getElementById("статистика-сжатиезвука").textContent,"ВсегоСкачано":X,"Забраковано":R,"ПотерьВидео":J,"ПотерьЗвука":U,"ОшибокЗагрузки":j,"НезагруженныхСегментов":q,"ПереполненийБуфера":H,"ПропущеноВБуфере":Y,"ИсчерпанийБуфера":W,"ИсчерпанийБуфераДосрочно":V}},"СкачаноНечто":function(e){Number.isFinite(e)&&(X+=e,ie()&&(t.getElementById("статистика-скачано").textContent=(X/1024/1024).toFixed()))},"РазобранСписокСегментов":function(e,n,r){if(ie()){var i=t.getElementById("статистика-список");i.textContent=`${n} × ${(r/n).toFixed(1)} = ${r.toFixed(1)}`,ne(i.nextElementSibling.nextElementSibling,e,e!==N)}N=e,x=n},"ДобавленыСегментыВОчередь":function(e,t){if(ie()){var r=n.now();C.ДобавитьЧисло((r-_)/N/10,G,G),_=r;var i=B.ДобавитьЧисло(e,z,z);M.ДобавитьЧисло(t,t/e<N*c,e=>e/i<N*c)}},"ЗагруженСегмент":function(e,t,n,r){if(ie()){var i=A.ДобавитьЧисло(8*e/1e6/t);n/=1e3,F.ДобавитьЧисло(8*e/1e6/n,n>t,e=>e<i),D.ДобавитьЧисло(r/1e3,Q,Q)}},"НеЗагруженыСегменты":function(e){Проверить(e>0),++j,q+=e,ie()&&(ne("статистика-незагружено",j,!0).nextElementSibling.nextElementSibling.textContent=q)},"ОтосланИсходныйСегмент":function(){++P,ie()&&(t.getElementById("статистика-исходных").textContent=P)},"ПолученПреобразованныйСегмент":function(e){var n=ie(),r=e.пДанные;if(e.лРазрыв){t.getElementById("статистика-разрешениевидео").textContent=`${r.чШиринаКартинки}x${r.чВысотаКартинки}`;var i="H.264"+` ${function(e,t){switch(e){case 66:return 0==(64&t)?"Baseline":"Constrained Baseline";case 77:return"Main";case 88:return"Extended";case 100:switch(12&t){case 8:return"Progressive High";case 12:return"Constrained High"}return"High";case 110:return 0==(16&t)?"High 10":"High 10 Intra";case 122:return 0==(16&t)?"High 4:2:2":"High 4:2:2 Intra";case 244:return 0==(16&t)?"High 4:4:4 Predictive":"High 4:4:4 Intra";case 44:return"CAVLC 4:4:4 Intra"}return м_Журнал.Ой(`[Статистика] Неизвестный профиль H.264 ProfileIndication=${e} ConstraintSetFlag=${t}`),`P${e}C${t}`}(r.nProfileIndication,r.nConstraintSetFlag)}`+` L${(r.nLevelIndication/10).toFixed(1)}`+` RF${r.nMaxNumberReferenceFrames}`;-1!==r.чДиапазон&&(i+=0===r.чДиапазон?" 16-235":" 0-255"),r.лЧересстрочное&&(i+=" чересстрочное"),0!==r.чЧастотаКадров&&(i+=` ${r.чЧастотаКадров<0?"≈":""}${Math.abs(r.чЧастотаКадров).toFixed(2)} к/с`),t.getElementById("статистика-сжатиевидео").textContent=i,t.getElementById("статистика-сжатиезвука").textContent=["AAC-Main","AAC-LC","AAC-SSR","AAC-LTP"][r.nAudioObjectType-1]+` ${r.чЧастотаДискретизации} Гц`+` ${r.чКоличествоКаналов} канал.`}if(Number.isFinite(r.чСредняяДлительностьВидеоСемпла)){T=r.чМинДлительностьВидеоСемпла,L=r.чМаксДлительностьВидеоСемпла,Проверить(T<=L);var a=r.чСредняяДлительностьВидеоСемпла/r.чМаксДлительностьВидеоСемпла,o=r.чМаксДлительностьВидеоСемпла-r.чСредняяДлительностьВидеоСемпла;a<=h&&o>=m&&(м_Журнал.Ой(`[Статистика] Превышено отклонение длительности кадра в сегменте ${e.чНомер}`+` СредняяДлительностьКадра=${м_Журнал.F0(r.чСредняяДлительностьВидеоСемпла)}мс`+` АбсолютноеОтклонение=${м_Журнал.F0(o)}мс`+` ОтносительноеОтклонение=${м_Журнал.F2(a)}`),r.лПотериВидео=!0)}n&&(Number.isFinite(r.чСредняяДлительностьВидеоСемпла)&&ne("статистика-частотакадров",`@${(1e3/r.чСредняяДлительностьВидеоСемпла).toFixed(0)}`+` −${(100-r.чСредняяДлительностьВидеоСемпла/r.чМаксДлительностьВидеоСемпла*100).toFixed()}%`+` +${(r.чСредняяДлительностьВидеоСемпла/r.чМинДлительностьВидеоСемпла*100-100).toFixed()}%`,a<=f),K(r.чБитрейтЗвука)&&(t.getElementById("статистика-битрейтзвука").textContent=`${r.чБитрейтЗвука.toFixed()} кбит/с`),K(r.чПреобразованЗа)&&(t.getElementById("статистика-преобразованоза").textContent=r.чПреобразованЗа.toFixed())),r.лПотериВидео&&(++J,n&&ne("статистика-потерьвидео",J,!0)),r.лПотериЗвука&&(++U,n&&ne("статистика-потерьзвука",U,!0)),r.лЗабраковано&&(++R,n&&ne("статистика-забраковано",R,!0))},"ИсчерпанБуферПроигрывателя":function(e){++W,e&&++V,ie()&&ne("статистика-исчерпано",W,W>=y)}}})(),pe=(()=>{let n,i=null,a=!1,o="";function s(){switch(getComputedStyle(t.getElementById("проигрывательичат")).flexDirection){case"column-reverse":return P;case"row":return R;case"column":return J;case"row-reverse":return U;default:Проверить(!1)}}function c(){if(!i){НачатьИздеватьсяНадЧатом(H);const e=Ie.ПолучитьАдресПанелиЧата();м_Журнал.Вот(`[Чат] Вставляю iframe ${e}`),(i=t.createElement("iframe")).id="чат",i.width=me.Получить("чШиринаПанелиЧата"),i.height=me.Получить("чВысотаПанелиЧата"),i.src=e,t.getElementById("размерчата").insertAdjacentElement("afterend",i)}}function l(){i&&(м_Журнал.Вот(`[Чат] Удаляю iframe ${i.src}`),i.remove(),i=null)}function u(){const e=me.Получить("чСостояниеЧата");switch(м_Журнал.Окак(`[Чат] Новое состояние панели: ${e}`),b(),e){case D:t.body.classList.remove("показатьчат"),l();break;case O:m(),c(),t.body.classList.remove("показатьчат");break;case X:m(),c(),t.body.classList.add("показатьчат");break;default:Проверить(!1)}}function d(){b();const e=t.body.classList;if(me.Получить("лАвтоПоложениеЧата"))e.add("автоположениечата"),e.toggle("чатвверху",me.Получить("чВертикальноеПоложениеЧата")===P),e.toggle("чатслева",me.Получить("чГоризонтальноеПоложениеЧата")===U);else{const t=me.Получить("чПоложениеПанелиЧата");e.remove("автоположениечата"),e.toggle("чатвверху",t===P),e.toggle("чатсправа",t===R),e.toggle("чатвнизу",t===J),e.toggle("чатслева",t===U)}}function f(e,t,n){Проверить(void 0===e||""===e||e.startsWith("http://")||e.startsWith("https://")),Проверить(void 0===t||"string"==typeof t),Проверить(void 0!==e||void 0!==t);const r=chrome.runtime.getManifest().sidebar_action;void 0!==e&&opr.sidebarAction.setPanel({panel:r.default_panel+"#"+encodeURIComponent(e)}),void 0!==t&&opr.sidebarAction.setTitle({title:t||r.default_title})}function h(e,t){opr.sidebarAction.getPanel({},r(n=>{if(chrome.runtime.lastError)throw`[Чат] Не удалось получить адрес боковой панели: ${chrome.runtime.lastError.message}`;Ie.ЭтоАдресПанелиЧата(decodeURIComponent(new URL(n).hash.slice(1)))&&f(e,t)}))}function m(){a&&(м_Журнал.Окак("[Чат] Закрываю боковую панель"),h("",""))}function g(e,t){void 0!==t.сИмя&&t.сИмя!==o&&(м_Журнал.Окак(`[Чат] Меняю заголовок боковой панели с ${o} на ${t.сИмя}`),o=t.сИмя,h(void 0,Y("J0137",t.сИмя)))}function p(e,r,a,o,c,l){const u=s(),d=u===R||u===U,f=u===P||u===U;switch(e){case 1:n=d?Number.parseInt(getComputedStyle(i).width,10):Number.parseInt(getComputedStyle(i).height,10),м_Журнал.Окак(`[Чат] Начальный размер чата: ${n}`);break;case 2:if(d){if(c){const e=Number.parseInt(getComputedStyle(t.getElementById("проигрывательичат")).width,10)-Number.parseInt(getComputedStyle(t.getElementById("проигрыватель")).minWidth,10);i.width=Math.max(Math.min(f?n-a:n+a,e),0)}}else if(l){const e=Number.parseInt(getComputedStyle(t.getElementById("проигрывательичат")).height,10);Number.parseInt(getComputedStyle(t.getElementById("проигрыватель")).minHeight,10),i.height=Math.max(Math.min(f?n-o:n+o,e),0)}break;case 3:d?me.Изменить("чШиринаПанелиЧата",Number.parseInt(getComputedStyle(i).width,10)):me.Изменить("чВысотаПанелиЧата",Number.parseInt(getComputedStyle(i).height,10));break;default:Проверить(!1)}}function b(){fe.ОтменитьПеретаскивание("размерчата")}return function(){if(a=Boolean(e.opr&&opr.sidebarAction))ue.ДобавитьОбработчик("twitch-полученыметаданныеканала",g);else{м_Журнал.Ой("[Чат] Боковая панель браузера недоступна");const e=t.getElementById("открытьбоковуюпанель");e&&e.nextElementSibling&&(e.nextElementSibling.remove(),e.remove())}}(),{"Восстановить":function(){u(),d(),fe.ДобавитьОбработчик("размерчата",p)},"ОбновитьПоложениеПанели":d,"ОбновитьАдрес":function(){i&&(м_Журнал.Окак("[Чат] Обновляю адрес iframe"),l(),c()),function(){if(a){const e=Ie.ПолучитьАдресПанелиЧата();м_Журнал.Окак(`[Чат] Меняю адрес боковой панели на ${e}`),h(e,void 0)}}()},"ПереключитьСостояниеПанели":function(){switch(me.Получить("чСостояниеЧата")){case D:case O:me.Изменить("чСостояниеЧата",X);break;case X:me.Изменить("чСостояниеЧата",me.Получить("чСостояниеЗакрытогоЧата"));break;default:Проверить(!1)}u()},"ПереключитьПоложениеПанели":function(){let e;switch(me.Получить("лАвтоПоложениеЧата")?(me.Изменить("лАвтоПоложениеЧата",!1),e=s()):e=me.Получить("чПоложениеПанелиЧата"),e){case P:me.Изменить("чПоложениеПанелиЧата",R);break;case R:me.Изменить("чПоложениеПанелиЧата",J);break;case J:me.Изменить("чПоложениеПанелиЧата",U);break;case U:me.Изменить("чПоложениеПанелиЧата",P);break;default:Проверить(!1)}d()},"ЗадатьСостояниеЗакрытойПанели":function(e){me.Изменить("чСостояниеЗакрытогоЧата",e);const t=me.Получить("чСостояниеЧата");t!==D&&t!==O||t===e||(me.Изменить("чСостояниеЧата",e),u())},"ОткрытьБоковуюПанель":function(){if(a){me.Изменить("чСостояниеЧата",D,!0),u();const e=Ie.ПолучитьАдресПанелиЧата();м_Журнал.Окак(`[Чат] Открываю боковую панель ${e}`),f(e,""===o?"":Y("J0137",o))}}}})(),be=(()=>{function e(e){var t=/^(\d+)\.(\d+)\.(\d+)(?:\.(\d+))?$/.exec(e);return t[1]|=0,t[2]|=0,t[3]|=0,t[4]|=0,Проверить(t[1]>=2e3&&t[1]<=2050),Проверить(t[2]>=1&&t[2]<=12),Проверить(t[3]>=1&&t[3]<=31),Проверить(t[4]>=0&&t[4]<=9),Date.UTC(t[1],t[2]-1,t[3],0,0,0,t[4])}function n(e,n){const r=t.getElementById("текстновостей");r.firstElementChild&&r.insertBefore(t.createElement("hr"),r.firstElementChild);for(let t=e.length;--t>=2;)м_i18n.InsertAdjacentHtmlMessage(r,"afterbegin",e[t]);const i=t.createElement("h4");i.textContent=0!==n?`${new Date(n).toLocaleDateString()} · ${Y(e[1])}`:Y(e[1]),r.insertBefore(i,r.firstChild)}function a(r,i){Проверить(K(r)&&r>=0||ЭтоНепустаяСтрока(r)),t.getElementById("текстновостей").textContent="";let a=!1,o="number"==typeof r?r:e(r);for(let t of г_мНовости)switch(t[0]){case"2000.2.2":n(t,0);break;case"2000.1.1":i&&(a=!0,n(t,0));break;default:const s=e(t[0]);if("number"==typeof r){if(--o<0)continue}else if(o>=s)continue;a=!0,n(t,s)}return a}const o=r(e=>{ee(e.target)&&(te("прокрутитьновости",!1),e.target.removeEventListener("scroll",o))});function s(e,n){if("новости"===n){const e=t.getElementById("текстновостей");e.scrollTop=0,ee(e)||(te("прокрутитьновости",!0),e.addEventListener("scroll",o)),te("переключитьновости",!1).classList.remove("непрочитано")}}function c(e,n){"новости"===n.сИдОкна&&(te("прокрутитьновости",!1),t.getElementById("текстновостей").removeEventListener("scroll",o),"отмена"===n.сДанные&&ne("отложитьновости")?te("переключитьновости",!0):me.Изменить("сПредыдущаяВерсия",i))}return{"Запустить":function(){ue.ДобавитьОбработчик("окна-открытоокно",s),ue.ДобавитьОбработчик("окна-закрытоокно",c);const e=me.Получить("сПредыдущаяВерсия");e!==i&&("2000.1.1"===e?(a(0,!0),te("отложитьновости",!1),te("переключитьновости",!0)):a(e,!1)?(te("отложитьновости",!0),te("переключитьновости",!0)):me.Изменить("сПредыдущаяВерсия",i))},"ОткрытьСправку":function(){"новости"!==ye.ПолучитьОткрытоеОкно()&&(ne("переключитьновости")||(a(3,!0),te("отложитьновости",!1)),ye.ОткрытьОкно("новости"))}}})(),ve=(()=>{var e,n=0,i=0;function a(e){return G(e,n,i)}const o=r(e=>{if(_e.ПолучитьСостояние()===S){const t=e.currentTarget.getBoundingClientRect(),r=getComputedStyle(e.currentTarget),o=Math.round(t.left+Number.parseFloat(r.paddingLeft)),s=Math.round(t.right-Number.parseFloat(r.paddingRight)),c=a((e.clientX+1-o)/(s-o)*(i-n)+n);м_Журнал.Окак(`[Шкала] Перематываю до ${c}`),Ee.ПеремотатьПовторДо(c)}});return{"ЗадатьНачалоИКонец":function(e,r){Проверить(e<=r),n=e,i=r,t.getElementById("шкала").addEventListener("click",o)},"ЗадатьПросмотрено":function(r){e=a(r),Проверить(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(e)),t.getElementById("шкала-просмотрено").style.transform=`scaleX(${((e-n)/(i-n)).toFixed(4)})`},"ПолучитьНачало":function(){return n},"ПолучитьКонец":function(){return i}}})(),ye=(()=>{function e(){return t.body.getAttribute("data-окно-открыто")||""}function n(n,r){Проверить("string"==typeof n&&"string"==typeof r),n&&n===e()&&(t.getElementById(n).classList.remove("окнооткрыто"),t.body.removeAttribute("data-окно-открыто"),ue.ОбработатьСобытие("окна-закрытоокно",{"сИдОкна":n,"сДанные":r}))}function r(r){Проверить(ЭтоНепустаяСтрока(r));const i=e();r!==i&&(n(i,"отмена"),t.getElementById(r).classList.add("окнооткрыто"),t.body.setAttribute("data-окно-открыто",r),ue.ОбработатьСобытие("окна-открытоокно",r))}function i(t,i=""){Проверить(ЭтоНепустаяСтрока(t)&&"string"==typeof i);const a=e();t===a?n(a,i):(n(a,"отмена"),r(t))}return ue.ДобавитьОбработчик("управление-щелчок",function(r,a){if(a.лВПроигрывателе){const r=a.target.getAttribute("data-окно-переключить");if(r)i(r,a.target.getAttribute("data-окно-данные")||"");else{const r=e();r&&!t.getElementById(r).contains(a.target)&&n(r,"отмена")}}}),{"ПолучитьОткрытоеОкно":e,"ПереключитьОкно":i,"ОткрытьОкно":r}})(),_e=((()=>{function e(){return t.getElementsByClassName("менюоткрыто")[0]}function n(e){e.addEventListener("mouseleave",a),t.body.classList.remove("меню-безанимации"),e.classList.add("менюоткрыто")}function i(e,n){e.removeEventListener("mouseleave",a),t.body.classList.toggle("меню-безанимации",n),e.classList.remove("менюоткрыто")}const a=r(e=>{i(e.target,!1)}),o=r(n=>{const r=e();if(r&&r.contains(n.target))return void(Q(n)||n.preventDefault());let a=null;(function(e){do{const t=getComputedStyle(e),n=t.getPropertyValue("user-select")||t.getPropertyValue("-webkit-user-select")||t.getPropertyValue("-moz-user-select");if(Проверить(n),"auto"!==n)return"none"!==n}while(e=e.parentElement);return!0})(n.target)||(n.preventDefault(),a=t.getElementById("контекстноеменю")),r&&r!==a&&i(r)});t.addEventListener("contextmenu",o),ue.ДобавитьОбработчик("управление-щелчок",function(t,r){const a=r.target;if(a.classList.contains("меню-пункт"))return void(a.hasAttribute("tabindex")&&i(a.parentNode,!0));const o=e();if(o&&!o.contains(a)&&i(o,!1),a.classList.contains("кнопкаименю-кнопка")){const e=a.nextElementSibling;e!==o&&n(e)}})})(),(()=>{const i=180,a=300,o=1500,s="• • •",c={da:"Dansk",de:"Deutsch",en:"English","en-gb":"English (UK)",es:"Español","es-mx":"Español (Latinoamérica)",fr:"Français",it:"Italiano",hu:"Magyar",nl:"Nederlands",no:"Norsk",pl:"Polski",pt:"Português","pt-br":"Português (Brasil)",sk:"Slovenčina",fi:"Suomi",sv:"Svenska",vi:"Tiếng Việt",tr:"Türkçe",cs:"Čeština",el:"Ελληνικά",bg:"Български",ru:"Русский",ar:"العربية",th:"ภาษาไทย",zh:"中文","zh-cn":"简体中文","zh-tw":"繁體中文","zh-hk":"中文（香港）",ja:"日本語",ko:"한국어",hi:"हिंदी",ro:"Română",ase:"American Sign Language",asl:"American Sign Language"};var l,u,d,g,p,b,x,B,M,A,F,D,O=0,X=0,P=0,J=0;if(t.exitFullscreen)var j="fullscreenElement",H="requestFullscreen",W="exitFullscreen",V="fullscreenchange";else j="webkitFullscreenElement",H="webkitRequestFullscreen",W="webkitExitFullscreen",V="webkitfullscreenchange";function G(){var e=!!t[j];м_Журнал.Окак(`[Управление] Полноэкранный режим: ${e}`),Te("переключитьполноэкранный",e)}const z=r(()=>{G()});function ee(){ae(!0),t[j]?ne():(м_Журнал.Вот("[Управление] Вход в полноэкранный режим"),t.getElementById("проигрыватель")[H]())}function ne(){м_Журнал.Вот("[Управление] Выход из полноэкранного режима"),t[W]()}function ie(){let e=!1;return 0===J?(e="none"===getComputedStyle(t.getElementById("глаз")).cursor,t.body.classList.remove("автоскрытие","панель-безанимации")):clearTimeout(J),J=setTimeout(de,1e3*me.Получить("чИнтервалАвтоскрытия")),e}function ae(e){0!==J&&(clearTimeout(J),J=0,t.body.classList.add("автоскрытие"),t.body.classList.toggle("панель-безанимации",e),e&&(X=P=n.now()))}const de=r(()=>{ae(!1)});const fe=r(e=>{e.currentTarget.removeEventListener("mousemove",fe),function(e){if(!(M===e.screenX&&A===e.screenY||F===e.clientX&&D===e.clientY)){M=e.screenX,A=e.screenY,F=e.clientX,D=e.clientY;var t=n.now();t-P>=a?X=P=t:(P=t,t-X>=i&&ie())}}(e),setTimeout(ve,100)}),ve=r(()=>{t.getElementById("проигрыватель").addEventListener("mousemove",fe)});function _e(){me.Получить("лМенятьГромкостьКолесом")?(t.addEventListener("wheel",ke),t.addEventListener("mousedown",Se)):(t.removeEventListener("wheel",ke),t.removeEventListener("mousedown",Se))}const ke=r(e=>{e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||function(e,n){for(var r=t.elementFromPoint(e,n);r;r=r.parentElement)if(Z(r))return!0;return!1}(e.clientX,e.clientY)||(м_Журнал.Вот(`[Управление] Движение колеса deltaY=${e.deltaY} deltaMode=${e.deltaMode}`),e.preventDefault(),e.deltaY<0&&Me(!1,Math.min(me.Получить("чГромкость2")+5,h)),e.deltaY>0&&Me(!1,Math.max(me.Получить("чГромкость2")-3,f)))}),Se=r(e=>{1!==e.button||e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||Q(e)||(e.preventDefault(),Me(!me.Получить("лПриглушить")))});function Ne(){}function xe(){t.body.classList.toggle("санимацией",me.Получить("лАнимацияИнтерфейса"))}function Te(e,n){var r="string"==typeof e?t.getElementById(e):e,i=r.getElementsByTagName("use"),a=Number(n);Проверить(a>=0&&a<i.length);for(var o=0;o<i.length;++o)if(o===a){var s=i[o].getAttributeNS("http://www.w3.org/1999/xlink","title");s&&r.setAttribute("title",Y(s)),i[o].removeAttribute("display")}else i[o].setAttribute("display","none");return r}function Le(){l!==I&&l!==S?(м_Журнал.Окак("[Управление] Останавливаю просмотр трансляции"),we.Остановить(),$e.Остановить(),se.Очистить(),se.Добавить(new oe(v,S)),Ee.ДобавитьСледующийСегмент()):(м_Журнал.Окак("[Управление] Начинаю просмотр трансляции"),se.Очистить(),Ee.Перезагрузить(y),we.Запустить())}function Ce(){ge.ОкноПоказано()?ge.ЗакрытьОкно():ge.ОткрытьОкно()}const Be=r(e=>{Me(!1,Number.parseFloat(e.target.value))});function Me(e,t){me.Изменить("лПриглушить",e),void 0!==t&&me.Изменить("чГромкость2",Math.round(t)),Ee.ПрименитьНастройкиЗвука(),Ae(),ie()}function Ae(){t.getElementById("громкость").value=me.Получить("чГромкость2"),Te("переключитьприглушить",me.Получить("лПриглушить"))}function Fe(e){t.getElementById("зритель-подписка").classList.contains("обновляется")||Ie.ИзменитьПодпискуЗрителяНаКанал(e)}const De=r(e=>{0===e.button&&(e.preventDefault(),ee())}),Oe=r(n=>{const r=n.target;if(0!==n.button||r.nodeType!==Node.ELEMENT_NODE||!r.parentElement)return;const i=t.getElementById("проигрыватель").contains(r);if(i&&ie())return;let a=r,o=a.id||a.name;switch(o||(o=(a=r.parentNode).id||a.name),n.узПозывной=a,n.сПозывной=o,n.лВПроигрывателе=i,ue.ОбработатьСобытие("управление-щелчок",n),o){case"переключитьтрансляцию":Le();break;case"глаз":case"переключитьпаузу":l===S&&Ee.ПереключитьПаузу();break;case"переключитьприглушить":Me(!me.Получить("лПриглушить"));break;case"переключитьчат":pe.ПереключитьСостояниеПанели();break;case"создатьклип":Ie.СоздатьКлип();break;case"переключитьполноэкранный":ee();break;case"одновременныхзагрузок":Проверить(r.checked),me.Изменить("кОдновременныхЗагрузок",Number.parseInt(r.value,10)),ge.ОчиститьИсторию();break;case"заначка":Проверить(r.checked),me.Изменить("кЗаначка",Number.parseInt(r.value,10)),ge.ОчиститьИсторию();break;case"менятьгромкостьколесом":me.Изменить("лМенятьГромкостьКолесом",r.checked),_e();break;case"анимацияинтерфейса":me.Изменить("лАнимацияИнтерфейса",r.checked),xe();break;case"автоположениечата":me.Изменить("лАвтоПоложениеЧата",r.checked),Re(),pe.ОбновитьПоложениеПанели();break;case"горизонтальноеположениечата":Проверить(r.checked),me.Изменить("чГоризонтальноеПоложениеЧата",Number.parseInt(r.value,10)),pe.ОбновитьПоложениеПанели();break;case"вертикальноеположениечата":Проверить(r.checked),me.Изменить("чВертикальноеПоложениеЧата",Number.parseInt(r.value,10)),pe.ОбновитьПоложениеПанели();break;case"положениечата":Проверить(r.checked),me.Изменить("чПоложениеПанелиЧата",Number.parseInt(r.value,10)),pe.ОбновитьПоложениеПанели();break;case"состояниезакрытогочата":Проверить(r.checked),pe.ЗадатьСостояниеЗакрытойПанели(Number.parseInt(r.value,10));break;case"переключитьстатистику":case"позиция-текст":Ce();break;case"открытьсправку":case"открытьсправку2":be.ОткрытьСправку();break;case"отправитьотзыв":re.ЗавершитьРаботуИОтправитьОтзыв();break;case"поддержать":e.open("https://coolcmd.tk/tw5/donate.html");break;case"экспортнастроек":me.Экспорт();break;case"импортнастроек":const s=t.getElementById("выборфайладляимпортанастроек");s.value="",s.click();break;case"сброситьнастройки":me.Сбросить();break;case"проверкацвета":!function(e){t.body.classList.toggle("проверкацвета")?(t.body.classList.toggle("проверкацветафон",!e.shiftKey),be.ОткрытьСправку()):t.body.classList.remove("проверкацветафон")}(n);break;case"типтрансляции":Проверить("BUTTON"===r.nodeName),r.disabled||e.location.assign(r.getAttribute("data-адрес"));break;case"зритель-подписаться":Fe(C);break;case"зритель-отписаться":Fe(T);break;case"зритель-уведомлять":Fe(r.checked?C:L);break;case"открытьбоковуюпанель":pe.ОткрытьБоковуюПанель();break;case"закрытьстатистику":ge.ЗакрытьОкно()}}),Xe=r(e=>{if(q)return;const t="keydown"===e.type,n=t&&!e.repeat;switch(e.keyCode+65536*e.shiftKey+e.ctrlKey*(1<<17)+e.altKey*(1<<18)+e.metaKey*(1<<19)){case 13:n&&ee();break;case 86:n&&ye.ПереключитьОкно("настройки");break;case 73:n&&ye.ПереключитьОкно("канал");break;case 83:n&&Ce();break;case 112:n&&be.ОткрытьСправку();break;case 67:case 45:n&&pe.ПереключитьСостояниеПанели();break;case 65603:n&&pe.ОткрытьБоковуюПанель();break;case 85:n&&(pe.ПереключитьПоложениеПанели(),Re());break;case 32:n&&(Le(),ie());break;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:n&&l===S&&(je((48===e.keyCode?58:e.keyCode)-53),ie());break;case 187:case 107:n&&l===S&&(je(1/0),ie());break;case 189:case 109:n&&l===S&&(je(-1/0),ie());break;case 90:case 12:n&&l===S&&(Ee.ПереключитьПаузу(),ie());break;case 37:t&&l===S&&(м_Журнал.Окак("[Управление] Перематываю на -5с"),Ee.ПеремотатьПовторНа(!1,-5),ie());break;case 39:t&&l===S&&(м_Журнал.Окак("[Управление] Перематываю на +5с"),Ee.ПеремотатьПовторНа(!1,5),ie());break;case 65573:t&&l===S&&(м_Журнал.Окак("[Управление] Перематываю на -5 кадров"),Ee.ПеремотатьПовторНа(!0,-5),ie());break;case 65575:t&&l===S&&(м_Журнал.Окак("[Управление] Перематываю на +1 кадр"),Ee.ПеремотатьПовторНа(!0,1),ie());break;case 38:t&&Me(!1,Math.min(me.Получить("чГромкость2")+4,h));break;case 40:t&&Me(!1,Math.max(me.Получить("чГромкость2")-2,f));break;case 33:n&&Me(!1);break;case 34:n&&Me(!0);break;case 77:n&&Me(!me.Получить("лПриглушить"));break;case 262232:n&&Ie.СоздатьКлип();break;default:return}e.stopPropagation(),e.preventDefault()});function Pe(){Re(),ge.ОчиститьИсторию()}function Re(){t.querySelector(`input[name="одновременныхзагрузок"][value="${me.Получить("кОдновременныхЗагрузок")}"]`).checked=!0,t.querySelector(`input[name="заначка"][value="${me.Получить("кЗаначка")}"]`).checked=!0,t.querySelector(`input[name="состояниезакрытогочата"][value="${me.Получить("чСостояниеЗакрытогоЧата")}"]`).checked=!0,t.getElementById("адресчата").selectedIndex=me.Получить("лПолноценныйЧат")?0:me.Получить("лЗатемнитьЧат")?2:1,t.getElementById("менятьгромкостьколесом").checked=me.Получить("лМенятьГромкостьКолесом"),t.getElementById("анимацияинтерфейса").checked=me.Получить("лАнимацияИнтерфейса");const e=me.Получить("лАвтоПоложениеЧата");t.getElementById("автоположениечата").checked=e;const n=t.querySelectorAll(".положениечата input");if(e){const e=me.Получить("чГоризонтальноеПоложениеЧата"),t=me.Получить("чВертикальноеПоложениеЧата");let r,i;for(let a of n){const n=Number.parseInt(a.value,10);e===n&&(r=a),t===n&&(i=a),a.name=n===R||n===U?"горизонтальноеположениечата":"вертикальноеположениечата"}r.checked=i.checked=!0}else{const e=me.Получить("чПоложениеПанелиЧата");let t;for(let r of n)e===Number.parseInt(r.value,10)&&(t=r),r.name="положениечата";t.checked=!0}u?(u.Обновить(),d.Обновить(),g.Обновить(),p.Обновить(),b.Обновить(),x.Обновить(),B.Обновить()):(u=new ce("чНачалоВоспроизведения",.5,1,"началовоспроизведения"),d=new ce("чРазмерБуфера",.5,1,"размербуфера"),g=new ce("чРастягиваниеБуфера",.5,1,"растягиваниебуфера"),p=new ce("чИнтервалОпроса",10,0,"интервалопроса"),b=new ce("чДлительностьПовтора2",30,0,"длительностьповтора"),u.ПослеИзменения=d.ПослеИзменения=g.ПослеИзменения=p.ПослеИзменения=ge.ОчиститьИсторию,(x=new ce("чРазмерИнтерфейса",1,0,"размеринтерфейса")).ПослеИзменения=Ne,B=new ce("чИнтервалАвтоскрытия",.5,1,"интервалавтоскрытия"))}function Je(e,t){Te("переключитьпаузу",t)}function Ue(){var e=t.getElementById("скорость");м_Журнал.Окак(`[Управление] Выбрана скорость ${e.value}`);var n=Number.parseFloat(e.value);return Проверить(Number.isFinite(n)&&n>=0),n}function je(e){Проверить(K(e));var n=t.getElementById("скорость");if(Проверить(n.selectedIndex>=0),e===-1/0||e===1/0)var r=n.selectedIndex-Math.sign(e);else r=n.querySelector('option[value="1.00"]').index-e;r>=0&&r<n.length&&r!==n.selectedIndex&&(n.selectedIndex=r,Ee.ЗадатьСкоростьПовтора(Ue()))}const qe=r(e=>{l===S&&Ee.ЗадатьСкоростьПовтора(Ue())}),He=r(e=>{м_Журнал.Окак(`[Управление] Выбран вариант ${e.target.value}`),Проверить(e.target.value),me.Изменить("сНазваниеВарианта",e.target.value),Ee.Перезагрузить(w),$e.Остановить(),se.Очистить(),ge.ОчиститьИсторию(),we.ИзменитьВариантТрансляции()}),Ye=r(e=>{switch(м_Журнал.Окак(`[Управление] Выбран адрес чата ${e.target.selectedIndex}`),e.target.selectedIndex){case 0:me.Изменить("лПолноценныйЧат",!0);break;case 1:me.Изменить("лПолноценныйЧат",!1),me.Изменить("лЗатемнитьЧат",!1);break;case 2:me.Изменить("лПолноценныйЧат",!1),me.Изменить("лЗатемнитьЧат",!0);break;default:Проверить(!1)}pe.ОбновитьАдрес()}),We=r(e=>{1===e.target.files.length&&me.Импорт(e.target.files[0])});function Ke(e,n){const r=n[0],i=n[1],a=t.getElementById("варианттрансляции");if(a.length=0,r)for(var o=0;o<r.length;++o){var s=Ke.ПЕРЕВОД_ВАРИАНТОВ[r[o].сНазвание];s=s?Y(s):r[o].сНазвание,a.add(new Option(s,r[o].сИдентификатор,o===i,o===i))}a.disabled=a.length<2}function Ve(){0===O&&(t.getElementById("пропуск").style.display="block",O=setTimeout(Ge,o))}Ke.ПЕРЕВОД_ВАРИАНТОВ={Source:"J0115",High:"J0116",Medium:"J0117",Low:"J0118",Mobile:"J0119"};const Ge=r(()=>{t.getElementById("пропуск").style.display="",O=0});function ze(e){if(Проверить(Number.isInteger(e)),e!==l){switch(м_Журнал.Вот(`[Управление] Состояние трансляции изменилось с ${l} на ${e}`),t.body.setAttribute("data-состояние",e),Te("переключитьтрансляцию",e===I||e===S),t.getElementById("создатьклип").disabled=e===y||e===_||e===E,e){case y:ge.ОчиститьИсторию(),tt("",{"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":s,"сНазваниеИгры":null,"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null});break;case _:tt("",{"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":s,"сНазваниеИгры":null,"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null}),Ie.НачатьСборМетаданныхТрансляции();break;case E:Ie.ЗавершитьСборМетаданныхТрансляции(!0),tt("",{"лЗапись":null,"сАдресЗаписи":null,"сНазваниеТрансляции":Y("J0100"),"сАдресИгры":null,"кЗрителей":null,"чДлительностьТрансляции":null}),le.Сжечь();break;case w:case $:case k:break;case I:case S:Ie.ЗавершитьСборМетаданныхТрансляции(!1),tt("",{"кЗрителей":null}),le.Сжечь();break;default:Проверить(!1)}l=e}}function Qe(e,n){var r;if(void 0!==n.сИмя&&(r=`${n.сИмя} - Alternate Player for Twitch.tv`,history.replaceState(null,""),t.title=r,t.getElementById("канал-имя").textContent=n.сИмя),void 0!==n.сАватар&&(Проверить(n.сАватар),t.getElementById("канал-аватар").src=n.сАватар),void 0!==n.сОписание&&(t.getElementById("канал-описание").textContent=n.сОписание||""),void 0!==n.сКодЯзыка){const e=t.getElementById("канал-язык");if(n.сКодЯзыка){const t=c[n.сКодЯзыка.toLowerCase()];Проверить(t),e.textContent=t,te(e.parentNode,!0)}else te(e.parentNode,!1)}void 0!==n.кПодписчиков&&(t.getElementById("канал-подписчиков").textContent=м_i18n.ФорматироватьЧисло(n.кПодписчиков)),void 0!==n.кПросмотров&&(t.getElementById("канал-просмотров").textContent=м_i18n.ФорматироватьЧисло(n.кПросмотров)),void 0!==n.дКаналСоздан&&(t.getElementById("канал-создан").textContent=n.дКаналСоздан.toLocaleDateString()),Ze(n.моСообщества,"канал-сообщества"),Ze(n.моКоманды,"канал-команды")}function Ze(e,n){if(void 0!==e){const a=t.getElementById(n);if(0===e.length)te(a.parentNode,!1);else{const n=t.createDocumentFragment();for(var r,i=0;r=e[i];++i){0!==i&&n.appendChild(t.createTextNode(", ")),Проверить(r.сАдрес&&r.сИмя);const e=t.createElement("a");e.setAttribute("href",r.сАдрес),e.setAttribute("rel","external noopener noreferrer"),e.setAttribute("target","_blank"),r.сОписание&&(e.setAttribute("class","канал-ссылка"),e.setAttribute("title",r.сОписание)),e.appendChild(t.createTextNode(r.сИмя)),n.appendChild(e)}a.textContent="",a.appendChild(n),te(a.parentNode,!0)}}}function et(e,n){if(void 0!==n.сИмя&&(""!==n.сИмя?t.getElementById("зритель-имя").textContent=n.сИмя:м_i18n.InsertAdjacentHtmlMessage(t.getElementById("зритель-имя"),"beforeend","F0590")),void 0!==n.чПодписка){const e=t.getElementById("зритель-подписка");n.чПодписка===N?e.classList.add("обновляется"):(e.classList.remove("обновляется"),e.setAttribute("data-подписка",n.чПодписка),t.getElementById("зритель-уведомлять").checked=n.чПодписка===C)}return!0}function tt(e,n){if(void 0!==n.лЗапись){const e=t.getElementById("типтрансляции");null===n.лЗапись||!n.лЗапись&&!n.сАдресЗаписи?(e.disabled=!0,te(e,!1)):(Te(e,n.лЗапись),n.сАдресЗаписи?(e.setAttribute("data-адрес",n.сАдресЗаписи),e.disabled=!1):e.disabled=!0,te(e,!0))}if(void 0!==n.сНазваниеТрансляции){const e=t.getElementById("названиетрансляции");null===n.сНазваниеТрансляции?te(e,!1):(e.lastElementChild.setAttribute("title",n.сНазваниеТрансляции+Y("J0101")),e.lastElementChild.textContent=n.сНазваниеТрансляции,te(e,!0))}if(void 0!==n.сНазваниеИгры){const e=t.getElementById("названиеигры");null===n.сНазваниеИгры?te(e,!1):(e.lastElementChild.setAttribute("href",n.сАдресИгры),e.lastElementChild.setAttribute("title",n.сНазваниеИгры+Y("J0102")),e.lastElementChild.textContent=n.сНазваниеИгры,te(e,!0))}if(void 0!==n.кЗрителей){const e=t.getElementById("количествозрителей");null===n.кЗрителей?te(e,!1):(e.lastElementChild.textContent=м_i18n.ФорматироватьЧисло(n.кЗрителей,0),te(e,!0))}void 0!==n.чДлительностьТрансляции&&(t.getElementById("позиция-текст").textContent=null===n.чДлительностьТрансляции?"":м_i18n.ПеревестиСекундыВСтроку(n.чДлительностьТрансляции/1e3,!1))}return{"Запустить":function(){Проверить(void 0===l),t.getElementById("названиетрансляции").lastElementChild.setAttribute("href",Ie.ПолучитьАдресУбогогоПроигрывателя());let e=t.getElementById("громкость");for(e.setAttribute("min",f),e.setAttribute("max",h),e.setAttribute("step",m),e.addEventListener("input",Be),e=t.getElementById("скорость").firstElementChild;e;e=e.nextElementSibling)e.text="1.00"===e.value?"1x":м_i18n.ФорматироватьЧисло(e.value,2);ve(),t.getElementById("проигрыватель").addEventListener("mouseleave",de),ie(),G(),t.addEventListener(V,z),Ae(),Re(),be.Запустить(),pe.Восстановить(),ue.ДобавитьОбработчик("список-выбранварианттрансляции",Ke),ue.ДобавитьОбработчик("проигрыватель-переполненбуфер",Ve),ue.ДобавитьОбработчик("проигрыватель-пауза",Je),ue.ДобавитьОбработчик("настройки-измениласьпредустановка-буферизация",Pe),ue.ДобавитьОбработчик("twitch-полученыметаданныеканала",Qe),ue.ДобавитьОбработчик("twitch-полученыметаданныезрителя",et),ue.ДобавитьОбработчик("twitch-полученыметаданныетрансляции",tt),t.addEventListener("click",Oe),t.addEventListener("keydown",Xe),t.addEventListener("keyup",Xe),t.getElementById("глаз").addEventListener("dblclick",De),t.getElementById("скорость").addEventListener("change",qe),t.getElementById("варианттрансляции").addEventListener("change",He),t.getElementById("адресчата").addEventListener("change",Ye),t.getElementById("выборфайладляимпортанастроек").addEventListener("change",We),_e(),ze(y),xe(),he.Запустить()},"ИзменитьСостояние":ze,"ПолучитьСостояние":function(){return Проверить(void 0!==l),l},"ПолучитьСкоростьВоспроизведения":Ue,"ОтключитьПолноэкранныйРежим":ne,"ПереключитьПросмотрТрансляции":Le}})()),Ee=(()=>{const i=10,a=.28,c=1,l=-1,u=-2,d=-3,f=-4,m=0,g=1,p=2;let b,N,x=null,T=0,L=!1,C="чНачалоВоспроизведения",B=!0,M=0,A=!1;const D={"ОбработатьSourceOpen":function(){T=Math.max(T,1),te()},"ОбработатьProgress":function(){L||Q(z(l))},"ОбработатьWaiting":function(){},"ОбработатьPlaying":function(){_e.ПолучитьСостояние()!==$||b.paused||_e.ИзменитьСостояние(k)},"ОбработатьSeeking":ЗАГЛУШКА,"ОбработатьSeeked":Q,"ОбработатьEnded":function(){q(w)},"ОбработатьTimeUpdate":function(){b.seeking||b.paused||b.ended||z(d)}},O={"лПауза":!0,"ОбработатьSourceOpen":function(){T=Math.max(T,1)},"ОбработатьProgress":ЗАГЛУШКА,"ОбработатьWaiting":ЗАГЛУШКА,"ОбработатьPlaying":ЗАГЛУШКА,"ОбработатьSeeking":function(){ve.ЗадатьПросмотрено(b.currentTime)},"ОбработатьSeeked":ЗАГЛУШКА,"ОбработатьEnded":function(){this.лПауза||b.play()},"ОбработатьTimeUpdate":function(){this.лПауза||b.seeking||this.ПроверитьПозициюВоспроизведения(d),ve.ЗадатьПросмотрено(b.currentTime)},"ПроверитьПозициюВоспроизведения":function(e){Проверить(Number.isFinite(e)),Проверить(e===u||e===d||e>=0);const t=b.buffered,n=t.length-1,r=b.currentTime+1e-4;for(var i=e>=0?e:r,s="",c=!1;;){for(var l=e===d?a:o,f=0;f<=n&&(i<t.start(f)&&(l=o,s+="Перепрыгиваю яму. ",i=t.start(f)),!(t.end(f)-i>=l));++f);if(this.лПауза||i<ve.ПолучитьКонец())break;if(c)return void P("Ой",`Бесконечная перемотка Время=${e}`);i=ve.ПолучитьНачало(),s+="Начинаю сначала. ",c=!0}i!==r&&(P("Окак",`${s}Перематываю до ${i}`),b.currentTime=i)}};let X=D;function P(e,t){const n=0!==N.sourceBuffers.length?N.sourceBuffers[0]:null,r=R(n?n.buffered:null),i=R(b.buffered),a=r===i;"Вот"===e&&(n&&n.buffered.length>1||b.buffered.length>1)&&(e="Окак"),!b.error&&a||(e="Ой"),м_Журнал[e](`${"["===t.charAt(0)?"":"[Проигрыватель] "}${t} •••`+(b.error?` error=${b.error.code}`:"")+(n&&n.updating?" [U]":"")+(b.paused?" [P]":"")+(b.seeking?" [S]":"")+(b.ended?" [E]":"")+("open"===N.readyState?"":` MSE.readyState=${N.readyState}`)+(1===N.sourceBuffers.length?"":` MSE.buffers=${N.sourceBuffers.length}`)+(b.networkState===HTMLMediaElement.NETWORK_LOADING?"":` networkState=${b.networkState}`)+` readyState=${b.readyState}`+` currentTime=${b.currentTime}`+(a?` buffered=${i}`:` MSE.buffered=${r} buffered=${i}`)+(b.duration===1/0?"":` duration=${b.duration}`)+` seekable=${R(b.seekable)}`+` played=${R(b.played)}`)}function R(e){var t="";if(e&&0!==e.length){var n=e.length,r=Math.max(n-20,0);for(0!==r&&(t=`[${r}]`);r<n;++r)0!==r&&(t+=`(${(e.start(r)-e.end(r-1)).toFixed(3)})`),t+=`${e.start(r)}-${e.end(r)}`}return t}function J(e){var t=0,n=0;if(void 0===e&&(e=b.buffered),0!==e.length){var r=e.start(0),i=e.end(e.length-1),a=G(b.currentTime,r,i);t=a-r,n=i-a}return{"чПросмотрено":t,"чНеПросмотрено":n}}function U(){b.volume=me.Получить("чГромкость2")/h,b.muted=me.Получить("лПриглушить")}function j(e){B=!0,q(e)}function q(e){P("Окак","Перезагрузка проигрывателя"),_e.ИзменитьСостояние(e),X=D,x=null,A=!1,b.load()}function H(){b.error&&re.ЗавершитьРаботуИПоказатьСообщение("J0206")}const Y=r(e=>{H();var t=`[MediaSource] ${e.type}`;switch(e.type){case"sourceopen":P("Вот",t),X.ОбработатьSourceOpen();break;case"sourceended":case"sourceclose":P("Вот",t);break;default:м_Журнал.Вот(t)}}),V=r(n=>{H();var r=`[MediaElement] ${n.type}`;switch(n.type){case"loadstart":P("Вот",`${r} src=${b.src} currentSrc=${b.currentSrc}`);break;case"progress":P("Вот",r),X.ОбработатьProgress();break;case"abort":P("Вот",r);break;case"waiting":P("Окак",r),X.ОбработатьWaiting();break;case"playing":P("Вот",r),X.ОбработатьPlaying();break;case"seeking":P("Вот",r),X.ОбработатьSeeking();break;case"seeked":P("Вот",r),X.ОбработатьSeeked();break;case"ended":P("Вот",r),X.ОбработатьEnded();break;case"timeupdate":м_Журнал.Вот(`${r} readyState=${b.readyState} currentTime=${b.currentTime} НеПросмотрено=${м_Журнал.F2(J().чНеПросмотрено)}`),X.ОбработатьTimeUpdate();break;case"canplay":!function(){const n=t.getElementById("глаз"),r=e.innerHeight,i=e.innerWidth;let a=n.videoWidth,o=n.videoHeight,s=!1;o>r&&(o=r,s=!0);a>i&&(a=i,s=!0);s&&(n.style.objectFit="fill");n.style.width=a+"px",n.style.height=o+"px"}();break;case"volumechange":м_Журнал.Вот(`${r} volume=${b.volume} muted=${b.muted}`);break;default:м_Журнал.Вот(r)}});function z(e,t){void 0===t&&(t=0);const n=b.buffered,r=n.length-1;if(-1===r)return!1;const i=b.currentTime+1e-4;var s=Math.max(i,n.start(0)),c="";const h=n.end(r)-s;if(e===l){const e=me.Получить("чМаксРазмерБуфера"),t=e+me.Получить("чРастягиваниеБуфера");if(h<=t)return;T>=2&&ue.ОбработатьСобытие("проигрыватель-переполненбуфер",h-e),c+=`Переполнен буфер проигрывателя ${h.toFixed(2)}с > ${t}с. `,s=n.end(r)-e-.1}if(e===u&&T<2){T=2;const e=me.Получить("чМаксРазмерБуфера")+ge.ПолучитьTargetDuration()/2;h>e&&(c+=`Превышена задержка трансляции ${h.toFixed(2)}с > ${e}с. `,s=n.end(r)-e)}Проверить(a<o);for(var v=e===d?a:e===f?1/0:o,y="ended"===N.readyState,_=0;_<=r;++_){s<n.start(_)&&(v=o,c+="Перепрыгиваю яму. ",s=n.start(_));var E=n.end(_)-s;if(E>=v){y=!0;break}}return y||b.paused||function(e,t,n){Проверить("ended"!==N.readyState),Проверить(e<o);const r=t>1;ge.ИсчерпанБуферПроигрывателя(r),C="чМаксРазмерБуфера";const i=me.Получить(C);e+n>=o&&t+n>=i?P(r?"Ой":"Окак",`Буфер исчерпан, остановка не нужна БудетДобавлено=${м_Журнал.F3(n)}с ДоКонцаПоследнейОбласти=${м_Журнал.F3(e)}с НеПросмотрено=${м_Журнал.F3(t)}с РазмерБуфера=${i}с`):(P(r?"Ой":"Окак",`Приостанавливаю воспроизведение для заполнения буфера ДоКонцаПоследнейОбласти=${м_Журнал.F3(e)}с НеПросмотрено=${м_Журнал.F3(t)}с РазмерБуфера=${i}с`),A=!0,Z(w))}(E,h,t),!y&&e!==l||s===i&&!A?y?g:m:(s===i&&(s=b.currentTime),P(c?"Ой":"Окак",`${c}Перематываю до ${s}`),A=!1,b.currentTime=s,p)}function Q(e){if(!b.seeking&&e!==p&&b.paused&&!b.ended){if(B&&"ended"!==N.readyState){const e=J().чНеПросмотрено,t=me.Получить(C);if(e<t)return void м_Журнал.Вот(`[Проигрыватель] В буфере не просмотрено ${м_Журнал.F3(e)}с < ${t}с`);м_Журнал.Окак(`[Проигрыватель] В буфере не просмотрено ${м_Журнал.F3(e)}с >= ${t}с`)}else м_Журнал.Окак("[Проигрыватель] Не нужно ждать заполнения буфера");switch(z(u)){case m:P("Ой",`Не найдена область >= ${o}с для начала воспроизведения`),B=!0;break;case g:P("Окак","Начало воспроизведения"),B=!0,b.play(),_e.ИзменитьСостояние($)}}}function Z(e){void 0!==e&&_e.ИзменитьСостояние(e),b.pause()}function ee(e,t){return new Promise((r,i)=>{P("Вот",`Добавляю ${t?"сегмент инициализации":"медиасегмент"} ${e.чНомер}`),x.addEventListener("updateend",function t(){try{null===x?i(ie.ОБЕЩАНИЕ_ОТМЕНЕНО):(a+=n.now(),x.removeEventListener("updateend",t),P(a>100?"Ой":"Вот",`Добавлен сегмент ${e.чНомер} за ${м_Журнал.F0(a)}мс`),r())}catch(e){i(e)}});var a=-n.now();x.appendBuffer(t?e.пДанные.мбСегментИнициализации:e.пДанные.мбМедиасегмент)})}function te(){Проверить(b);const e=se[0];if(L||!e||e.чОбработка!==v)return;if(Проверить(X===D),e.пДанные===_)return Проверить(0===N.sourceBuffers.length),_e.ИзменитьСостояние(e.пДанные),se.Удалить(0),void te();if(e.пДанные===S)return Проверить(_e.ПолучитьСостояние()!==I&&_e.ПолучитьСостояние()!==S),function(){O.лПауза=!0,X=O,Z(),0!==N.sourceBuffers.length&&"open"===N.readyState&&N.endOfStream();var e=J().чПросмотрено;if(e<c)return P("Окак","Повторять нечего"),void _e.ИзменитьСостояние(I);P("Окак","Запуск повтора"),b.playbackRate=_e.ПолучитьСкоростьВоспроизведения(),ue.ОбработатьСобытие("проигрыватель-пауза",O.лПауза),ve.ЗадатьНачалоИКонец(b.buffered.start(0),b.buffered.start(0)+e),ve.ЗадатьПросмотрено(b.currentTime),_e.ИзменитьСостояние(S)}(),se.Удалить(0),void te();const u=N.readyState;if("open"!==u)return м_Журнал.Вот(`[Проигрыватель] Добавление сегмента ${e.чНомер} отложено MediaSource.readyState=${u} MediaElement.src=${b.src}`),void("closed"===u&&0===T&&(f=se.ПолучитьКоличествоПреобразованныхСегментов().чДлительность)>=s&&(м_Журнал.Ой(`[Проигрыватель] MediaSource закрыт слишком долго ${f}с >= ${s}с`),Проверить(_e.ПолучитьСостояние()===y||_e.ПолучитьСостояние()===_),_e.ПереключитьПросмотрТрансляции()));var f;if(e.лРазрыв&&0!==N.sourceBuffers.length)return void function(e){P("Окак",`Сегмент ${e.чНомер} вызвал окончание потока`),0===b.buffered.length||b.paused&&J().чНеПросмотрено<a+.1?j(w):(B="number"==typeof e.пДанные||!b.seeking&&b.paused,N.endOfStream(),Q())}(e);if(e.пДанные===E)return Проверить(e.лРазрыв&&0===N.sourceBuffers.length),_e.ИзменитьСостояние(e.пДанные),se.Удалить(0),void te();!function(e){if(0===N.sourceBuffers.length){м_Журнал.Окак(`[Проигрыватель] Добавляю буфер ${e.пДанные.сКодеки}`),Проверить(e.лРазрыв&&e.пДанные.сКодеки);try{x=N.addSourceBuffer(e.пДанные.сКодеки)}catch(e){W(e)&&"NotSupportedError"===e.name?re.ЗавершитьРаботуИПоказатьСообщение("J0201"):re.ПойманоИсключение(e)}x.addEventListener("updatestart",Y),x.addEventListener("update",Y),x.addEventListener("updateend",Y),x.addEventListener("abort",Y),x.addEventListener("error",Y)}}(e),L=!0;let h=function(){var e=me.Получить("чДлительностьПовтора2");if(e===F)return Promise.resolve();var t=J(x.buffered);if(t.чПросмотрено<e+i)return Promise.resolve();var r=b.currentTime-e;return new Promise((e,i)=>{P("Вот",`Удаляю просмотренное видео Просмотрено=${м_Журнал.F3(t.чПросмотрено)}с УдалитьДо=${м_Журнал.F3(r)}с`),x.addEventListener("updateend",function r(){try{null===x?i(ie.ОБЕЩАНИЕ_ОТМЕНЕНО):(a+=n.now(),x.removeEventListener("updateend",r),t=J(x.buffered),P(a>100||t.чПросмотрено<o?"Ой":"Вот",`Просмотренное видео удалено за ${м_Журнал.F0(a)}мс Просмотрено=${м_Журнал.F0(t.чПросмотрено)}с`),e())}catch(e){i(e)}});var a=-n.now();x.remove(0,r)})}().then(()=>{b.seeking||b.paused||b.ended||z(d,e.чДлительность)});e.пДанные.мбСегментИнициализации&&(h=h.then(()=>ee(e,!0))),h.then(()=>ee(e,!1)).then(()=>{if(L=!1,se.Удалить(e),!se[0]||se[0].пДанные!==S){!function(e){if(K(e.пДанные.чПозицияКодирования)){var t=K(e.чTwitchПрошлоВремени)?e.чTwitchПрошлоВремени-e.пДанные.чПозицияКодирования:0,n=0===t||Math.abs(t-M)>1;м_Журнал[n?"Ой":"Вот"](`[Проигрыватель] Смещение начала трансляции ${м_Журнал.F1(t)}с`),ge.ОкноПоказано()&&ge.ОбновитьЗначение("статистика-смещениеначалатрансляции",t.toFixed(1),n),M=t}}(e);const n=z(l);se[0]&&se[0].чОбработка===v||(Q(n),function(){if(ge.ОкноПоказано()){var e=x.buffered;0!==e.length&&(t.getElementById("статистика-продолжительностьтрансляции").textContent=м_i18n.ПеревестиСекундыВСтроку(e.end(e.length-1)+M,!0))}}(),function(e){if(ge.ОкноПоказано()){var n="";if(K(e.пДанные.чВремяКодирования)){var r=b.currentTime;if(0!==r){var i=(Date.now()-e.пДанные.чВремяКодирования)/1e3,a=e.пДанные.чПозицияКодирования-r;n=`${i.toFixed(1)} + ${a.toFixed(1)} = ${(i+a).toFixed(1)}`}}м_Журнал.Вот(`[Проигрыватель] Задержка трансляции ${n}с`),t.getElementById("статистика-задержкатрансляции").textContent=n}}(e))}te()}).catch(r(t=>{L=!1,"ДОБАВЛЕНИЕ СЕГМЕНТА ОТЛОЖЕНО"!==t&&(se.Удалить(e),t===ie.ОБЕЩАНИЕ_ОТМЕНЕНО?м_Журнал.Вот(`[Проигрыватель] Отменено добавление сегмента ${e.чНомер}`):re.ПойманоИсключение(t))}))}function ne(e){Проверить(_e.ПолучитьСостояние()===S),O.ПроверитьПозициюВоспроизведения(e)}return{"Запустить":function(){Проверить(!b);try{N=new MediaSource}catch(e){re.ЗавершитьРаботуИПоказатьСообщение("J0202")}for(var e of(N.addEventListener("sourceopen",Y),N.addEventListener("sourceended",Y),N.addEventListener("sourceclose",Y),N.sourceBuffers.addEventListener("addsourcebuffer",Y),N.sourceBuffers.addEventListener("removesourcebuffer",Y),b=t.getElementById("глаз"),U(),["progress","error","playing","seeking","seeked","ended","timeupdate","waiting","loadstart","suspend","abort","emptied","stalled","loadedmetadata","loadeddata","canplay","canplaythrough","durationchange","play","pause","ratechange","resize"]))b.addEventListener(e,V);return b.src=URL.createObjectURL(N),!0},"Остановить":function(){b&&(URL.revokeObjectURL(b.src),b.removeAttribute("src"),b.load())},"ПолучитьЗаполненностьБуфера":J,"ПолучитьКоличествоПропущенныхКадров":function(){return"function"==typeof b.getVideoPlaybackQuality?b.getVideoPlaybackQuality():{totalVideoFrames:b.webkitDecodedFrameCount,droppedVideoFrames:b.webkitDroppedFrameCount}},"ПолучитьПозициюВоспроизведенияТрансляции":function(){var e=_e.ПолучитьСостояние()===S?ve.ПолучитьКонец():b.currentTime;return 0===e?0:Math.max(e+M,0)},"ПоказатьСостояние":P,"Перезагрузить":j,"ПрименитьНастройкиЗвука":U,"ДобавитьСледующийСегмент":te,"ПеремотатьПовторДо":ne,"ПеремотатьПовторНа":function(e,t){Проверить(_e.ПолучитьСостояние()===S),Проверить(Number.isFinite(t)),e&&(t*=ge.ПолучитьДлительностьКадраВСекундах().чМинимальная),0!==t&&ne(G(b.currentTime+t,ve.ПолучитьНачало(),ve.ПолучитьКонец()))},"ПереключитьПаузу":function(){Проверить(_e.ПолучитьСостояние()===S),(O.лПауза=!O.лПауза)?(м_Журнал.Окак("[Проигрыватель] Ставлю повтор на паузу"),b.pause()):(м_Журнал.Окак("[Проигрыватель] Снимаю повтор с паузы"),O.ПроверитьПозициюВоспроизведения(u),b.play()),ue.ОбработатьСобытие("проигрыватель-пауза",O.лПауза)},"ЗадатьСкоростьПовтора":function(e){Проверить(_e.ПолучитьСостояние()===S),b.playbackRate=e}}})(),we=(()=>{const e=3e3,t=3e4,i=1e3,a=150;var o,s,l,f=I,h=new Array(10),m=new ie,p=null,v=null;function y(e,t,n){if(!n.startsWith("#EXTM3U"))throw`Вместо списка загружена какая-то фигня длиною ${n.length}\n${n}`;var r=1;if(e)var i=new Map,a=[],o=null;else var s,c,l=0,u=0,d=NaN,f=!1,h=[],m=null;var g,p=/^#([A-Z0-9\-]+)(?::(.+))?$|^[^#\r\n].*$/gm;for(p.lastIndex=7;g=p.exec(n);){var b=g[0],v=g[1],y=g[2];if("#"===b.charAt(0))switch(v){case"EXTM3U":Проверить(!1);break;case"EXT-X-VERSION":Проверить(1===r),r=k(y),Проверить(r>=2&&r<=7);break;case"EXT-X-START":Проверить(!1);break;case"EXT-X-MEDIA":Проверить(e);var _=(I=$(y)).get("TYPE");if(Проверить(_),Проверить("VIDEO"!==_&&"AUDIO"!==_||!I.has("URI")),"VIDEO"!==_)м_Журнал.Ой(`[Список] Найден #EXT-X-MEDIA TYPE=${_}`);else{var E=N(I.get("GROUP-ID"));Проверить(!i.has(E)),i.set(E,N(I.get("NAME")))}break;case"EXT-X-STREAM-INF":Проверить(e),Проверить(!o),o=Object.create(null);var I=$(y);o.nPeakBitrate=k(I.get("BANDWIDTH")),o.сКодеки=I.has("CODECS")?N(I.get("CODECS")):"",Проверить(!I.has("AUDIO")&&!I.has("SUBTITLES")&&!I.has("CLOSED-CAPTIONS")),I.has("VIDEO")&&(o.сИдентификатор=N(I.get("VIDEO")));break;case"EXT-X-I-FRAME-STREAM-INF":case"EXT-X-SESSION-DATA":case"EXT-X-SESSION-KEY":Проверить(e);break;case"EXT-X-TARGETDURATION":Проверить(!e),Проверить(void 0===s),s=k(y),Проверить(s>0&&s<86400);break;case"EXT-X-MEDIA-SEQUENCE":Проверить(!e),Проверить(0===u),u=k(y);break;case"EXT-X-ENDLIST":Проверить(!e),Проверить(void 0===c),Проверить(void 0===y),c=!0,м_Журнал.Окак(`[Список] #EXT-X-ENDLIST после сегмента ${u+h.length-1}`);break;case"EXT-X-DISCONTINUITY-SEQUENCE":case"EXT-X-DATERANGE":Проверить(!e);break;case"EXT-X-PLAYLIST-TYPE":case"EXT-X-I-FRAMES-ONLY":Проверить(!1);break;case"EXTINF":Проверить(!e),m=m||Object.create(null),Проверить(void 0===m.чДлительность),m.чДлительность=x(y),Проверить(0!==m.чДлительность),m.чДлительность-s>1&&м_Журнал.Ой(`[Список] Длительность сегмента превышена на ${m.чДлительность-s}с`);break;case"EXT-X-DISCONTINUITY":Проверить(!e),Проверить(!f),Проверить(void 0===y),f=!0,м_Журнал.Ой(`[Список] #EXT-X-DISCONTINUITY у сегмента ${u+h.length}`);break;case"EXT-X-PROGRAM-DATE-TIME":Проверить(!e);break;case"EXT-X-BYTERANGE":case"EXT-X-KEY":case"EXT-X-MAP":Проверить(!1);break;case"EXT-X-TWITCH-ELAPSED-SECS":Проверить(!e),Проверить(0===h.length),Проверить(Number.isNaN(d)),d=S(y)}else b=new URL(b,t).href,e?(Проверить(o),o.сАбсолютныйАдресСпискаСегментов=b,a.push(o),o=null):(Проверить(m),Проверить(void 0!==m.чДлительность),Проверить(!c),m.чTwitchПрошлоВремени=d,m.лРазрыв=f,m.сАдрес=b,h.push(m),l+=m.чДлительность,d+=m.чДлительность,f=!1,m=null)}if(e){for(var T of(Проверить(!o),a))"сИдентификатор"in T?(T.сНазвание=i.get(T.сИдентификатор),Проверить(T.сНазвание)):(T.сИдентификатор=`CoolCmd${T.nPeakBitrate}`,T.сНазвание=`${м_i18n.ФорматироватьЧисло(T.nPeakBitrate/1e6,1)} ${Y("J0114")}`),м_Журнал.Окак(`[Список] Добавлен вариант PeakBitrate=${T.nPeakBitrate} Идентификатор=${T.сИдентификатор} Название=${T.сНазвание} Кодеки=${T.сКодеки}`);return a.sort(w),a}return Проверить(!m),Проверить(void 0!==s),м_Журнал.Вот(`[Список] Разобран список сегментов TargetDuration=${s} MediaSequenceNumber=${u} КоличествоСегментов=${h.length} ДлительностьСписка=${м_Журнал.F1(l)}с`),ge.РазобранСписокСегментов(s,h.length,l),{nMediaSequenceNumber:u,nTargetDuration:s,"лКонецСписка":!!c,"моСегменты":h}}function w(e,t){return("chunked"===t.сИдентификатор?1e9:t.nPeakBitrate)-("chunked"===e.сИдентификатор?1e9:e.nPeakBitrate)}function $(e){Проверить(e);for(var t=/([A-Z0-9\-]+)=("[^"]+"|[^",][^,]*)(?:,|$)/g,n=new Map;t.lastIndex!==e.length;){var r=t.lastIndex,i=t.exec(e);Проверить(i&&i.index===r),Проверить(!n.has(i[1])),n.set(i[1],i[2])}return n}function k(e){return Проверить(/^[0-9]{1,15}$/.test(e)),Number.parseInt(e,10)}function S(e){return Проверить(/^[0-9]{1,14}(?:\.[0-9]{1,15})?$/.test(e)),Number.parseFloat(e)}function N(e){return Проверить(e&&e.length>2&&'"'===e.charAt(0)&&'"'===e.charAt(e.length-1)),e.slice(1,-1)}function x(e){if(Проверить(e),"-"===e.slice(0,1))throw"Отрицательный #EXTINF";var t=e.indexOf(",");return S(-1===t?e:e.slice(0,t))}function T(w){Проверить(Number.isFinite(w)&&w>=0),м_Журнал.Вот(`[Список] Загрузка списка начнется через ${м_Журнал.F0(w)}мс`);var $,k,I=ae(m,w);p||(I=I.then(()=>Ie.ПолучитьАбсолютныйАдресСпискаВариантов(m)).then(e=>($=e,ke.ЗагрузитьТекст(m,$,u,"список вариантов",!1))).then(e=>{re.СохранитьСписокВариантов(e),p=y(!0,$,e),B()}));I.then(()=>(k=n.now(),ke.ЗагрузитьТекст(m,p[s].сАбсолютныйАдресСпискаСегментов,d,"список сегментов",!1))).then(e=>{re.СохранитьСписокСегментов(e);var t=function(e){Проверить(f===_);const t=c*v.nTargetDuration*10;if(0===e)return t;var n=me.Получить("чИнтервалОпроса");if(n!==F)return n*v.nTargetDuration*10;Проверить(e>0&&e<=v.моСегменты.length),-1===o&&(o=0,e=v.моСегменты.length);e=Math.min(e,h.length);do{h[o]=v.моСегменты[v.моСегменты.length-e].чДлительность,++o===h.length&&(o=0)}while(0!=--e);return n=Math.max.apply(null,h),Проверить(n>0),Math.max(1e3*n+a,t)}(function(e){if(null===v){if(e.лКонецСписка)throw"Найден #EXT-X-ENDLIST";Проверить(0!==e.моСегменты.length),l=!0;for(var t=me.Получить("чРазмерБуфера"),n=Math.max(e.моСегменты.length-me.Получить("кЗаначка")-j,1);0!=--n&&(t-=e.моСегменты[n].чДлительность)>0;);}else{Проверить(0!==e.моСегменты.length),(e.nMediaSequenceNumber<v.nMediaSequenceNumber||e.nMediaSequenceNumber+e.моСегменты.length<v.nMediaSequenceNumber+v.моСегменты.length)&&м_Журнал.Ой(`[Список] Уменьшился media sequence number [${v.nMediaSequenceNumber}..${v.nMediaSequenceNumber+v.моСегменты.length-1}] ==> [${e.nMediaSequenceNumber}..${e.nMediaSequenceNumber+e.моСегменты.length-1}]`);const t=e.nMediaSequenceNumber-(v.nMediaSequenceNumber+v.моСегменты.length);t>0&&(м_Журнал.Ой(`[Список] Пропущено сегментов: ${t}`),ge.НеЗагруженыСегменты(t),l=!0),e.nTargetDuration!==v.nTargetDuration&&(м_Журнал.Ой(`[Список] Изменился target duration ${v.nTargetDuration} ==> ${e.nTargetDuration}`),C()),n=0}for(var r,i=0,a=0;r=e.моСегменты[n];++n){const t=e.nMediaSequenceNumber+n;if(null!==v&&t>=v.nMediaSequenceNumber&&t<v.nMediaSequenceNumber+v.моСегменты.length){const e=v.моСегменты[t-v.nMediaSequenceNumber];e.сАдрес===r.сАдрес&&e.чДлительность===r.чДлительность||(м_Журнал.Ой(`[Список] У сегмента ${t} изменились адрес ${e.сАдрес} ==> ${r.сАдрес} или длительность ${e.чДлительность} ==> ${r.чДлительность}`),l=!0)}if(null===v||t>=v.nMediaSequenceNumber+v.моСегменты.length){f!==_&&(f=_,se.Добавить(new oe(b,_)),C());const e=se.Добавить(new oe(g,r.сАдрес,r.чДлительность,r.лРазрыв||l,r.чTwitchПрошлоВремени));м_Журнал.Вот(`[Список] Добавлен сегмент ${e.чНомер} MediaSequenceNumber=${t} Длительность=${e.чДлительность} Разрыв=${e.лРазрыв} TwitchПрошлоВремени=${e.чTwitchПрошлоВремени}`),l=!1,i+=1,a+=e.чДлительность}}if(ge.ДобавленыСегментыВОчередь(i,a),(null===v||e.nMediaSequenceNumber+e.моСегменты.length>=v.nMediaSequenceNumber+v.моСегменты.length)&&(v=e),e.лКонецСписка)throw"Найден #EXT-X-ENDLIST";return i}(y(!1,p[s].сАбсолютныйАдресСпискаСегментов,e)));T(Math.max(t-n.now()+k,0)),ke.ЗагрузитьСледующийСегмент()}).catch(r(n=>{"string"==typeof n?(м_Журнал.Ой(`[Список] Завершаю трансляцию. ${n}`),function(){f!==E&&(f=E,se.Добавить(new oe(b,E)),C());M(),v=null}(),T(function(){Проверить(f===E),o=-1===o?e:Math.min(o+i,t);return o}()),ke.ЗагрузитьСледующийСегмент()):n===ie.ОБЕЩАНИЕ_ОТМЕНЕНО?м_Журнал.Вот("[Список] Отменено обновление списков"):re.ПойманоИсключение(n)}))}function L(){м_Журнал.Вот("[Список] Отменяю обновление списков"),m.Отменить()}function C(){h.fill(0),o=-1}function B(){if(0===p.length)throw"Список вариантов пуст";var e=me.Получить("сНазваниеВарианта");for(s=p.length-1;0!==s&&p[s].сИдентификатор!==e;)--s;м_Журнал.Вот(`[Список] Выбран вариант трансляции ${p[s].сИдентификатор} ЖелаемыйВариант=${e}`),ue.ОбработатьСобытие("список-выбранварианттрансляции",[p,s])}function M(){p&&(м_Журнал.Вот("[Список] Очищаю список вариантов трансляции"),p=null,ue.ОбработатьСобытие("список-выбранварианттрансляции",[p,s]))}return C(),{"Запустить":function(){Проверить(f===I),m.НачалоВыполнения(),T(0)},"Остановить":function(){f=I,L(),M(),v=null},"ИзменитьВариантТрансляции":function(){Проверить(p),L(),C(),B(),v=null,m.НачалоВыполнения(),T(0)}}})(),$e=(()=>{var e=null,t=-1;function n(e){re.ЗавершитьРаботуИОтправитьОтчет(`Произошла ошибка в рабочем потоке в строке ${e.lineno}. ${e.message}`)}const a=r(e=>{var t=e.data;switch(Проверить(Array.isArray(t)),t[0]){case 1:Проверить(2===t.length&&W(t[1]));var n=new oe(v,t[1].пДанные,t[1].чДлительность,t[1].лРазрыв,t[1].чTwitchПрошлоВремени,t[1].чНомер);if(м_Журнал.Вот(`[Преобразование] Получен сегмент ${n.чНомер} ПреобразованЗа=${м_Журнал.F0(n.пДанные.чПреобразованЗа)}мс`),"number"!=typeof n.пДанные){if(ge.ПолученПреобразованныйСегмент(n),void 0===n.пДанные.мбМедиасегмент)return;re.СохранитьПреобразованныйСегмент(n)}return se.Добавить(n),void Ee.ДобавитьСледующийСегмент();case 2:var r=t[1],i=t[2];Проверить(3===t.length&&Array.isArray(r)&&Array.isArray(i)&&r.length===i.length);for(var a=0;a<r.length;++a)Проверить(("Вот"===r[a]||"Окак"===r[a]||"Ой"===r[a])&&"string"==typeof i[a]),м_Журнал[r[a]](i[a]);return;case 3:return Проверить(3===t.length&&"string"==typeof t[1]&&"object"==typeof t[2]),void re.ЗавершитьРаботуИОтправитьОтчет(t[1],t[2]);case 4:return Проверить(2===t.length&&"string"==typeof t[1]),void re.ЗавершитьРаботуИПоказатьСообщение(t[1]);case 5:return Проверить(2===t.length&&t[1].byteLength),void le.Выбросить(t[1]);default:Проверить(!1)}});function o(){e||(м_Журнал.Вот("[Преобразование] Создаю рабочий поток"),(e=new Worker(chrome.extension.getURL("worker_pre.js"))).addEventListener("error",n),e.addEventListener("message",a))}return{"Остановить":function(){t=-1,e&&(м_Журнал.Вот("[Преобразование] Убиваю рабочий поток"),e.terminate(),e=null)},"ПреобразоватьСледующийСегмент":function(){for(var n,r,a=0,s=0;r=se[s];++s)if(!(r.чОбработка>b)){if(r.чОбработка<b)break;-1!==t&&t+1!==r.чНомер&&(м_Журнал.Ой(`[Преобразование] Не загружены сегменты между ${t} и ${r.чНомер}`),r.лРазрыв=!0),t=r.чНомер,"number"!=typeof r.пДанные||null!==e?("number"!=typeof r.пДанные&&(re.СохранитьТранспортныйПоток(r),ge.ОтосланИсходныйСегмент()),o(),м_Журнал.Вот(`[Преобразование] Отсылаю сегмент ${r.чНомер}`),r.сВерсия=i,r.чОбработка=j,e.postMessage(r,"number"==typeof r.пДанные?void 0:[r.пДанные]),1==++a&&(n=s)):(м_Журнал.Вот(`[Преобразование] Пропускаю сегмент ${r.чНомер} Состояние=${r.пДанные}`),r.чОбработка=v,r.пДанные===_&&o())}0!==a&&se.Удалить(n,a),Ee.ДобавитьСледующийСегмент()}}})(),ke=(()=>{function e(e,t,r,i,a,o,s,c,l){return Проверить("GET"===t||"PUT"===t||"DELETE"===t),Проверить("string"==typeof r&&(r.startsWith("http://")||r.startsWith("https://")||0===i&&r.startsWith(chrome.extension.getURL("")))),Проверить(!c||!o),Проверить(Number.isFinite(i)&&(0===i||i>500)),i=Math.round(i),м_Журнал.Вот(`[Загрузчик] ${t} ${a} не дольше ${i}мс`),new Promise((u,d)=>{const f=new XMLHttpRequest;if(f.addEventListener("timeout",v),f.addEventListener("error",v),f.addEventListener("abort",v),f.addEventListener("load",function(){try{if(q)return;Проверить(f.readyState===XMLHttpRequest.DONE);const e=f.status;if(e>=200&&e<=299&&null!==f.response){Проверить(c&&W(f.response)||!c&&"string"==typeof f.response);const t=Math.round(n.now()-g),r=Math.round(p-g);м_Журнал[200===e?"Вот":"Ой"](`[Загрузчик] Загрузил ${a} за ${t}мс`+(l?` ОжиданиеОтвета=${r}мс`:"")+(200===e?"":` Код=${e} ${f.statusText}`)+(o&&f.response.length?`\n${f.response}`:` Размер=${c?f.response.byteLength:f.response.length}`)),0!==i&&ge.СкачаноНечто(function(e){var t,n=17+e.statusText.length+e.getAllResponseHeaders().length;(function(e){return 0===e.statusText.length})(e)&&(n=Math.round(.5*n));var r=e.getResponseHeader("Content-Length");r?t=Number.parseInt(r,10):"text"!==e.responseType?t=e.response.byteLength:(t=e.response.length,(r=e.getResponseHeader("Content-Encoding"))&&"identity"!==r&&(t=Math.round(.35*t)));return n+t}(f)),c?u({"буфДанные":f.response,"чДлительностьЗагрузки":t,"чОжиданиеОтвета":r}):(Проверить(!l),u(f.response))}else м_Журнал.Ой(`[Загрузчик] Не удалось загрузить ${a}. Сервер вернул код ${e} ${f.statusText}`+(c&&W(f.response)?` Размер=${f.response.byteLength}`:`\n${f.response}`)),(e>=400&&e<=499||null===f.response||!b())&&d(B+e)}catch(e){re.ПойманоИсключение(e)}}),l&&f.addEventListener("progress",function e(){try{Проверить(Number.isNaN(p)),p=n.now(),f.removeEventListener("progress",e)}catch(e){re.ПойманоИсключение(e)}}),e&&e.ЗаменитьОбработчик(()=>{f.removeEventListener("abort",v),f.abort(),d(ie.ОБЕЩАНИЕ_ОТМЕНЕНО)}),f.open(t,r),s)for(var h of Object.keys(s))f.setRequestHeader(h,s[h]);f.responseType=c?"arraybuffer":"text",f.timeout=i;var m=!c;Проверить(!m||!l);const g=n.now();var p=NaN;function b(){if(!m)return!1;if(м_Журнал.Ой(`[Загрузчик] Повторно загружаю ${a}`),f.open(t,r),s)for(var e of Object.keys(s))f.setRequestHeader(e,s[e]);return m=!1,f.send(),!0}function v(e){try{if(q)return;м_Журнал.Ой(`[Загрузчик] Не удалось загрузить ${a}. Произошло событие ${e.type}`),("timeout"!==e.type&&"error"!==e.type||!b())&&d(`Произошло событие ${e.type}`)}catch(e){re.ПойманоИсключение(e)}}f.send()})}function t(){for(var e=se.length,n=me.Получить("кЗаначка");0!==n&&(0!==e&&se[e-1].чОбработка===g);--n)--e;var r=me.Получить("кОдновременныхЗагрузок"),o=0;for(n=0;n<e;++n)se[n].чОбработка<=b&&(o+=se[n].чДлительность,se[n].чОбработка<=p&&(--r,se[n].чОбработка===g&&r>=0&&i(se[n])));if(o>=s)return м_Журнал.Ой(`[Загрузчик] Длительность всех загрузок в очереди ${м_Журнал.F1(o)}с >= ${s}с`),a(null),void t();$e.ПреобразоватьСледующийСегмент()}function i(n){const i=5e3+n.чДлительность*me.Получить("кОдновременныхЗагрузок")*2*1e3;Проверить(i<1e3*s);const o=n.пДанные;n.пДанные=new ie,n.пДанные.НачалоВыполнения(),n.чОбработка=p,e(n.пДанные,"GET",o,i,`сегмент ${n.чНомер}`,!1,null,!0,ge.ОкноПоказано()).then(e=>{Проверить(se.includes(n)),n.пДанные=e.буфДанные,n.чОбработка=b,ge.ЗагруженСегмент(e.буфДанные.byteLength,n.чДлительность,e.чДлительностьЗагрузки,e.чОжиданиеОтвета),t()}).catch(r(e=>{"string"==typeof e&&n.чОбработка===p?(м_Журнал.Ой(`[Загрузчик] Не удалось загрузить сегмент ${n.чНомер}. ${e}`),Проверить(se.includes(n)),a(e===B+404||e===B+410?null:n),Проверить(!se.includes(n)),t()):e===ie.ОБЕЩАНИЕ_ОТМЕНЕНО?(м_Журнал.Вот(`[Загрузчик] Отменена загрузка сегмента ${n.чНомер}`),Проверить(!se.includes(n))):re.ПойманоИсключение(e)}))}function a(e){se.ПоказатьСостояние();const t=se.length;if(e)se.Удалить(e);else for(var n,r=me.Получить("кЗаначка"),i=me.Получить("чРазмерБуфера"),a=t-1;n=se[a];--a)"number"!=typeof n.пДанные&&(n.чОбработка!==p?n.чОбработка===g&&(r>0?r-=1:i>0?i-=n.чДлительность:se.Удалить(a)):se.Удалить(a));se.ПоказатьСостояние(),ge.НеЗагруженыСегменты(t-se.length)}return{"ЗагрузитьТекст":function(t,n,r,i,a,o,s){return e(t,void 0===s?"GET":s,n,r,i,a,o,!1,!1)},"ЗагрузитьСледующийСегмент":t}})();let Ie=null;function Se(e){const n=6e4,i=24e4,a="jzkbprff40iqj646a697cyrvl0zt2m6",o={"Client-ID":a,Accept:"application/vnd.twitchtv.v5+json"};let s="",c="",d="",f="",h=new ie;function m(e){if(Проверить(d&&s&&f),d===s)return Проверить(void 0===e),void ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"чПодписка":x});let t,n;switch(e){case void 0:t="GET",n="";break;case T:t="DELETE",n="";break;case L:t="PUT",n="?notifications=false";break;case C:t="PUT",n="?notifications=true";break;default:Проверить(!1)}ke.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/users/${d}/follows/channels/${s}${n}`,l,`подписка ${e}`,!0,void 0===e?o:{"Client-ID":a,Accept:"application/vnd.twitchtv.v5+json",Authorization:`OAuth ${f}`},t).then(t=>{if(e===T)return Проверить(""===t),void ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"чПодписка":T});let n;try{n=JSON.parse(t)}catch(e){throw String(e)}Проверить(ЭтоНепустаяСтрока(n.created_at)),Проверить("boolean"==typeof n.notifications),ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"чПодписка":void 0!==e?e:n.notifications?C:L})}).catch(r(t=>{t===B+404?(Проверить(void 0===e),ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"чПодписка":T})):"string"==typeof t?(м_Журнал.Ой(`[Twitch] Не удалось обновить подписку. ${t}`),ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"чПодписка":x})):re.ПойманоИсключение(t)}))}const g=r(()=>{Проверить(s),ke.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${s}`,l,"метаданные канала",!0,o).then(e=>{let t;try{t=JSON.parse(e)}catch(e){throw String(e)}const n=new Date(t.created_at);Проверить(t._id===s&&Number.isFinite(t.followers)&&Number.isFinite(t.views)&&!Number.isNaN(n.getTime())),ue.ОбработатьСобытие("twitch-полученыметаданныеканала",{"сИмя":t.display_name||t.name,"сАватар":t.logo||chrome.extension.getURL("glitch.svg#avatar"),"сОписание":t.description,"сКодЯзыка":"other"===t.broadcaster_language?null:t.broadcaster_language,"кПодписчиков":t.followers,"кПросмотров":t.views,"дКаналСоздан":n})}).catch(e=>{"string"==typeof e?м_Журнал.Ой(`[Twitch] Не удалось получить метаданные канала. ${e}`):re.ПойманоИсключение(e)}),ke.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${s}/communities`,l,"сообщества канала",!0,o).then(e=>{let t;try{t=JSON.parse(e)}catch(e){throw String(e)}Проверить(Array.isArray(t.communities));for(let e of t.communities)Проверить(ЭтоНепустаяСтрока(e.name)),e.сИмя=e.display_name||e.name,e.сОписание=e.description,e.сАдрес=`https://www.twitch.tv/communities/${encodeURIComponent(e.name)}`;ue.ОбработатьСобытие("twitch-полученыметаданныеканала",{"моСообщества":t.communities})}).catch(e=>{"string"==typeof e?м_Журнал.Ой(`[Twitch] Не удалось получить сообщества канала. ${e}`):re.ПойманоИсключение(e)}),ke.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${s}/teams`,l,"команды канала",!0,o).then(e=>{let t;try{t=JSON.parse(e)}catch(e){throw String(e)}Проверить(Array.isArray(t.teams));for(let e of t.teams)Проверить(ЭтоНепустаяСтрока(e.name)),e.сИмя=e.display_name||e.name,e.info&&(e.сОписание=z(e.info)),e.сАдрес=`https://www.twitch.tv/team/${encodeURIComponent(e.name)}`;ue.ОбработатьСобытие("twitch-полученыметаданныеканала",{"моКоманды":t.teams})}).catch(e=>{"string"==typeof e?м_Журнал.Ой(`[Twitch] Не удалось получить команды канала. ${e}`):re.ПойманоИсключение(e)}),function(){let e;ke.ЗагрузитьТекст(null,"https://api.twitch.tv/kraken/user",l,"метаданные зрителя",!1,o).then(t=>{let n;try{n=JSON.parse(t)}catch(e){throw String(e)}return Проверить(ЭтоНепустаяСтрока(n._id)),Проверить(ЭтоНепустаяСтрока(n.name)),d=n._id,e=n.display_name||n.name,ke.ЗагрузитьТекст(null,"https://api.twitch.tv/api/viewer/token.json",l,"токен зрителя",!1,{"Client-ID":a})}).then(t=>{let n;try{n=JSON.parse(t)}catch(e){throw String(e)}Проверить(ЭтоНепустаяСтрока(n.token)),f=n.token,ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"сИмя":e}),m()}).catch(r(e=>{"string"==typeof e?(м_Журнал.Ой(`[Twitch] Не удалось получить метаданные зрителя. ${e}`),d=f="",ue.ОбработатьСобытие("twitch-полученыметаданныезрителя",{"сИмя":""})):re.ПойманоИсключение(e)}))}()});function p(t){Проверить(s),м_Журнал.Вот(`[Twitch] Загрузка метаданных трансляции начнется через ${м_Журнал.F0(t)}мс`),ae(h,t).then(()=>ke.ЗагрузитьТекст(h,`https://api.twitch.tv/kraken/streams/${s}`,l,"метаданные трансляции",!0,o)).then(t=>{let r;try{r=JSON.parse(t)}catch(e){throw String(e)}if(!W(r)||!W(r.stream))throw"В загруженном JSON нет метаданных";const a=Date.now()-Date.parse(r.stream.created_at);Проверить(String(r.stream.channel._id)===s&&r.stream.hasOwnProperty("_id")&&ЭтоНепустаяСтрока(r.stream.stream_type)&&Number.isFinite(r.stream.viewers)&&Number.isFinite(a)),e!==r.stream.channel.name&&(м_Журнал.Ой(`[Twitch] Изменился код канала с ${e} на ${r.stream.channel.name}`),e=r.stream.channel.name);const u="live"!==r.stream.stream_type,d={"сНазваниеТрансляции":r.stream.channel.status||Y("J0103"),"сНазваниеИгры":u?null:r.stream.game||Y("J0104"),"сАдресИгры":function(e){return"https://www.twitch.tv/directory"+(e?"/game/"+encodeURIComponent(e):"")}(r.stream.game),"кЗрителей":r.stream.viewers,"чДлительностьТрансляции":a};""===c&&(м_Журнал.Окак(`[Twitch] Идентификатор трансляции: ${r.stream._id}`),c=String(r.stream._id),d.лЗапись=u,d.сАдресЗаписи="",u||function(e){Проверить(s&&c);const t=c,n=Math.max(i-Math.max(e,0),0);м_Журнал.Вот(`[Twitch] Получение записи трансляции начнется через ${м_Журнал.F0(n)}мс`),ae(null,n).then(()=>{if(t!==c)throw"Трансляция завершена";return ke.ЗагрузитьТекст(null,`https://api.twitch.tv/kraken/channels/${s}/videos?broadcast_type=archive&limit=3`,l,"запись трансляции",!0,o)}).then(e=>{if(t!==c)throw"Трансляция завершена";let n;try{n=JSON.parse(e)}catch(e){throw String(e)}for(let e of n.videos)if(String(e.broadcast_id)===t){Проверить("archive"===e.broadcast_type),Проверить(String(e.channel._id)===s),ue.ОбработатьСобытие("twitch-полученыметаданныетрансляции",{"лЗапись":!1,"сАдресЗаписи":e.url});break}}).catch(e=>{"string"==typeof e?м_Журнал.Ой(`[Twitch] Не удалось загрузить запись трансляции. ${e}`):re.ПойманоИсключение(e)})}(a)),ue.ОбработатьСобытие("twitch-полученыметаданныетрансляции",d),p(n)}).catch(r(e=>{"string"==typeof e?(м_Журнал.Ой(`[Twitch] Не удалось загрузить метаданные трансляции. ${e}`),p(n/2)):e===ie.ОБЕЩАНИЕ_ОТМЕНЕНО?м_Журнал.Вот("[Twitch] Отменено обновление метаданных трансляции"):re.ПойманоИсключение(e)}))}return Проверить(ЭтоНепустаяСтрока(e)),{"ПолучитьАбсолютныйАдресСпискаВариантов":function(t){return ke.ЗагрузитьТекст(t,`https://api.twitch.tv/api/channels/${e}/access_token?adblock=false&need_https=false&platform=web&player_type=site`,u,"токен трансляции",!0,{"Client-ID":a}).then(t=>{const n=JSON.parse(t);if(W(n)&&ЭтоНепустаяСтрока(n.token)&&ЭтоНепустаяСтрока(n.sig)){const t=JSON.parse(n.token);if(t.channel===e)return""===s?(Проверить(t.hasOwnProperty("channel_id")),s=String(t.channel_id),setImmediate(g)):Проверить(s===String(t.channel_id)),`http://usher.ttvnw.net/api/channel/hls/${e}.m3u8?token=${encodeURIComponent(n.token)}&sig=${encodeURIComponent(n.sig)}&allow_source=true`}re.ЗавершитьРаботуИПоказатьСообщение("J0203")},e=>{if(e!==B+404&&e!==B+422)throw e;re.ЗавершитьРаботуИПоказатьСообщение("J0203")})},"ПолучитьАбсолютныйАдресСпискаСегментов":function(e){return e},"ПолучитьАдресУбогогоПроигрывателя":function(){return`https://www.twitch.tv/${e}?twitch5=0`},"ПолучитьАдресПанелиЧата":function(){return me.Получить("лПолноценныйЧат")?`https://www.twitch.tv/popout/${e}/chat`:me.Получить("лЗатемнитьЧат")?`https://www.twitch.tv/embed/${e}/chat?darkpopout`:`https://www.twitch.tv/embed/${e}/chat`},"ЭтоАдресПанелиЧата":function(t){const n=t.match(/^https:\/\/www.twitch.tv\/(?:popout|embed)\/([^/]+)\/chat(?:\?|$)/);return n&&n[1]===e},"НачатьСборМетаданныхТрансляции":function(){c="",h.НачалоВыполнения(),p(0)},"ЗавершитьСборМетаданныхТрансляции":function(e){e&&(c=""),м_Журнал.Вот("[Twitch] Отменяю обновление метаданных трансляции"),h.Отменить()},"ИзменитьПодпискуЗрителяНаКанал":function(e){Проверить(Number.isInteger(e)),m(e)},"СоздатьКлип":function(){const n=Math.round(Ee.ПолучитьПозициюВоспроизведенияТрансляции()-3);if(""!==c&&n>0){м_Журнал.Окак(`[Twitch] Создаю клип ИдЗрителя=${d} ИдТрансляции=${c} Позиция=${n}`),t.getElementById("создатьклип-канал").value=e,t.getElementById("создатьклип-трансляция").value=c,t.getElementById("создатьклип-позиция").value=n;try{t.getElementById("создатьклип-форма").submit()}catch(e){}}else м_Журнал.Ой(`[Twitch] Недостаточно данных для создания клипа ИдЗрителя=${d} ИдТрансляции=${c} Позиция=${n}`)}}}function Ne(t){try{q=!0,м_Журнал.Окак("[Запускалка] Завершаю работу"),e.stop(),me.Остановить(),t||(ge.ЗакрытьОкно(),re.Остановить(),Ee.Остановить(),le.Сжечь()),Ie.ЗавершитьСборМетаданныхТрансляции(!0),we.Остановить(),$e.Остановить(),se.Очистить(),м_Журнал.Окак("[Запускалка] Работа завершена")}catch(e){}}r(()=>{function i(e){const t=function(e){return e.searchParams||new URLSearchParams(e.search.slice(1))}(e).get("channel")||"channel";return м_Журнал.Вот(`[Запускалка] Канал ${t}`),{"сКодКанала":t.toLowerCase(),"сАбсолютныйАдресСпискаВариантов":""}}function a(e){м_Журнал.Окак("[Запускалка] window.beforeunload"),Ne(!0)}м_i18n.TranslateDocument(t);const o=i(e.location);if(o.сКодКанала){if(function(t){Проверить(ЭтоНепустаяСтрока(t));for(let n of chrome.extension.getViews({type:"tab"})){try{if(n===e||n.closed||i(n.location).сКодКанала!==t)continue}catch(e){м_Журнал.Ой(`[Запускалка] Недоступно окно расширения: ${e}`);continue}return n.chrome.tabs.getCurrent(r(t=>{n.chrome.runtime.lastError?м_Журнал.Ой(`[Запускалка] Недоступна вкладка расширения: ${n.chrome.runtime.lastError.message}`):(chrome.tabs.update(t.id,{active:!0}),chrome.windows.update(t.windowId,{focused:!0})),e.history.length>1?re.ЗавершитьРаботуИПоказатьСообщение("J0211"):chrome.tabs.getCurrent(r(e=>{Проверить(!chrome.runtime.lastError),chrome.tabs.remove(e.id)}))})),!0}return!1}(o.сКодКанала))return;Ie=Se(o.сКодКанала)}else Ie=function(e){function t(e){return e.replace(/^(file:\/\/\/.*)(\d+)(\.m3u8)$/,(e,t,n,r)=>t+(Number.parseInt(n,10)+1)+r)}function n(){return"about:blank"}return{"ПолучитьАбсолютныйАдресСпискаВариантов":function(){return e=t(e),Promise.resolve(e)},"ПолучитьАбсолютныйАдресСпискаСегментов":function(e){return t(e)},"ПолучитьАдресУбогогоПроигрывателя":n,"ПолучитьАдресПанелиЧата":n,"ЭтоАдресПанелиЧата":function(){return!1},"НачатьСборМетаданныхТрансляции":ЗАГЛУШКА,"ЗавершитьСборМетаданныхТрансляции":ЗАГЛУШКА,"СоздатьКлип":ЗАГЛУШКА}}(o.сАбсолютныйАдресСпискаВариантов);Promise.all([me.Восстановить(),he.ЗапуститьАсинхронно(),new Promise((n,r)=>{"complete"===t.readyState?(м_Журнал.Ой("[Запускалка] document.readyState=complete"),n()):(м_Журнал.Вот(`[Запускалка] document.readyState=${t.readyState}`),e.addEventListener("load",function i(){try{e.removeEventListener("load",i),Проверить("complete"===t.readyState),м_Журнал.Вот("[Запускалка] window.onload"),n()}catch(e){r(e)}}))}),new Promise((e,t)=>{chrome.tabs.getCurrent(n=>{try{Проверить(!chrome.runtime.lastError),Проверить(Number.isInteger(n.id)&&n.id>=0),H=n.id,e()}catch(e){t(e)}})})]).then(function(){м_Журнал.Вот(`[Запускалка] Начало работы ${n.now().toFixed()}мс`),Проверить(!q),e.addEventListener("beforeunload",a),re.Запустить(),_e.Запустить(),Ee.Запустить()?we.Запустить():_e.ПереключитьПросмотрТрансляции(),me.Получить("лПоказатьСтатистику")&&ge.ОткрытьОкно()}).catch(re.ПойманоИсключение)})()}(window);