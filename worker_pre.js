"use strict";var Проверить,Браковать,ЗавершитьРаботуИПоказатьСообщение,ЗавершитьРаботуИОтправитьОтчет,ВыброситьВПомойку,ОкруглитьРазмерКучиAsmJS,AsmJS,ПотокБитов,IsoBaseMedia,ID3,Срез,СрезОбработки;let ВЕРСИЯ_РАСШИРЕНИЯ,м_Журнал,м_Балкон;(function(){var t=Array(2),e=function(e){var i;switch(e){case 0:i=[null,!0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,null,null,null,null,void 0,void 0,null,void 0,void 0,null,void 0,void 0,void 0,void 0,NaN,void 0,void 0,void 0,void 0,!1,null];break;case 1:i=[null];break;default:throw new Error("Unknown scope selector")}return t[e]=i,i},i=this,n=i.Uint8Array.prototype,r=function(t,e,i){Проверить(Number.isInteger(e)&&Number.isInteger(i)&&e>=0&&i<=t.length&&i>=e),this._мбБуфер=t,this._уСледующийБайт=e,this._чСледующийБит=7,this.кБитОсталось=8*(i-e)},a=r.prototype,s=function(t,e){Проверить(Number.isInteger(e)&&e>=0&&e<=t.length),this.мбБуфер=t,this.уНачало=e,this.уКонец=e},o=s.prototype,u=function(t,e,i){Проверить(1===t.BYTES_PER_ELEMENT&&Number.isInteger(e)&&Number.isInteger(i)&&e>=0&&e<=i),this._мб=t;var n=i-e;n>20&&73===this._мб[e]&&68===this._мб[e+1]&&51===this._мб[e+2]&&4===this._мб[e+3]&&0===this._мб[e+5]&&this._ParseSynchsafeInteger(e+6)===n-10?(this._уТег=e+10,this._кбТег=n-10):(this._уТег=-1,this._кбТег=-1),this._уПоле=-1,this._кбПоле=-1},c=u.prototype,h=function(t,e,i,n,r,a){Проверить(Number.isInteger(t)&&t>=0),Проверить(Number.isInteger(e)&&Number.isInteger(i)&&e>=0&&e<=i),Проверить(Number.isInteger(n)&&Number.isInteger(r)&&n>=0&&n<=r),Проверить(0===t&&0===n&&0===r||(r-n)%t==0),Проверить(a>=-1),this.кбСтруктураСемпла=t,this.уНачалоПотока=e,this.уКонецПотока=i,this.уНачалоСемплов=n,this.уКонецСемплов=r,this.чВДНачала=a},d=h.prototype,f=function(t,e,i,n,r,a){Срез.apply(this,arguments),this.nContinuityCounter=-1,this.pPesPacketEnd=-1},l=function(t,e){t|=0;var i=Math.trunc(e);if(i<Number.MIN_SAFE_INTEGER||i>Number.MAX_SAFE_INTEGER)throw new Error(e);var n=i/4294967296|0;this[t]=n>>24,this[t+1|0]=n>>16,this[t+2|0]=n>>8,this[t+3|0]=n,n=0|i,this[t+4|0]=n>>24,this[t+5|0]=n>>16,this[t+6|0]=n>>8,this[t+7|0]=n},v=function(t,e){e|=0,this[t|=0]=e>>24,this[t+1|0]=e>>16,this[t+2|0]=e>>8,this[t+3|0]=e},m=function(t,e){e|=0,this[t|=0]=e>>8,this[t+1|0]=e},P=function(t,e){O.push(t),W.push(`[Worker] ${e}`)},_=function(){var i=t[0]||e(0);i[2]=!1,i[3]=!1,i[4]=!1,i[5]=1/0,i[6]=-1/0,i[7]=NaN,i[8]=NaN,i[9]=NaN,i[10]=NaN,i[11]=0},b=function(){var i=t[0]||e(0);ВыброситьВПомойку(i[12]),i[12]=null,ВыброситьВПомойку(i[13]),i[13]=null,ВыброситьВПомойку(i[18]),i[18]=null,ВыброситьВПомойку(i[14]),i[14]=null,ВыброситьВПомойку(i[15]),i[15]=null,i[21]=null,i[32]=null,м_Балкон.Освободить()},p=function(t,e,i,n,r){var a=Math.ceil(e+i);if(t&&t.length>=a)return t;a=Math.ceil(a*n),r&&(a=ОкруглитьРазмерКучиAsmJS(a)),м_Журнал[t?"Окак":"Вот"](`Увеличиваю массив с ${t?t.length:0} до ${a}`);var s=new Uint8Array(a);return 0!==e&&s.Копировать(0,t,0,e),ВыброситьВПомойку(t),s},g=function(t,e,i){var n=0|t[e],r=0|t.ПрочестьБЦ32(e+1);return Проверить((241&n)==(0|i)&&65537==(65537&r)),+((14&n)*(1<<29)+(r>>2&1073709056|r>>1&32767))},S=function(i,n,r){var a=t[0]||e(0);Проверить(n<r),n+=1+i[n],Проверить(r-n>=16),Проверить(0===i[n]),Проверить(32781==(53247&i.ПрочестьБЦ16(n+1))),Проверить(1==(1&i[n+5]));var s=62&i[n+5];Проверить(0===i[n+6]),Проверить(0===i[n+7]);var o=i.ПрочестьБЦ16(n+8);Проверить(0!==o);var u=8191&i.ПрочестьБЦ16(n+10);return Проверить(u>=16&&u<=8190),a[1]&&м_Журнал.Вот(`PatVersion=${s} ProgramNumber=${o} PmtPid=${u}`),{nPatVersion:s,nProgramNumber:o,nPmtPid:u}},x=function(i,n,r,a){var s=t[0]||e(0);Проверить(n<r),n+=1+i[n],Проверить(r-n>=12),Проверить(2===i[n]);var o=i.ПрочестьБЦ16(n+1);Проверить(32768==(49152&o)),Проверить((o=n+3+(4095&o)-4)>=n+12&&o+4<=r),Проверить(i.ПрочестьБЦ16(n+3)===a),Проверить(1==(1&i[n+5]));var u=62&i[n+5];Проверить(0===i[n+6]),Проверить(0===i[n+7]),n+=12+(4095&i.ПрочестьБЦ16(n+10));for(var c=-1,h=-1,d=-1;n!==o;n=f+v){var f=n+5;Проверить(f<=o);var l=8191&i.ПрочестьБЦ16(n+1);Проверить(l>=16&&l<=8190);var v=4095&i.ПрочестьБЦ16(n+3);switch(Проверить(f+v<=o),i[n]){case 27:-1===c?c=l:м_Журнал.Ой(`Найден дополнительный видеопоток PID=${l}`);break;case 15:-1===h?h=l:м_Журнал.Ой(`Найден дополнительный аудиопоток PID=${l}`);break;case 21:15===v&&38===i[f]&&13===i[f+1]&&255===i[f+2]&&255===i[f+3]&&73===i[f+4]&&68===i[f+5]&&51===i[f+6]&&32===i[f+7]&&255===i[f+8]&&73===i[f+9]&&68===i[f+10]&&51===i[f+11]&&32===i[f+12]&&0===i[f+13]&&(-1===d?d=l:м_Журнал.Ой(`Найдены дополнительные метаданные PID=${l}`))}}return s[1]&&м_Журнал.Вот(`PmtVersion=${u} VideoPid=${c} AudioPid=${h} MetadataPid=${d}`),-1!==c&&-1!==h||ЗавершитьРаботуИПоказатьСообщение("J0207"),{nPmtVersion:u,nVideoPid:c,nAudioPid:h,nMetadataPid:d}},$=function(i,n,r){var a=t[0]||e(0),s=i[n],o=i[n+1],u=i[n+2],c=new ПотокБитов(i,n+3,r),h=c.ПрочестьБеззнаковыйЭКГ();Проверить(h<32);var d=1,f=0,l=0,v=0;switch(s){case 183:d=0;break;case 100:case 110:case 122:case 244:case 44:case 83:case 86:case 118:case 128:case 138:case 139:case 134:if(d=c.ПрочестьБеззнаковыйЭКГ(),Проверить(d<=3),3===d&&(f=c.ПрочестьБиты(1)),l=c.ПрочестьБеззнаковыйЭКГ(),Проверить(l<=6),v=c.ПрочестьБеззнаковыйЭКГ(),Проверить(v<=6),c.ПропуститьБиты(1),0!==c.ПрочестьБиты(1))for(var m=0,P=3!==d?8:12;m<P;++m)if(0!==c.ПрочестьБиты(1))for(var _=8,b=8,p=0,g=m<6?16:64;p<g;++p)0!==b&&(b=(_+c.ПрочестьЗнаковыйЭКГ()+256)%256),0!==b&&(_=b)}switch(c.ПропуститьЭКГ(),c.ПрочестьБеззнаковыйЭКГ()){case 0:c.ПропуститьЭКГ();break;case 1:c.ПропуститьБиты(1),c.ПропуститьЭКГ(),c.ПропуститьЭКГ();for(m=0,P=c.ПрочестьБеззнаковыйЭКГ();m<P;++m)c.ПропуститьЭКГ()}var S=c.ПрочестьБеззнаковыйЭКГ();c.ПропуститьБиты(1);var x=c.ПрочестьБеззнаковыйЭКГ()+1,$=c.ПрочестьБеззнаковыйЭКГ()+1,I=c.ПрочестьБиты(1);if(0===I&&c.ПропуститьБиты(1),c.ПропуститьБиты(1),0!==c.ПрочестьБиты(1))var A=c.ПрочестьБеззнаковыйЭКГ(),y=c.ПрочестьБеззнаковыйЭКГ(),F=c.ПрочестьБеззнаковыйЭКГ(),N=c.ПрочестьБеззнаковыйЭКГ();else A=0,y=0,F=0,N=0;if(0!==c.ПрочестьБиты(1)){if(0!==c.ПрочестьБиты(1)){var B=c.ПрочестьБиты(8);if(255===B)var w=c.ПрочестьБиты(16),M=c.ПрочестьБиты(16)}if(0!==c.ПрочестьБиты(1)&&c.ПропуститьБиты(1),0!==c.ПрочестьБиты(1)){var k=c.ПрочестьБиты(3),E=c.ПрочестьБиты(1);0!==c.ПрочестьБиты(1)&&c.ПропуститьБиты(24)}if(0!==c.ПрочестьБиты(1)&&(c.ПропуститьЭКГ(),c.ПропуститьЭКГ()),0!==c.ПрочестьБиты(1))var C=c.ПрочестьБиты(32),D=c.ПрочестьБиты(32),T=c.ПрочестьБиты(1)}var R=1,q=1;0===f&&0!==d&&(R=3===d?1:2,q=1===d?2:1),0===I&&(q+=q,$+=$),a[21].чШиринаКартинки=16*x-R*y-R*A,a[21].чВысотаКартинки=16*$-q*N-q*F,a[21].nProfileIndication=s,a[21].nConstraintSetFlag=o,a[21].nLevelIndication=u,a[21].nChromaFormatIndication=d,a[21].nBitDepthLumaMinus8=l,a[21].nBitDepthChromaMinus8=v,a[21].nMaxNumberReferenceFrames=S,a[21].чДиапазон=void 0===E?-1:E,a[21].лЧересстрочное=0===I,a[21].чЧастотаКадров=void 0===D?0:D/C/(0===T?-2:2),м_Журнал.Вот("ШиринаКартинки="+a[21].чШиринаКартинки+" ВысотаКартинки="+a[21].чВысотаКартинки+" ProfileIndication="+s+" ConstraintSetFlag=0x"+o.toString(16)+" LevelIndication="+(u/10).toFixed(1)+" MaxNumberReferenceFrames="+S+" SequenceParameterSetId="+h+" AspectRatioIndication="+B+" SarWidth="+w+" SarHeight="+M+" VideoFormat="+k+" VideoFullRangeFlag="+E+" TimeScale="+D+" NumUnitsInTick="+C+" FixedFrameRateFlag="+T),0===I&&м_Журнал.Ой("Чересстрочное видео")},I=function(t,e,i){Проверить(e<i);var n=31&t[e++];14!==n&&20!==n&&21!==n||(Проверить(e<i),e+=21===n&&0!=(128&t[e])?2:3,Проверить(e<=i));for(var r=e,a=i-2;e<a;)if(0===t[e++]&&0===t[e++]){var s=t[e++];if(Проверить(s>=3),3===s){var o=e-1;for(Проверить(e===i||t[e]<=3);e<a;)0===(t[o++]=t[e++])&&0===(t[o++]=t[e++])&&(s=t[o++]=t[e++],Проверить(s>=3),3===s&&(--o,Проверить(e===i||t[e]<=3)));for(;e!==i;)var u=t[o++]=t[e++];return Проверить(0!==u),{"уНачалоRBSP":r,"уКонецRBSP":o}}}return Проверить(e===i||0!==t[i-1]),{"уНачалоRBSP":r,"уКонецRBSP":i}},A=function(i){var n=t[0]||e(0);Проверить(-983040==(4294901760&i)),n[21].aDecoderSpecificInfo=[0,0],n[21].nAudioObjectType=1+(i>>14&3),n[21].aDecoderSpecificInfo[0]=n[21].nAudioObjectType<<3;var r=i>>10&15;n[21].чЧастотаДискретизации=q[r],Проверить(void 0!==n[21].чЧастотаДискретизации),n[21].aDecoderSpecificInfo[0]|=r>>1,n[21].aDecoderSpecificInfo[1]=r<<7&128,n[21].чКоличествоКаналов=i>>6&7,Проверить(0!==n[21].чКоличествоКаналов),n[21].aDecoderSpecificInfo[1]|=n[21].чКоличествоКаналов<<3,м_Журнал[2!==n[21].nAudioObjectType||n[21].чЧастотаДискретизации<44100||n[21].чКоличествоКаналов>2?"Ой":"Вот"](`AudioObjectType=${n[21].nAudioObjectType} ЧастотаДискретизации=${n[21].чЧастотаДискретизации} КоличествоКаналов=${n[21].чКоличествоКаналов}`)},y=function(t,e,i){i.AddBox("trak",function(){i.AddFullBox("tkhd",0,3,80),i.мбБуфер.ЗаписатьБЦ32(i.уКонец-64,4294967295),i.мбБуфер[i.уКонец-43]=1,i.мбБуфер[i.уКонец-27]=1,i.мбБуфер[i.уКонец-12]=64,e?(i.мбБуфер.ЗаписатьБЦ32(i.уКонец-72,1),i.мбБуфер.ЗаписатьБЦ16(i.уКонец-8,t.чШиринаКартинки),i.мбБуфер.ЗаписатьБЦ16(i.уКонец-4,t.чВысотаКартинки)):(i.мбБуфер.ЗаписатьБЦ32(i.уКонец-72,2),i.мбБуфер.ЗаписатьБЦ16(i.уКонец-48,256)),i.AddBox("mdia",function(){i.AddFullBox("mdhd",0,0,20),i.мбБуфер.ЗаписатьБЦ32(i.уКонец-12,e?9e4:t.чЧастотаДискретизации),i.мбБуфер[i.уКонец-8]=255,i.мбБуфер[i.уКонец-7]=255,i.мбБуфер[i.уКонец-6]=255,i.мбБуфер[i.уКонец-5]=255,i.мбБуфер[i.уКонец-4]=85,i.мбБуфер[i.уКонец-3]=196,i.AddFullBox("hdlr",0,0,e?[0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,67,111,111,108,67,109,100,86,105,100,53,0]:[0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,67,111,111,108,67,109,100,65,117,100,53,0]),i.AddBox("minf",function(){e?i.AddFullBox("vmhd",0,1,8):i.AddFullBox("smhd",0,0,4),i.AddBox("dinf",function(){i.AddFullBox("dref",0,0,function(){i.мбБуфер.ЗаписатьБЦ32(i.уКонец,1),i.уКонец+=4,i.AddFullBox("url ",0,1,0)})}),i.AddBox("stbl",function(){i.AddFullBox("stsd",0,0,function(){i.мбБуфер.ЗаписатьБЦ32(i.уКонец,1),i.уКонец+=4,e?i.AddBox("avc1",function(){i.мбБуфер.ЗаписатьБЦ16(i.уКонец+6,1),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+24,t.чШиринаКартинки),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+26,t.чВысотаКартинки),i.мбБуфер.ЗаписатьБЦ32(i.уКонец+28,4718592),i.мбБуфер.ЗаписатьБЦ32(i.уКонец+32,4718592),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+40,1),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+74,24),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+76,65535),i.уКонец+=78,i.AddBox("avcC",function(){switch(i.мбБуфер[i.уКонец]=1,i.мбБуфер[i.уКонец+1]=t.nProfileIndication,i.мбБуфер[i.уКонец+2]=t.nConstraintSetFlag,i.мбБуфер[i.уКонец+3]=t.nLevelIndication,i.мбБуфер[i.уКонец+4]=255,i.мбБуфер[i.уКонец+5]=225,i.мбБуфер.ЗаписатьБЦ16(i.уКонец+6,t.abSequenceParameterSet.length),i.Копировать(i.уКонец+8,t.abSequenceParameterSet),i.мбБуфер[i.уКонец]=1,i.мбБуфер.ЗаписатьБЦ16(i.уКонец+1,t.abPictureParameterSet.length),i.Копировать(i.уКонец+3,t.abPictureParameterSet),t.nProfileIndication){case 100:case 110:case 122:case 144:i.мбБуфер[i.уКонец]=252|t.nChromaFormatIndication,i.мбБуфер[i.уКонец+1]=248|t.nBitDepthLumaMinus8,i.мбБуфер[i.уКонец+2]=248|t.nBitDepthChromaMinus8,void 0===t.abSequenceParameterSetExt?i.уКонец+=4:(i.мбБуфер[i.уКонец+3]=1,i.мбБуфер.ЗаписатьБЦ16(i.уКонец+4,t.abSequenceParameterSetExt.length),i.Копировать(i.уКонец+6,t.abSequenceParameterSetExt))}})}):i.AddBox("mp4a",function(){i.мбБуфер.ЗаписатьБЦ16(i.уКонец+6,1),i.мбБуфер.ЗаписатьБЦ16(i.уКонец+18,16),i.уКонец+=28,i.AddFullBox("esds",0,0,function(){i.мбБуфер[i.уКонец]=3,i.мбБуфер[i.уКонец+1]=23+t.aDecoderSpecificInfo.length,i.мбБуфер.ЗаписатьБЦ16(i.уКонец+2,1),i.мбБуфер[i.уКонец+5]=4,i.мбБуфер[i.уКонец+6]=15+t.aDecoderSpecificInfo.length,i.мбБуфер[i.уКонец+7]=64,i.мбБуфер[i.уКонец+8]=21,i.мбБуфер[i.уКонец+20]=5,i.мбБуфер[i.уКонец+21]=t.aDecoderSpecificInfo.length,i.Копировать(i.уКонец+22,t.aDecoderSpecificInfo),i.мбБуфер[i.уКонец]=6,i.мбБуфер[i.уКонец+1]=1,i.мбБуфер[i.уКонец+2]=2,i.уКонец+=3})})}),i.AddFullBox("stts",0,0,4),i.AddFullBox("stsc",0,0,4),i.AddFullBox("stco",0,0,4),i.AddFullBox("stsz",0,0,8)})})})})},F=function(i,n,r,a,s,o){var u=t[0]||e(0);if(s||!r.Пусто()||!a.Пусто()){var c,h=Object.create(null),d=0,f=u[0].чНомер+(u[11]+=.1);s&&(h.чПреобразованЗа=u[26],h.лЗабраковано=u[2],h.лПотериВидео=u[3],h.лПотериЗвука=u[4],h.чМинДлительностьВидеоСемпла=u[5]/90,h.чМаксДлительностьВидеоСемпла=u[6]/90,h.чСредняяДлительностьВидеоСемпла=u[7]/90,h.чБитрейтЗвука=u[8],h.чВремяКодирования=u[9],h.чПозицияКодирования=u[10]),(r&&!r.Пусто()||a&&!a.Пусто())&&(!function(i,n,r,a,s){var o=t[0]||e(0);Проверить(!n.Пусто()||!r.Пусто());var u,c=160+n.ПолучитьРазмерПотока()+n.ПолучитьРазмерСемплов()+r.ПолучитьРазмерПотока()+r.ПолучитьРазмерСемплов();s&&(u=м_Балкон.Найти(c)),u||(u=new Uint8Array(c));var h,d,f=new IsoBaseMedia(u,0);f.AddBox("moof",function(){f.AddFullBox("mfhd",0,0,4),u.ЗаписатьБЦ32(f.уКонец-4,0),n.Пусто()||f.AddBox("traf",function(){f.AddFullBox("tfhd",0,131072,4),u.ЗаписатьБЦ32(f.уКонец-4,1),f.AddFullBox("tfdt",1,0,8),u.ЗаписатьБЦ64(f.уКонец-8,n.чВДНачала),f.AddFullBox("trun",1,3841,function(){u.ЗаписатьБЦ32(f.уКонец,n.ПолучитьКоличествоСемплов()),h=f.уКонец+4,f.Копировать(f.уКонец+8,o[14],n.уНачалоСемплов,n.уКонецСемплов)})}),r.Пусто()||f.AddBox("traf",function(){f.AddFullBox("tfhd",0,131072,4),u.ЗаписатьБЦ32(f.уКонец-4,2),f.AddFullBox("tfdt",1,0,8),u.ЗаписатьБЦ64(f.уКонец-8,r.чВДНачала/9e4*i.чЧастотаДискретизации),f.AddFullBox("trun",1,513,function(){u.ЗаписатьБЦ32(f.уКонец,r.ПолучитьКоличествоСемплов()),d=f.уКонец+4,f.Копировать(f.уКонец+8,o[15],r.уНачалоСемплов,r.уКонецСемплов)})})}),f.AddBox("mdat",function(){n.Пусто()||(u.ЗаписатьЗЦ32(h,f.уКонец-f.уНачало),f.Копировать(f.уКонец,o[12],n.уНачалоПотока,n.уКонецПотока)),r.Пусто()||(u.ЗаписатьЗЦ32(d,f.уКонец-f.уНачало),f.Копировать(f.уКонец,o[13],r.уНачалоПотока,r.уКонецПотока))}),a.мбМедиасегмент=f.Завершить()}(n,r,a,h,o),c=[h.мбМедиасегмент.buffer],d=N(i,n,r,a,f,h),i&&(!function(t,e){var i=1111+t.abSequenceParameterSet.length+t.abPictureParameterSet.length+(t.abSequenceParameterSetExt?t.abSequenceParameterSetExt.length:0)+t.aDecoderSpecificInfo.length,n=new Uint8Array(i),r=new IsoBaseMedia(n,0);r.AddBox("ftyp",[105,115,111,54,0,0,0,0,97,118,99,49]),r.AddBox("moov",function(){r.AddFullBox("mvhd",1,0,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,255,255,255,255,255,255,255,255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]),r.AddBox("mvex",function(){r.AddFullBox("trex",0,0,20),r.мбБуфер.ЗаписатьБЦ32(r.уКонец-20,1),r.мбБуфер.ЗаписатьБЦ32(r.уКонец-16,1),r.AddFullBox("trex",0,0,20),r.мбБуфер.ЗаписатьБЦ32(r.уКонец-20,2),r.мбБуфер.ЗаписатьБЦ32(r.уКонец-16,1),r.мбБуфер.ЗаписатьБЦ32(r.уКонец-12,1024)}),y(t,!0,r),y(t,!1,r)}),e.мбСегментИнициализации=r.Завершить(),e.сКодеки='video/mp4; codecs="'+function(t){return"avc1."+("0"+t.nProfileIndication.toString(16)).slice(-2)+("0"+t.nConstraintSetFlag.toString(16)).slice(-2)+("0"+t.nLevelIndication.toString(16)).slice(-2)}(t)+", "+function(t){return`mp4a.40.${t.nAudioObjectType}`}(t)+'"'}(n,h),h.чШиринаКартинки=n.чШиринаКартинки,h.чВысотаКартинки=n.чВысотаКартинки,h.nProfileIndication=n.nProfileIndication,h.nConstraintSetFlag=n.nConstraintSetFlag,h.nLevelIndication=n.nLevelIndication,h.nMaxNumberReferenceFrames=n.nMaxNumberReferenceFrames,h.чДиапазон=n.чДиапазон,h.лЧересстрочное=n.лЧересстрочное,h.чЧастотаКадров=n.чЧастотаКадров,h.nAudioObjectType=n.nAudioObjectType,h.чЧастотаДискретизации=n.чЧастотаДискретизации,h.чКоличествоКаналов=n.чКоличествоКаналов,c.push(h.мбСегментИнициализации.buffer)))}м_Журнал.Отправить(),h&&postMessage([1,{"пДанные":h,"чДлительность":d,"лРазрыв":i,"чTwitchПрошлоВремени":s?u[0].чTwitchПрошлоВремени:NaN,"чНомер":f}],c)},N=function(i,n,r,a,s,o){var u=t[0]||e(0);i&&(u[27]=u[28]=u[29]=u[30]=-1);var c="Вот",h=u[28],d="";if(!r.Пусто()){var f=r.чВДНачала/9e4;Проверить(f>=u[28]),-1===u[27]&&(u[27]=f),h=(r.чВДНачала+r.СложитьБеззнаковыйПараметр(0,r.уКонецСемплов,u[14]))/9e4,Проверить(h>=f),d=` Видео=${f.toFixed(3)}-${h.toFixed(3)}`;var l=r.ПолучитьКоличествоСемплов();l<8&&(c="Ой",d=` Видеосемплов=${l}${d}`)}var v=u[30],m="";if(!a.Пусто()){var P=a.чВДНачала/9e4;-1===u[29]&&(u[29]=P),v=P+1024*a.ПолучитьКоличествоСемплов()/n.чЧастотаДискретизации,Проверить(v>=P),m=` Звук=${P.toFixed(3)}-${v.toFixed(3)}`}var _=Math.max(u[27],u[29],Math.min(u[28],u[30])),b=Math.max(u[27],u[29],Math.min(u[28]=h,u[30]=v))-_;return м_Журнал[c](`Отправляю сегмент ${s} Разрыв=${i}`+` Длительность=${b.toFixed(3)}${d}${m}`+` Размер=${(o.мбМедиасегмент.length/1024/1024).toFixed(2)}мб`),b},B=function(i,n){var r=t[0]||e(0);Проверить(i>U.уНачалоПотока&&i<U.уКонецПотока),Проверить(n>U.уНачалоСемплов&&n<U.уКонецСемплов);var a=U.чВДНачала+U.СложитьБеззнаковыйПараметр(0,n,r[14]),s=V.ПолучитьКоличествоСемплов(),o=s;j.чВДНачала=r[19];var u=(U.уКонецСемплов-n)/16;return м_Журнал.Вот(`Сегмент разделен Видео=${U.ПолучитьКоличествоСемплов()-u}+${u} Звук=${o}+${s-o}`),[new Срез(16,U.уНачалоПотока,i,U.уНачалоСемплов,n,U.чВДНачала),new Срез(16,i,U.уКонецПотока,n,U.уКонецСемплов,a),V,j]},w=function(i,n,r,a){var s=t[0]||e(0);s[31]=i,s[32]=n,Проверить(0===T.уНачалоПотока),T.уКонецПотока=r.ПолучитьРазмерПотока(),s[12].copyWithin(0,r.уНачалоПотока,r.уКонецПотока),Проверить(0===T.уНачалоСемплов),T.уКонецСемплов=r.ПолучитьРазмерСемплов(),s[14].copyWithin(0,r.уНачалоСемплов,r.уКонецСемплов),T.чВДНачала=r.чВДНачала,Проверить(0===R.уНачалоПотока),R.уКонецПотока=a.ПолучитьРазмерПотока(),s[13].copyWithin(0,a.уНачалоПотока,a.уКонецПотока),Проверить(0===R.уНачалоСемплов),R.уКонецСемплов=a.ПолучитьРазмерСемплов(),s[15].copyWithin(0,a.уНачалоСемплов,a.уКонецСемплов),R.чВДНачала=a.чВДНачала},M=function(i,n){var r=t[0]||e(0);Проверить(!r[1]),Проверить(r[32]===r[21]),Проверить(T.уКонецПотока===i.уНачалоПотока&&T.уКонецСемплов===i.уНачалоСемплов),Проверить(R.уКонецПотока===n.уНачалоПотока&&R.уКонецСемплов===n.уНачалоСемплов),Проверить(!T.Пусто()),T.уКонецПотока=i.уКонецПотока,T.уКонецСемплов=i.уКонецСемплов,R.Пусто()&&(R.чВДНачала=n.чВДНачала),R.уКонецПотока=n.уКонецПотока,R.уКонецСемплов=n.уКонецСемплов},k=function(){var i=t[0]||e(0),n=performance.now();i[1]=i[1]||i[0].лРазрыв,м_Журнал.Вот(`НАЧАЛО ПРЕОБРАЗОВАНИЯ СЕГМЕНТА ${i[0].чНомер} Размер=${(i[0].пДанные.byteLength/1024/1024).toFixed(2)}мб Длительность=${i[0].чДлительность} Разрыв=${i[1]} РазделятьПоКлючевымКадрам=${i[0].чОбработка}`),_();var r=!1;if("number"!=typeof i[0].пДанные){var a=new Uint8Array(i[0].пДанные);try{!function(i,n){var r=t[0]||e(0);Проверить(0===T.уНачалоПотока&&0===R.уНачалоПотока),Проверить(0===T.уНачалоСемплов&&0===R.уНачалоСемплов),n+=2;var a=Math.ceil(250*n),s=20*a,o=i+s,u=i,c=16*a,h=4*q[0]/1024*n;r[12]=p(r[12],T.уКонецПотока,o,1.3,!1),r[13]=p(r[13],R.уКонецПотока,u,1.3,!1),r[14]=p(r[14],T.уКонецСемплов,c,1.5,!1),r[15]=p(r[15],R.уКонецСемплов,h,1.5,!1),void 0===r[12].НайтиПрефикс&&(r[12].НайтиПрефикс=AsmJS(self,null,r[12].buffer).SearchStartCodePrefix),U.уНачалоПотока=T.уКонецПотока+s,U.уНачалоСемплов=T.уКонецСемплов,U.Свернуть(),V.уНачалоПотока=R.уКонецПотока,V.уНачалоСемплов=R.уКонецСемплов,V.Свернуть(),L.уКонецПотока=L.уНачалоПотока}(a.length,i[0].чДлительность),function(i){var n=t[0]||e(0);Проверить(U.уКонецПотока===U.уНачалоПотока&&U.уКонецСемплов===U.уНачалоСемплов&&-1===U.чВДНачала),Проверить(V.уКонецПотока===V.уНачалоПотока&&V.уКонецСемплов===V.уНачалоСемплов&&-1===V.чВДНачала),Проверить(-1!==L.чВДНачала),Браковать(0!==i.length&&i.length%188==0);var r=0,a=-1,s=-1,o=0,u=-1,c=-1,h=-1,d=-1,f="",l=0;U.pPesPacketEnd=V.pPesPacketEnd=L.pPesPacketEnd=-1,n[1]&&(U.nContinuityCounter=V.nContinuityCounter=L.nContinuityCounter=-1,n[16]=n[17]=-1);for(var v=i.length,m=0;m!==v;m+=188){var P=i.ПрочестьБЦ32(m);Браковать(1191182336==(4286578880&P));var _=(2096896&P)>>8,b=m+4;if(0!=(32&P)){var $=i[b];Проверить($<=183),Проверить(0===$||0==(128&i[b+1])),b+=1+$}switch(_){case u:0!=(4194304&P)&&Проверить(480==(4294967280&i.ПрочестьБЦ32(b)));var I=n[12],A=U;break;case c:0!=(4194304&P)&&Проверить(448==(4294967264&i.ПрочестьБЦ32(b))),I=n[13],A=V;break;case h:if(0!=(4194304&P)){Проверить(445===i.ПрочестьБЦ32(b));var y=i.ПрочестьБЦ16(b+4);Проверить(0!==y),f+=y+" ",n[18]=p(n[18],0,y,2,!1),L.уКонецПотока=L.уНачалоПотока,L.pPesPacketEnd=-1}I=n[18],A=L;break;case 0:++r,Проверить(4194320==(4194320&P));var F=S(i,b,m+188);-1===n[16]?n[16]=F.nPatVersion:Проверить(n[16]===F.nPatVersion),1===r?(a=F.nProgramNumber,s=F.nPmtPid):Проверить(a===F.nProgramNumber&&s===F.nPmtPid);continue;case s:++o,Проверить(4194320==(4194320&P)),F=x(i,b,m+188,a),-1===n[17]?n[17]=F.nPmtVersion:Проверить(n[17]===F.nPmtVersion),1===o?(u=F.nVideoPid,c=F.nAudioPid,h=F.nMetadataPid):Проверить(u===F.nVideoPid&&c===F.nAudioPid&&h===F.nMetadataPid);continue;default:continue}switch(A.nContinuityCounter!==(15&P)&&-1!==A.nContinuityCounter&&(м_Журнал.Ой(`continuity_counter равен ${15&P} вместо ${A.nContinuityCounter} PID=${_}`),Проверить(A.уКонецПотока===A.уНачалоПотока)),A.nContinuityCounter=P+1&15,4194320&P){case 16:Проверить(A.уКонецПотока!==A.уНачалоПотока);break;case 4194320:Проверить(A.pPesPacketEnd===A.уКонецПотока||-1===A.pPesPacketEnd);var N=i.ПрочестьБЦ16(b+4),B=i[b+8];if(0!==N?A.pPesPacketEnd=A.уКонецПотока+N-3-B:(Проверить(_===u),A.pPesPacketEnd=-1),_===u||-1===A.чВДНачала){switch(61632&i.ПрочестьБЦ16(b+6)){case 32896:Проверить(B>=5);var w=M=g(i,b+9,33);break;case 32960:Проверить(B>=10);var M=g(i,b+9,49);w=g(i,b+14,17);break;default:Проверить(!1)}if(-1===A.чВДНачала&&(A.чВДНачала=w),_===u)if(w===d&&0!==N)Проверить(0==(4&i[b+6]));else{if(-1!==d){var k=w-d;k<=0&&(k>-10?(w=d+(k=1),++l):(Проверить(d>8584534592),Браковать(!1))),Проверить(k<54e6),n[5]=Math.min(n[5],k),n[6]=Math.max(n[6],k),n[14].ЗаписатьБЦ32(U.уКонецСемплов+-16,k),n[14].ЗаписатьБЦ32(U.уКонецСемплов+4,U.уКонецПотока)}n[14].ЗаписатьЗЦ32(U.уКонецСемплов+12,M-w),U.уКонецСемплов+=16,d=w}else Проверить(M===w)}b+=9+B;break;default:Проверить(!1)}var E=m+188-b;Проверить(E>0),I.Копировать(A.уКонецПотока,i,b,b+E),A.уКонецПотока+=E}if(Проверить(U.pPesPacketEnd===U.уКонецПотока||-1===U.pPesPacketEnd),Проверить(V.pPesPacketEnd===V.уКонецПотока||-1===V.pPesPacketEnd),Проверить(L.pPesPacketEnd===L.уКонецПотока||-1===L.pPesPacketEnd),1===r&&1===o||м_Журнал.Ой(`Количество таблиц в сегменте: PAT=${r} PMT=${o}`),n[3]=U.Пусто(),n[4]=V.Пусто(),n[3]||n[4])return м_Журнал.Ой(`Сегмент не годится для воспроизведения: нет видео ${n[3]}, нет звука ${n[4]}`),!1;0!==l&&м_Журнал.Ой(`Количество видеосемплов с увеличенным ВД: ${l}`);var C=U.ПолучитьКоличествоСемплов();if(n[7]=(d-U.чВДНачала)/(C-1),k=Number.isFinite(n[5])?n[5]:360,n[14].ЗаписатьБЦ32(U.уКонецСемплов+-16,k),м_Журнал.Вот(`ТранспортныхПакетов=${i.length/188}`+` ВДПервогоВидеоСемпла=${U.чВДНачала}`+` ВДПоследнегоВидеоСемпла=${d}`+` ВДПервогоАудиоСемпла=${V.чВДНачала}`+` ВидеоСемплов=${C}`+` ДлительностьВидеоСегмента>${((d-U.чВДНачала)/90).toFixed(2)}мс`+` СредняяДлительностьВидеоСемпла=${(n[7]/90).toFixed(2)}мс(${(9e4/n[7]).toFixed(2)}к/с)`+` МаксДлительностьВидеоСемпла=${(n[6]/90).toFixed(2)}мс(${(9e4/n[6]).toFixed(2)}к/с)`+` МинДлительностьВидеоСемпла=${(n[5]/90).toFixed(2)}мс(${(9e4/n[5]).toFixed(2)}к/с)`+` Метаданные=${f}`),!n[1]){var D=V.чВДНачала-n[19];Math.abs(D)>2&&м_Журнал.Ой(`Отклонение ВД аудиосегмента ${D}`),D>9e3&&(n[4]=!0),Проверить(D>-9e4*n[0].чДлительность*2)}return n[1]||T.Пусто()||(k=U.чВДНачала-n[20],м_Журнал.Вот(`Длительность последнего задержанного видеосемпла ${(k/90).toFixed(2)}мс`),Проверить(k>0),n[14].ЗаписатьБЦ32(T.уКонецСемплов+-16,k),n[7]=(d-n[20])/C,n[5]=Math.min(n[5],k),n[6]=Math.max(n[6],k)),n[20]=d,n[10]=Math.min(U.чВДНачала,V.чВДНачала)/9e4,!0}(a)&&(i[1]&&(i[21]=Object.create(null)),function(){var i=t[0]||e(0);if(!L.Пусто())for(var n,r=new ID3(i[18],L.уНачалоПотока,L.уКонецПотока);n=r.ПолучитьСледующееПоле();)if("TDEN"===n){var a=r.ПолучитьПервоеТекстовоеЗначение();Проверить(null!==a),i[9]=Date.parse(19===a.length?a+"Z":a),Проверить(!Number.isNaN(i[9]));break}}(),r=function(){var i=t[0]||e(0);Проверить(U.уКонецПотока!==U.уНачалоПотока),Проверить(U.уКонецСемплов!==U.уНачалоСемплов),i[22]=i[23]=-1,i[24]=U.уНачалоСемплов-16;var n,r=T.уКонецПотока,a=0,s=0,o=0,u=0,c=-1,h=-1,d=i[12].НайтиПрефикс(U.уНачалоПотока,U.уКонецПотока);for(Проверить(-1!==d),Браковать(-2!==d),Проверить(d===U.уНачалоПотока);;){const t=d===U.уКонецПотока?0:i[12][d]|i[12][d+1]<<8;Проверить(3!==t||-1!==h);const e=d+t-Math.min(4,t)>=h;if(e&&-1!==h&&(-1===n&&(n=65536,++o),Проверить(r>i[25]),i[14].ЗаписатьБЦ32(i[24]+4,r-i[25]),i[14].ЗаписатьБЦ32(i[24]+8,n)),d===U.уКонецПотока){Проверить(i[24]+16===U.уКонецСемплов);break}const l=d+t;if(d=i[12].НайтиПрефикс(l,U.уКонецПотока),Проверить(-1!==d),Браковать(-2!==d),e&&(i[24]+=16,Проверить(i[24]<U.уКонецСемплов),h=i[24]+16===U.уКонецСемплов?U.уКонецПотока:i[14].ПрочестьБЦ32(i[24]+16+4),i[25]=r,n=-1,1===u&&(u=0)),l===d)continue;++a;const v=224&i[12][l];switch(Браковать(v<128),31&i[12][l]){case 1:case 2:case 3:case 4:Проверить(0!==n),n=65536;break;case 5:Проверить(0!==v),0!==n&&(Проверить(65536!==n),n=0,i[22]=i[25],i[23]=i[24],-1===c&&(c=i[24]),++s);break;case 6:Проверить(0===v);break;case 7:Проверить(0!==v),!i[1]||-1!==i[23]&&void 0!==i[21].abSequenceParameterSet||(i[21].abSequenceParameterSet=i[12].slice(l,d));continue;case 8:Проверить(0!==v),!i[1]||-1!==i[23]&&void 0!==i[21].abPictureParameterSet||(i[21].abPictureParameterSet=i[12].slice(l,d));continue;case 9:Проверить(0===v),++u;continue;case 10:Проверить(0===v);continue;case 11:Проверить(0===v),Проверить(!1);continue;case 12:Проверить(0===v);continue;case 13:Проверить(0!==v),!i[1]||-1!==i[23]&&void 0!==i[21].abSequenceParameterSetExt||(i[21].abSequenceParameterSetExt=i[12].slice(l,d)),Проверить(!1);continue}var f=d-l;i[12].ЗаписатьБЦ32(r,f),r+=4,i[12].copyWithin(r,l,d),r+=f}if(м_Журнал.Вот("NalUnits="+a+" КоличествоКлючКадров="+s+" ПервыйКлючКадр="+(c-U.уНачалоСемплов)/16+" ПоследнийКлючКадр="+(i[23]-U.уНачалоСемплов)/16),0!==o&&м_Журнал.Ой(`Видеосемплов без VCL NAL unit: ${o}`),u>1&&м_Журнал.Ой("Несколько access unit в одном видеосемпле"),U.уНачалоПотока=T.уКонецПотока,U.уКонецПотока=r,i[1]){if(-1===i[23]||void 0===i[21].abSequenceParameterSet||void 0===i[21].abPictureParameterSet)return м_Журнал.Ой(`Сегмент не годится для воспроизведения: не найден IDR ${-1===i[23]}, не найден SPS ${void 0===i[21].abSequenceParameterSet}, не найден PPS ${void 0===i[21].abPictureParameterSet}`),!1;var l=i[21].abSequenceParameterSet.slice(),v=I(l,0,l.length);$(l,v.уНачалоRBSP,v.уКонецRBSP)}return!0}()&&function(){var i=t[0]||e(0);Проверить(V.уКонецПотока!==V.уНачалоПотока),Проверить(V.уКонецСемплов===V.уНачалоСемплов),i[1]&&(Проверить(V.ПолучитьРазмерПотока()>7),A(i[13].ПрочестьБЦ32(V.уНачалоПотока)));for(var n=V.уНачалоПотока,r=V.уНачалоПотока,a=V.уНачалоСемплов,s=V.уКонецПотока-7;n<s;){Проверить(255===i[13][n]&&241===i[13][n+1]),Проверить(0==(3&i[13][n+6]));var o=i[13].ПрочестьБЦ32(n+3)>>13&8191,u=n+o;Проверить(o>7&&u<=V.уКонецПотока),i[13].copyWithin(r,n+7,u),r+=o-=7,i[15].ЗаписатьБЦ32(a,o),a+=4,n=u}Проверить(n===V.уКонецПотока),V.уКонецПотока=r,V.уКонецСемплов=a;var c=V.ПолучитьКоличествоСемплов(),h=1024/i[21].чЧастотаДискретизации,d=c*h;return i[19]=V.чВДНачала+Math.round(9e4*d),i[8]=8*V.ПолучитьРазмерПотока()/1e3/d,м_Журнал.Вот(`АудиоСемплов=${c}`+` ВДКонцаАудиоСегмента=${i[19]}`+` ДлительностьАудиоСемпла=${(1e3*h).toFixed(2)}мс`+` ДлительностьАудиоСегмента=${(1e3*d).toFixed(2)}мс`+` СмещениеНачалаАудиоСегмента=${((V.чВДНачала-U.чВДНачала)/90).toFixed(2)}мс`+` ПредполагаемоеСмещениеКонцаАудиоСегмента=${((i[19]-i[20]-i[7])/90).toFixed(2)}мс`),!0}())}catch(t){if(!(t instanceof Error&&"БРАКОВАТЬ"===t.message))throw t;м_Журнал.Ой(`Сегмент забракован: ${t.stack}`),_(),i[2]=!0}м_Балкон.Положить(a)}r?(!function(){var i=t[0]||e(0);if(i[0].чОбработка)var n=i[22],r=i[23];else n=i[25],r=i[24];if(r!==i[23]){var a=Math.min(17,U.ПолучитьКоличествоСемплов());if(a>1)for(var s=r,o=n,u=0,c=i[14].ПрочестьЗЦ32(s+12);0!=--a;){s-=16,o-=i[14].ПрочестьБЦ32(s+4);var h=(u-=i[14].ПрочестьБЦ32(s+0))+i[14].ПрочестьЗЦ32(s+12);h>c&&(c=h,r=s,n=o)}}if(i[1])if(Проверить(-1!==r),r===U.уНачалоСемплов)F(i[31],i[32],T,R,!1,!0),w(i[1],i[21],U,V),F(!1,null,null,null,!0,!1);else if(r===U.уКонецСемплов)F(i[31],i[32],T,R,!1,!1),F(i[1],i[21],U,V,!0,!0);else{F(i[31],i[32],T,R,!1,!1);var d=B(n,r);F(i[1],i[21],d[0],d[2],!0,!0),w(!1,i[21],d[1],d[3])}else-1===r?(M(U,V),F(!1,null,null,null,!0,!1),м_Журнал.Окак("Ключевой кадр не найден, сегмент задержан")):r===U.уНачалоСемплов?(F(i[31],i[32],T,R,!0,!0),w(i[1],i[21],U,V)):r===U.уКонецСемплов?(Проверить(T.Пусто()&&R.Пусто()),F(i[1],i[21],U,V,!0,!0)):(d=B(n,r),M(d[0],d[2]),F(i[31],i[32],T,R,!0,!0),w(i[1],i[21],d[1],d[3]))}(),i[1]=!1):(F(i[31],i[32],T,R,!1,!0),T.Свернуть(),R.Свернуть(),"number"!=typeof i[0].пДанные?F(!1,null,null,null,!0,!1):(b(),postMessage([1,i[0]])),i[1]=!0),м_Балкон.Освободить(),i[26]=performance.now()-n},E=function(){};i.Проверить=function(t){if(!t)throw new Error("Проверка не пройдена")},i.Браковать=function(t){if(!t)throw new Error("БРАКОВАТЬ")},i.ЗавершитьРаботуИПоказатьСообщение=function(t){throw void postMessage([4,t])},i.ЗавершитьРаботуИОтправитьОтчет=function(t,e){"object"==typeof e&&null!==e&&e.byteLength?postMessage([3,t,e],[e]):postMessage([3,t,null])},i.ВыброситьВПомойку=function(t){t&&t.buffer.byteLength&&postMessage([5,t.buffer],[t.buffer])},i.ОкруглитьРазмерКучиAsmJS=function(t){return t<=65536?65536:t>=1<<24?(t+16777215&4278190080)>>>0:1<<32-Math.clz32(t-1)},i.AsmJS=function(t,e,i){"use asm";var n=new t.Uint8Array(i);function r(t,e){t=t|0;e=e|0;var i=0,r=0,a=0;if((t|0)<0|(t|0)>(e|0)){return-1|0}i=e-3|0;for(;;){if((t|0)>(i|0)){return e|0}r=n[t>>0]|0;t=t+1|0;if((r|0)==0){r=n[t>>0]|0;t=t+1|0;if((r|0)==0){r=n[t>>0]|0;t=t+1|0;if((r|0)<=1){break}}}}a=t-3|0;t=t-1|0;do{r=n[t>>0]|0;t=t+1|0;if((r|0)==1){t=t-a|0;if((t|0)>0xffff){return-1|0}n[a>>0]=t;n[a+1>>0]=t>>8;return a|0}if((r|0)!=0){return-2|0}}while((t|0)<(e|0));return e|0}return{SearchStartCodePrefix:r}},a["ПропуститьБиты"]=function(t){if(Проверить(Number.isInteger(t)),Проверить((this.кБитОсталось-=t)>=0),1===t)--this._чСледующийБит<0&&(this._чСледующийБит=7,++this._уСледующийБайт);else{var e=this._чСледующийБит-t;e>=0?this._чСледующийБит=e:(e=-e-1,this._чСледующийБит=7-(7&e),this._уСледующийБайт+=1+(e>>>3))}},a["ПрочестьБиты"]=function(t){if(Проверить(Number.isInteger(t)),Проверить((this.кБитОсталось-=t)>=0),1===t)e=this._мбБуфер[this._уСледующийБайт]>>>this._чСледующийБит&1,--this._чСледующийБит<0&&(this._чСледующийБит=7,++this._уСледующийБайт);else{Проверить(t>=1&&t<=32);var e=0,i=t-1,n=(1<<this._чСледующийБит+1)-1;do{var r=this._мбБуфер[this._уСледующийБайт]&n;e|=this._чСледующийБит<i?r<<i-this._чСледующийБит:r>>>this._чСледующийБит-i;var a=Math.min(i,this._чСледующийБит)+1;(this._чСледующийБит-=a)<0&&(this._чСледующийБит=7,++this._уСледующийБайт,n=255)}while((i-=a)>=0)}return e>>>0},a["ПрочестьБеззнаковыйЭКГ"]=function(){for(var t=0;0===this.ПрочестьБиты(1);++t);return Проверить(t<=31),0===t?0:(1<<t>>>0)-1+this.ПрочестьБиты(t)},a["ПрочестьЗнаковыйЭКГ"]=function(){var t=this.ПрочестьБеззнаковыйЭКГ();return 0!=(1&t)?Math.ceil(t/2):-t/2},a["ПропуститьЭКГ"]=function(){for(var t=0;0===this.ПрочестьБиты(1);++t);0!==t&&this.ПропуститьБиты(t)},i.ПотокБитов=r,o["Завершить"]=function(){return Проверить(Number.isInteger(this.уКонец)&&this.уКонец>=this.уНачало&&this.уКонец<=this.мбБуфер.length),this.мбБуфер.subarray(this.уНачало,this.уКонец)},o.AddBox=function(t,e){return this.AddFullBox(t,-1,-1,e)},o.AddFullBox=function(t,e,i,n){Проверить(4===t.length&&Number.isFinite(e)&&Number.isFinite(i)),Проверить(this.уКонец>=this.уНачало);var r=this.уКонец;if(Проверить(this.мбБуфер.length-this.уКонец>=8),this.мбБуфер[r+4]=t.charCodeAt(0),this.мбБуфер[r+5]=t.charCodeAt(1),this.мбБуфер[r+6]=t.charCodeAt(2),this.мбБуфер[r+7]=t.charCodeAt(3),this.уКонец+=8,-1!==e&&(Проверить(e>=0&&e<=255&&i>=0&&i<=16777215),Проверить(this.мбБуфер.length-this.уКонец>=4),this.мбБуфер.ЗаписатьБЦ32(r+8,e<<24|i),this.уКонец+=4),"number"==typeof n)Проверить(Number.isInteger(n)&&n>=0),this.уКонец+=n,Проверить(this.уКонец<=this.мбБуфер.length);else if("function"==typeof n){var a=this.уКонец;n(),Проверить(Number.isInteger(this.уКонец)&&this.уКонец>=a&&this.уКонец<=this.мбБуфер.length)}else this.Копировать(this.уКонец,n);this.мбБуфер.ЗаписатьБЦ32(r,this.уКонец-r)},o["Копировать"]=function(t,e,i,n){Проверить(Number.isInteger(t)&&t>=this.уКонец),2===arguments.length?(this.мбБуфер.set(e,t),this.уКонец=t+e.length):(Проверить(Number.isInteger(i)&&Number.isInteger(n)),this.мбБуфер.Копировать(t,e,i,n),this.уКонец=t+n-i)},i.IsoBaseMedia=s,u._oUtf8Decoder=null,c["ПолучитьСледующееПоле"]=function(){if(this._кбТег>10){var t=this._мб[this._уТег],e=this._мб[this._уТег+1],i=this._мб[this._уТег+2],n=this._мб[this._уТег+3];if(t>=48&&t<=57||t>=65&&t<=90&&e>=48&&e<=57||e>=65&&e<=90&&i>=48&&i<=57||i>=65&&i<=90&&n>=48&&n<=57||n>=65&&n<=90){var r=this._ParseSynchsafeInteger(this._уТег+4);if(r>=1&&r<=this._кбТег-10&&0===this._мб[this._уТег+9])return this._уПоле=this._уТег+10,this._кбПоле=r,this._уТег+=10+r,this._кбТег-=10+r,String.fromCharCode(t,e,i,n)}}return this._уПоле=-1,this._кбПоле=-1,null},c["ПолучитьПервоеТекстовоеЗначение"]=function(){if(this._кбПоле<2||3!==this._мб[this._уПоле])return null;null===ID3._oUtf8Decoder&&(ID3._oUtf8Decoder=new TextDecoder("utf-8",{fatal:!0}));try{var t=ID3._oUtf8Decoder.decode(new Uint8Array(this._мб.buffer,this._уПоле+1,this._кбПоле-1))}catch(t){return null}var e=t.indexOf("\0");return-1===e?null:t.slice(0,e)},c._ParseSynchsafeInteger=function(t){var e=-1,i=this._мб[t];if(i<128){var n=i<<21;(i=this._мб[t+1])<128&&(n|=i<<14,(i=this._мб[t+2])<128&&(n|=i<<7,(i=this._мб[t+3])<128&&(e=n|i)))}return e},i.ID3=u,d["Пусто"]=function(){return Проверить(Number.isInteger(this.уНачалоПотока)&&Number.isInteger(this.уКонецПотока)&&this.уНачалоПотока>=0&&this.уНачалоПотока<=this.уКонецПотока),this.уКонецПотока===this.уНачалоПотока},d["ПолучитьРазмерПотока"]=function(){return Проверить(Number.isInteger(this.уНачалоПотока)&&Number.isInteger(this.уКонецПотока)&&this.уНачалоПотока>=0&&this.уНачалоПотока<=this.уКонецПотока),this.уКонецПотока-this.уНачалоПотока},d["ПолучитьРазмерСемплов"]=function(){return Проверить(Number.isInteger(this.уНачалоСемплов)&&Number.isInteger(this.уКонецСемплов)&&this.уНачалоСемплов>=0&&this.уНачалоСемплов<=this.уКонецСемплов),Проверить((this.уКонецСемплов-this.уНачалоСемплов)%this.кбСтруктураСемпла==0),this.уКонецСемплов-this.уНачалоСемплов},d["ПолучитьКоличествоСемплов"]=function(){return this.ПолучитьРазмерСемплов()/this.кбСтруктураСемпла},d["СложитьБеззнаковыйПараметр"]=function(t,e,i){Проверить(Number.isInteger(t)&&t>=0&&t<=this.кбСтруктураСемпла-4),Проверить(Number.isInteger(this.уНачалоСемплов)&&Number.isInteger(this.уКонецСемплов)&&this.уНачалоСемплов>=0&&this.уНачалоСемплов<=this.уКонецСемплов),Проверить(Number.isInteger(e)&&e>=this.уНачалоСемплов&&e<=this.уКонецСемплов),Проверить((this.уКонецСемплов-this.уНачалоСемплов)%this.кбСтруктураСемпла==0&&(e-this.уНачалоСемплов)%this.кбСтруктураСемпла==0);for(var n=0,r=this.уНачалоСемплов;r!==e;r+=this.кбСтруктураСемпла)n+=i.ПрочестьБЦ32(r+t);return n},d["Свернуть"]=function(){Проверить(Number.isInteger(this.уНачалоПотока)&&this.уНачалоПотока>=0),Проверить(Number.isInteger(this.уНачалоСемплов)&&this.уНачалоСемплов>=0),this.уКонецПотока=this.уНачалоПотока,this.уКонецСемплов=this.уНачалоСемплов,this.чВДНачала=-1},i.Срез=h;var C=(E.prototype=d,new E);C.constructor=f,f.prototype=C,i.СрезОбработки=f;var D=n;D["Копировать"]=function(t,e,i,n){this.set(new Uint8Array(e.buffer,i,Math.floor(n)-Math.floor(i)),t)},D["ПрочестьБЦ64"]=function(t){return 4294967296*((this[t|=0]<<24|this[t+1|0]<<16|this[t+2|0]<<8|this[t+3|0])>>>0)+((this[t+4|0]<<24|this[t+5|0]<<16|this[t+6|0]<<8|this[t+7|0])>>>0)},D["ПрочестьЗЦ32"]=function(t){return this[t|=0]<<24|this[t+1|0]<<16|this[t+2|0]<<8|this[t+3|0]},D["ПрочестьБЦ32"]=function(t){return(this[t|=0]<<24|this[t+1|0]<<16|this[t+2|0]<<8|this[t+3|0])>>>0},D["ПрочестьЗЦ16"]=function(t){return this[t|=0]<<24>>16|this[t+1|0]},D["ПрочестьБЦ16"]=function(t){return this[t|=0]<<8|this[t+1|0]},D["ЗаписатьБЦ64"]=l,D["ЗаписатьЗЦ64"]=l,D["ЗаписатьБЦ32"]=v,D["ЗаписатьЗЦ32"]=v,D["ЗаписатьБЦ16"]=m,D["ЗаписатьЗЦ16"]=m;var T=(E.prototype=d,new E);T["кбСтруктураСемпла"]=16,T["уНачалоПотока"]=0,T["уКонецПотока"]=0,T["уНачалоСемплов"]=0,T["уКонецСемплов"]=0,T["чВДНачала"]=-1;var R=(E.prototype=d,new E);R["кбСтруктураСемпла"]=4,R["уНачалоПотока"]=0,R["уКонецПотока"]=0,R["уНачалоСемплов"]=0,R["уКонецСемплов"]=0,R["чВДНачала"]=-1;var q=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],U=(E.prototype=C,new E);U["кбСтруктураСемпла"]=16,U["уНачалоПотока"]=0,U["уКонецПотока"]=0,U["уНачалоСемплов"]=0,U["уКонецСемплов"]=0,U["чВДНачала"]=-1,U.nContinuityCounter=-1,U.pPesPacketEnd=-1;var V=(E.prototype=C,new E);V["кбСтруктураСемпла"]=4,V["уНачалоПотока"]=0,V["уКонецПотока"]=0,V["уНачалоСемплов"]=0,V["уКонецСемплов"]=0,V["чВДНачала"]=-1,V.nContinuityCounter=-1,V.pPesPacketEnd=-1;var L=(E.prototype=C,new E);L["кбСтруктураСемпла"]=0,L["уНачалоПотока"]=0,L["уКонецПотока"]=0,L["уНачалоСемплов"]=0,L["уКонецСемплов"]=0,L["чВДНачала"]=0,L.nContinuityCounter=-1,L.pPesPacketEnd=-1;var j=(E.prototype=d,new E);j["кбСтруктураСемпла"]=4,j["уНачалоПотока"]=0,j["уКонецПотока"]=0,j["уНачалоСемплов"]=0,j["уКонецСемплов"]=0,j["чВДНачала"]=-1,i.onmessage=function(i){var n=t[0]||e(0);const r="object"!=typeof i.data||null===i.data?typeof i.data:i.data.сВерсия;if(r!==ВЕРСИЯ_РАСШИРЕНИЯ)throw new Error(`Версия ${r} !== ${ВЕРСИЯ_РАСШИРЕНИЯ}`);try{n[0]=i.data,k()}catch(t){self.onmessage=null,b(),м_Журнал.Отправить(),ЗавершитьРаботуИОтправитьОтчет(t instanceof Error?`Поймано исключение в рабочем потоке: ${t.stack}`:`Поймано исключение в рабочем потоке: [typeof ${typeof t}] ${new Error(t).stack}`,i.data.пДанные)}finally{n[0]=null}},ВЕРСИЯ_РАСШИРЕНИЯ="2018.4.6";var O=[],W=[];м_Журнал={"Вот":function(t){P("Вот",t)},"Окак":function(t){P("Окак",t)},"Ой":function(t){P("Ой",t)},"Отправить":function(){0!==O.length&&(postMessage([2,O,W]),O.length=0,W.length=0)}},м_Балкон={"Положить":function(i){var n=t[1]||e(1);Проверить(!n[0]),n[0]=i},"Найти":function(i){var n=t[1]||e(1),r=null;return n[0]&&(n[0].length>=i?(м_Журнал.Вот(`Найдено барахло на ${n[0].length-i} больше запрашиваемого ${i}`),r=n[0],n[0]=null):м_Журнал.Окак(`Найдено барахло на ${i-n[0].length} меньше запрашиваемого ${i}`)),r},"Освободить":function(){var i=t[1]||e(1);i[0]&&(ВыброситьВПомойку(i[0]),i[0]=null)}}}).call(this);